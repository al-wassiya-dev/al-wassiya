<!DOCTYPE html>
<html lang="fr" id="html-root">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Al Wassiya - Votre Testament Islamique Simplifié</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <!-- MODIFICATION 6: Support multilingue - Police arabe -->
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <!-- MODIFICATION 1: html2pdf.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --primary: #C9B178;
            --primary-dark: #A89262;
            --secondary: #2D4C68;
            --accent: #3A5F7E;
            --light: #F8F5EE;
            --dark: #1E1E24;
            --success: #4CAF50;
            --error: #E74C3C;
            --radius: 16px;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        /* MODIFICATION 6: CSS pour multilingue arabe/français */
        .language-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: var(--primary);
            border-radius: var(--radius);
            padding: 10px;
            box-shadow: var(--shadow);
        }

        .language-switcher button {
            background: transparent;
            border: none;
            color: white;
            font-weight: 600;
            padding: 8px 15px;
            margin: 0 2px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
        }

        .language-switcher button.active,
        .language-switcher button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        /* Support RTL pour l'arabe */
        [dir="rtl"] {
            font-family: 'Amiri', serif;
            text-align: right;
        }

        [dir="rtl"] .form-group label {
            text-align: right;
        }

        [dir="rtl"] .btn {
            margin-left: 0;
            margin-right: 10px;
        }

        [dir="rtl"] .header {
            text-align: center;
        }

        /* MODIFICATION 5: Sous-titre arabe */
        .arabic-subtitle {
            text-align: center;
            font-size: 2.2rem;
            color: var(--secondary);
            margin-bottom: 1rem;
            font-family: 'Amiri', serif;
            font-weight: 700;
            letter-spacing: 2px;
        }

        /* MODIFICATION 7: Styles pour le footer */
        .footer {
            background: var(--secondary);
            color: white;
            padding: 3rem 0 1rem;
            margin-top: 4rem;
            position: relative;
        }

        .footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
        }

        .footer-section h3 {
            color: var(--primary);
            margin-bottom: 1rem;
            font-family: 'Playfair Display', serif;
            font-size: 1.3rem;
            border-bottom: 2px solid rgba(201, 177, 120, 0.3);
            padding-bottom: 0.5rem;
        }

        .footer-section p,
        .footer-section a {
            color: #ccc;
            text-decoration: none;
            margin-bottom: 0.8rem;
            display: block;
            transition: var(--transition);
            line-height: 1.6;
        }

        .footer-section a:hover {
            color: var(--primary);
            transform: translateX(5px);
        }

        .footer-section i {
            margin-right: 8px;
            color: var(--primary);
            width: 20px;
        }

        .footer-bottom {
            border-top: 1px solid #444;
            margin-top: 2rem;
            padding-top: 1rem;
            text-align: center;
            color: #999;
            font-size: 0.9rem;
        }

        .footer-bottom p {
            margin: 0;
        }

        /* MODIFICATION 2: Styles spécifiques pour les menus déroulants famille */
        .family-dropdown {
            width: 100%;
            padding: 16px;
            border: 2px solid #EDE8DD;
            border-radius: 10px;
            background: #FCFAF7;
            color: var(--dark);
            font-size: 1rem;
            transition: var(--transition);
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23C9B178' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            cursor: pointer;
        }

        .family-dropdown:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(201, 177, 120, 0.2);
        }

        .family-dropdown option {
            padding: 12px;
            background: white;
            color: var(--dark);
        }

        .family-type-label {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 8px;
            display: block;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Votre CSS original intégralement conservé */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #F8F5EE 0%, #E6E2D6 100%);
            color: var(--dark);
            line-height: 1.7;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        .header {
            text-align: center;
            padding: 40px 0;
            margin-bottom: 30px;
            position: relative;
        }

        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 3.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .subtitle {
            font-size: 1.2rem;
            color: var(--secondary);
            margin-bottom: 25px;
            font-weight: 400;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .bismillah {
            font-size: 2.2rem;
            color: var(--primary);
            margin: 25px 0;
            font-weight: 600;
        }

        /* Progress Section */
        .progress-container {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        .progress-bar {
            height: 8px;
            background: #EDE8DD;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            width: 15%;
            border-radius: 4px;
            transition: var(--transition);
        }

        .step-indicator {
            font-size: 1.1rem;
            color: var(--secondary);
            font-weight: 500;
        }

        /* Quranic Verse */
        .quranic-verse {
            background: linear-gradient(135deg, rgba(201, 177, 120, 0.1) 0%, rgba(168, 146, 98, 0.1) 100%);
            border-left: 4px solid var(--primary);
            padding: 25px;
            margin: 30px 0;
            border-radius: 0 var(--radius) var(--radius) 0;
            font-style: italic;
            color: var(--secondary);
            font-size: 1.1rem;
            line-height: 1.8;
            text-align: center;
        }

        .arabic-verse {
            font-size: 1.6rem;
            margin-bottom: 20px;
            line-height: 2;
            font-weight: 600;
            color: var(--primary-dark);
        }

        .translation-note {
            font-size: 0.9rem;
            color: var(--primary-dark);
            margin-top: 10px;
            font-style: italic;
        }

        /* Form Styles */
        .form-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }

        @media (min-width: 992px) {
            .form-container {
                grid-template-columns: 1fr 1fr;
            }
        }

        .form-section {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .form-section:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.6rem;
            color: var(--secondary);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(201, 177, 120, 0.3);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-title i {
            color: var(--primary);
            font-size: 1.4rem;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: var(--secondary);
            font-weight: 500;
            font-size: 1.05rem;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 16px;
            border: 2px solid #EDE8DD;
            border-radius: 10px;
            background: #FCFAF7;
            color: var(--dark);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(201, 177, 120, 0.2);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 130px;
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: #A0A0A0;
        }

        .form-group select option {
            padding: 12px;
        }

        .required {
            color: var(--error);
        }

        /* Family Section Styles */
        .family-category {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: var(--radius);
            background: #F8F5EE;
            border: 1px solid rgba(201, 177, 120, 0.2);
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            cursor: pointer;
        }

        .category-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--secondary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .category-content {
            display: none;
            padding-top: 15px;
        }

        .category-content.active {
            display: block;
        }

        .person-entry {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.03);
        }

        .add-person-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .add-person-btn:hover {
            background: var(--primary-dark);
        }

        .remove-person-btn {
            background: var(--error);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        /* Asset Section Styles */
        .asset-category {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: var(--radius);
            background: #F8F5EE;
            border: 1px solid rgba(201, 177, 120, 0.2);
        }

        .asset-entry {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.03);
        }

        /* Buttons */
        .actions {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin: 40px 0;
        }

        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(168, 146, 98, 0.4);
        }

        .btn-secondary {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
        }

        /* Share Buttons */
        .share-section {
            text-align: center;
            margin: 30px 0;
            background: white;
            padding: 25px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .share-title {
            font-size: 1.2rem;
            color: var(--secondary);
            margin-bottom: 20px;
            font-weight: 600;
        }

        .share-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .share-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            color: white;
            font-size: 1.3rem;
            transition: var(--transition);
            cursor: pointer;
        }

        .share-btn:hover {
            transform: translateY(-3px) scale(1.05);
        }

        .whatsapp { background: #25D366; }
        .facebook { background: #3b5998; }
        .twitter { background: #1DA1F2; }
        .email { background: #d44638; }

        /* Footer Note */
        .footer-note {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            margin-top: 50px;
            box-shadow: var(--shadow);
        }

        .footer-note p {
            margin-bottom: 15px;
            color: var(--secondary);
        }

        .footer-note p:last-child {
            margin-bottom: 0;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .logo {
                font-size: 2.8rem;
            }
            
            .bismillah {
                font-size: 1.8rem;
            }
            
            .arabic-verse {
                font-size: 1.4rem;
            }
            
            .form-section {
                padding: 25px 20px;
            }
            
            .section-title {
                font-size: 1.4rem;
            }
            
            .actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .share-buttons {
                gap: 10px;
            }
            
            .share-btn {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }

            .language-switcher {
                top: 10px;
                right: 10px;
                padding: 8px;
            }

            .language-switcher button {
                padding: 6px 12px;
                font-size: 12px;
            }

            .arabic-subtitle {
                font-size: 1.8rem;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-section {
            animation: fadeIn 0.6s ease-out;
        }

        /* Islamic Pattern Background */
        .islamic-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(201, 177, 120, 0.03) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(168, 146, 98, 0.03) 0%, transparent 40%);
            pointer-events: none;
            z-index: -1;
        }

        /* Step Navigation */
        .step-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .privacy-notice {
            background-color: #f8f5ee;
            border-left: 4px solid var(--primary);
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 var(--radius) var(--radius) 0;
            font-size: 0.9rem;
            color: var(--secondary);
        }
        
        .zakat-calculator {
            background-color: white;
            border-radius: var(--radius);
            padding: 20px;
            margin: 20px 0;
            box-shadow: var(--shadow);
        }
        
        .calculator-result {
            margin-top: 15px;
            padding: 15px;
            background-color: var(--light);
            border-radius: var(--radius);
            font-weight: 500;
            color: var(--secondary);
            display: none;
        }

        /* Améliorations ajoutées */
        .step-dots {
            display: flex;
            justify-content: center;
            margin: 20px 0 40px;
            gap: 12px;
        }

        .step-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: #EDE8DD;
            cursor: pointer;
            transition: var(--transition);
        }

        .step-dot.active {
            background-color: var(--primary);
            transform: scale(1.2);
        }

        .step-dot.completed {
            background-color: var(--success);
        }

        .validation-error {
            color: var(--error);
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
        }

        input:invalid, textarea:invalid, select:invalid {
            border-color: var(--error);
        }

        .save-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--success);
            color: white;
            padding: 10px 15px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .save-indicator.visible {
            opacity: 1;
        }

        .skip-to-content {
            position: absolute;
            top: -40px;
            left: 10px;
            background: var(--primary);
            color: white;
            padding: 8px;
            border-radius: 4px;
            z-index: 100;
            transition: top 0.3s ease;
        }

        .skip-to-content:focus {
            top: 10px;
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* Nouveaux styles pour la section héritage */
        .heritage-section {
            background-color: #f8f9fa;
            border-radius: var(--radius);
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(201, 177, 120, 0.3);
        }
        
        .heritage-title {
            font-family: 'Playfair Display', serif;
            color: var(--secondary);
            margin-bottom: 15px;
            font-size: 1.4rem;
        }
        
        .heritage-note {
            background-color: rgba(201, 177, 120, 0.1);
            padding: 15px;
            border-radius: var(--radius);
            margin: 15px 0;
            font-size: 0.9rem;
        }
        
        .heritage-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .heritage-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }
        
        .heritage-item-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--secondary);
        }
        
        .heritage-share {
            font-size: 0.9rem;
            color: var(--primary-dark);
            font-weight: 500;
        }
        
        .legs-container {
            margin-top: 20px;
        }
        
        .leg-entry {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.03);
            position: relative;
        }
        
        .leg-amount {
            font-weight: 600;
            color: var(--primary-dark);
            margin-top: 10px;
        }
        
        .total-assets {
            background: white;
            padding: 20px;
            border-radius: var(--radius);
            margin: 20px 0;
            box-shadow: var(--shadow);
        }
        
        .total-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-dark);
            margin-top: 10px;
        }
        
        .legs-summary {
            background: rgba(201, 177, 120, 0.1);
            padding: 15px;
            border-radius: var(--radius);
            margin: 15px 0;
        }
        
        .warning {
            color: var(--error);
            font-weight: 500;
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-to-content">Aller au contenu principal</a>
    
    <!-- MODIFICATION 6: Sélecteur de langue -->
    <div class="language-switcher">
        <button onclick="switchLanguage('fr')" class="active" id="lang-fr">FR</button>
        <button onclick="switchLanguage('ar')" id="lang-ar">عر</button>
    </div>
    
    <div class="islamic-pattern"></div>
    
    <div class="container">
        <div class="header">
            <div class="logo">Al Wassiya</div>
            <!-- MODIFICATION 5: Sous-titre arabe -->
            <div class="arabic-subtitle">الوصية</div>
            <div class="subtitle">Votre Testament Islamique Simplifié</div>
            <div class="bismillah">بِسْمِ اللَّهِ الرَّحْمَنِ الرَّحِيم</div>
            <p>Créez facilement un testament islamique respectant le Coran et la Sunna</p>
        </div>

        <div class="step-dots" id="stepDots">
            <div class="step-dot active" data-step="1"></div>
            <div class="step-dot" data-step="2"></div>
            <div class="step-dot" data-step="3"></div>
            <div class="step-dot" data-step="4"></div>
            <div class="step-dot" data-step="5"></div>
            <div class="step-dot" data-step="6"></div>
        </div>

        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="step-indicator" id="stepIndicator">
                Étape 1 sur 6 : Informations personnelles et volontés générales
            </div>
        </div>

        <div class="quranic-verse">
            <div class="arabic-verse">كُتِبَ عَلَيْكُمْ إِذَا حَضَرَ أَحَدَكُمُ الْمَوْتُ إِن تَرَكَ خَيْرًا الْوَصِيَّةُ لِلْوَالِدَيْنِ وَالْأَقْرَبِينَ بِالْمَعْرُوفِ ۖ حَقًّا عَلَى الْمُتَّقِينَ</div>
            <div>"Il vous est prescrit, quand la mort se présente à l'un de vous, s'il laisse des biens, de faire un testament en faveur de ses père et mère et de ses proches, selon les convenances. C'est un devoir pour les pieux." - Sourate Al-Baqara, verset 180</div>
            <div class="translation-note">(c'est une traduction rapprochée)</div>
        </div>
        <main id="main-content">
            <!-- Étape 1: Informations personnelles -->
            <form id="testamentForm" novalidate>
                <div id="step1" class="form-step">
                    <div class="form-container">
                        <div class="form-section">
                            <h2 class="section-title"><i class="fas fa-user"></i> Identité du défunt</h2>
                            
                            <div class="form-group">
                                <label for="sexe">Sexe <span class="required">*</span></label>
                                <select id="sexe" name="sexe" required onchange="toggleConjointField()">
                                    <option value="">Sélectionner</option>
                                    <option value="homme">Homme</option>
                                    <option value="femme">Femme</option>
                                </select>
                                <div class="validation-error" id="sexe-error">Veuillez sélectionner votre sexe</div>
                            </div>

                            <div class="form-group">
                                <label for="prenom">Prénom <span class="required">*</span></label>
                                <input type="text" id="prenom" name="prenom" required placeholder="Votre prénom">
                                <div class="validation-error" id="prenom-error">Veuillez saisir votre prénom</div>
                            </div>

                            <div class="form-group">
                                <label for="nom">Nom de famille <span class="required">*</span></label>
                                <input type="text" id="nom" name="nom" required placeholder="Votre nom de famille">
                                <div class="validation-error" id="nom-error">Veuillez saisir votre nom</div>
                            </div>

                            <div class="form-group">
                                <label for="dateNaissance">Date de naissance <span class="required">*</span></label>
                                <input type="date" id="dateNaissance" name="dateNaissance" required>
                                <div class="validation-error" id="dateNaissance-error">Veuillez saisir votre date de naissance</div>
                            </div>

                            <div class="form-group">
                                <label for="lieuNaissance">Lieu de naissance</label>
                                <input type="text" id="lieuNaissance" name="lieuNaissance" placeholder="Ville et pays de naissance">
                            </div>

                            <div class="form-group">
                                <label for="adresse">Adresse actuelle <span class="required">*</span></label>
                                <textarea id="adresse" name="adresse" required placeholder="Votre adresse complète"></textarea>
                                <div class="validation-error" id="adresse-error">Veuillez saisir votre adresse</div>
                            </div>

                            <div class="form-group">
                                <label for="nationalite">Nationalité</label>
                                <input type="text" id="nationalite" name="nationalite" placeholder="Votre nationalité">
                            </div>

                            <div class="form-group">
                                <label for="situationFamiliale">Situation familiale</label>
                                <select id="situationFamiliale" name="situationFamiliale" onchange="toggleConjointField()">
                                    <option value="">Sélectionner</option>
                                    <option value="celibataire">Célibataire</option>
                                    <option value="marie">Marié(e)</option>
                                    <option value="divorce">Divorcé(e)</option>
                                    <option value="veuf">Veuf/Veuve</option>
                                </select>
                            </div>

                            <div class="form-group" id="conjointGroup" style="display: none;">
                                <label for="conjoint" id="conjointLabel">Identité de l'époux/épouse</label>
                                <input type="text" id="conjoint" name="conjoint" placeholder="Nom et prénom du conjoint">
                            </div>
                        </div>

                        <div class="form-section">
                            <h2 class="section-title"><i class="fas fa-scroll"></i> Volontés générales</h2>
                            
                            <div class="form-group">
                                <label for="volontesObseques">Volontés concernant les obsèques</label>
                                <textarea id="volontesObseques" name="volontesObseques" placeholder="Indiquez vos souhaits concernant l'inhumation, la mosquée pour la prière, le lieu de sépulture, etc."></textarea>
                            </div>

                            <div class="form-group">
                                <label for="recommandationsFamille">Recommandations à la famille</label>
                                <textarea id="recommandationsFamille" name="recommandationsFamille" placeholder="Messages, conseils ou recommandations pour votre famille"></textarea>
                            </div>

                            <div class="form-group">
                                <label for="executeurTestament">Exécuteur testamentaire suggéré</label>
                                <input type="text" id="executeurTestament" name="executeurTestament" placeholder="Nom de la personne de confiance">
                            </div>

                            <div class="form-group">
                                <label for="contactExecuteur">Contact de l'exécuteur</label>
                                <input type="text" id="contactExecuteur" name="contactExecuteur" placeholder="Téléphone ou email">
                            </div>

                            <div class="form-group">
                                <label for="autresVolontes">Autres volontés ou instructions</label>
                                <textarea id="autresVolontes" name="autresVolontes" placeholder="Toute autre instruction importante"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Étape 2: Famille et proches AVEC MODIFICATION 2: Menus déroulants -->
                <div id="step2" class="form-step" style="display: none;">
                    <div class="form-container">
                        <div class="form-section">
                            <h2 class="section-title"><i class="fas fa-users"></i> Famille et proches</h2>
                            
                            <!-- MODIFICATION 2: Parents avec menu déroulant père/mère -->
                            <div class="family-category">
                                <div class="category-header" onclick="toggleCategory('parents')">
                                    <div class="category-title">
                                        <i class="fas fa-user-friends"></i> Parents
                                    </div>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div id="parents" class="category-content">
                                    <div id="parents-container">
                                        <div class="person-entry">
                                            <div class="form-group">
                                                <label class="family-type-label">Type de parent</label>
                                                <select class="family-dropdown" name="parents[0][type]">
                                                    <option value="">Sélectionner le type</option>
                                                    <option value="pere">Père</option>
                                                    <option value="mere">Mère</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Nom complet</label>
                                                <input type="text" name="parents[0][nom]" placeholder="Nom et prénom du parent">
                                            </div>
                                            <div class="form-group">
                                                <label>Date de naissance</label>
                                                <input type="date" name="parents[0][dateNaissance]">
                                            </div>
                                            <div class="form-group">
                                                <label>Statut</label>
                                                <select name="parents[0][statut]">
                                                    <option value="vivant">Vivant</option>
                                                    <option value="decede">Décédé</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Adresse (si différente)</label>
                                                <input type="text" name="parents[0][adresse]" placeholder="Adresse du parent">
                                            </div>
                                            <div class="form-group">
                                                <label>Téléphone</label>
                                                <input type="tel" name="parents[0][telephone]" placeholder="Numéro de téléphone">
                                            </div>
                                        </div>
                                    </div>
                                    <button type="button" class="add-person-btn" onclick="addPerson('parents')">
                                        <i class="fas fa-plus"></i> Ajouter un parent
                                    </button>
                                </div>
                            </div>

                            <!-- MODIFICATION 2: Époux/Épouse avec menu déroulant -->
                            <div class="family-category">
                                <div class="category-header" onclick="toggleCategory('conjoints')">
                                    <div class="category-title">
                                        <i class="fas fa-ring"></i> Époux/Épouse
                                    </div>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div id="conjoints" class="category-content">
                                    <div id="conjoints-container">
                                        <div class="person-entry">
                                            <div class="form-group">
                                                <label class="family-type-label">Type de conjoint</label>
                                                <select class="family-dropdown" name="conjoints[0][type]">
                                                    <option value="">Sélectionner le type</option>
                                                    <option value="epoux">Époux</option>
                                                    <option value="epouse">Épouse</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Nom complet</label>
                                                <input type="text" name="conjoints[0][nom]" placeholder="Nom et prénom du conjoint">
                                            </div>
                                            <div class="form-group">
                                                <label>Date de naissance</label>
                                                <input type="date" name="conjoints[0][dateNaissance]">
                                            </div>
                                            <div class="form-group">
                                                <label>Date de mariage</label>
                                                <input type="date" name="conjoints[0][dateMarriage]">
                                            </div>
                                            <div class="form-group">
                                                <label>Lieu de mariage</label>
                                                <input type="text" name="conjoints[0][lieuMarriage]" placeholder="Ville et pays du mariage">
                                            </div>
                                            <div class="form-group">
                                                <label>Adresse (si différente)</label>
                                                <input type="text" name="conjoints[0][adresse]" placeholder="Adresse du conjoint">
                                            </div>
                                            <div class="form-group">
                                                <label>Téléphone</label>
                                                <input type="tel" name="conjoints[0][telephone]" placeholder="Numéro de téléphone">
                                            </div>
                                        </div>
                                    </div>
                                    <button type="button" class="add-person-btn" onclick="addPerson('conjoints')">
                                        <i class="fas fa-plus"></i> Ajouter un conjoint
                                    </button>
                                </div>
                            </div>

                            <!-- MODIFICATION 2: Frères et Sœurs avec menu déroulant -->
                            <div class="family-category">
                                <div class="category-header" onclick="toggleCategory('freres-soeurs')">
                                    <div class="category-title">
                                        <i class="fas fa-users"></i> Frères et Sœurs
                                    </div>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div id="freres-soeurs" class="category-content">
                                    <div id="freres-soeurs-container">
                                        <div class="person-entry">
                                            <div class="form-group">
                                                <label class="family-type-label">Type de fratrie</label>
                                                <select class="family-dropdown" name="freres-soeurs[0][type]">
                                                    <option value="">Sélectionner le type</option>
                                                    <option value="frere">Frère</option>
                                                    <option value="soeur">Sœur</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Nom complet</label>
                                                <input type="text" name="freres-soeurs[0][nom]" placeholder="Nom et prénom">
                                            </div>
                                            <div class="form-group">
                                                <label>Date de naissance</label>
                                                <input type="date" name="freres-soeurs[0][dateNaissance]">
                                            </div>
                                            <div class="form-group">
                                                <label>Statut</label>
                                                <select name="freres-soeurs[0][statut]">
                                                    <option value="vivant">Vivant</option>
                                                    <option value="decede">Décédé</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Adresse</label>
                                                <input type="text" name="freres-soeurs[0][adresse]" placeholder="Adresse">
                                            </div>
                                            <div class="form-group">
                                                <label>Téléphone</label>
                                                <input type="tel" name="freres-soeurs[0][telephone]" placeholder="Numéro de téléphone">
                                            </div>
                                            <div class="form-group">
                                                <label>Profession</label>
                                                <input type="text" name="freres-soeurs[0][profession]" placeholder="Profession actuelle">
                                            </div>
                                        </div>
                                    </div>
                                    <button type="button" class="add-person-btn" onclick="addPerson('freres-soeurs')">
                                        <i class="fas fa-plus"></i> Ajouter un frère/une sœur
                                    </button>
                                </div>
                            </div>

                            <!-- MODIFICATION 2: Enfants avec menu déroulant fils/fille -->
                            <div class="family-category">
                                <div class="category-header" onclick="toggleCategory('enfants')">
                                    <div class="category-title">
                                        <i class="fas fa-baby"></i> Enfants
                                    </div>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div id="enfants" class="category-content">
                                    <div id="enfants-container">
                                        <div class="person-entry">
                                            <div class="form-group">
                                                <label class="family-type-label">Type d'enfant</label>
                                                <select class="family-dropdown" name="enfants[0][type]">
                                                    <option value="">Sélectionner le type</option>
                                                    <option value="fils">Fils</option>
                                                    <option value="fille">Fille</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Nom complet</label>
                                                <input type="text" name="enfants[0][nom]" placeholder="Nom et prénom de l'enfant">
                                            </div>
                                            <div class="form-group">
                                                <label>Date de naissance</label>
                                                <input type="date" name="enfants[0][dateNaissance]">
                                            </div>
                                            <div class="form-group">
                                                <label>Lieu de naissance</label>
                                                <input type="text" name="enfants[0][lieuNaissance]" placeholder="Ville et pays de naissance">
                                            </div>
                                            <div class="form-group">
                                                <label>Statut</label>
                                                <select name="enfants[0][statut]">
                                                    <option value="vivant">Vivant</option>
                                                    <option value="decede">Décédé</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Adresse (si différente)</label>
                                                <input type="text" name="enfants[0][adresse]" placeholder="Adresse de l'enfant">
                                            </div>
                                            <div class="form-group">
                                                <label>Téléphone</label>
                                                <input type="tel" name="enfants[0][telephone]" placeholder="Numéro de téléphone">
                                            </div>
                                            <div class="form-group">
                                                <label>Profession / Études</label>
                                                <input type="text" name="enfants[0][profession]" placeholder="Profession ou études en cours">
                                            </div>
                                            <div class="form-group">
                                                <label>Situation familiale</label>
                                                <select name="enfants[0][situationFamiliale]">
                                                    <option value="celibataire">Célibataire</option>
                                                    <option value="marie">Marié(e)</option>
                                                    <option value="divorce">Divorcé(e)</option>
                                                    <option value="veuf">Veuf/Veuve</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Enfants (petits-enfants)</label>
                                                <input type="number" name="enfants[0][nombreEnfants]" min="0" placeholder="Nombre d'enfants">
                                            </div>
                                        </div>
                                    </div>
                                    <button type="button" class="add-person-btn" onclick="addPerson('enfants')">
                                        <i class="fas fa-plus"></i> Ajouter un enfant
                                    </button>
                                </div>
                            </div>

                            <div class="family-category">
                                <div class="category-header" onclick="toggleCategory('amis')">
                                    <div class="category-title">
                                        <i class="fas fa-heart"></i> Amis proches
                                    </div>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div id="amis" class="category-content">
                                    <div id="amis-container"></div>
                                    <button type="button" class="add-person-btn" onclick="addPerson('amis')">
                                        <i class="fas fa-plus"></i> Ajouter un ami
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2 class="section-title"><i class="fas fa-info-circle"></i> Informations complémentaires</h2>
                            
                            <div class="form-group">
                                <label for="autresProches">Autres personnes à mentionner</label>
                                <textarea id="autresProches" name="autresProches" placeholder="Toute autre personne que vous souhaitez mentionner dans votre testament (grands-parents, oncles, tantes, cousins, etc.)"></textarea>
                            </div>

                            <div class="form-group">
                                <label for="relationsParticulieres">Relations particulières</label>
                                <textarea id="relationsParticulieres" name="relationsParticulieres" placeholder="Décrivez toute relation particulière ou situation familiale importante (adoption, tutelle, conflits familiaux, etc.)"></textarea>
                            </div>

                            <div class="form-group">
                                <label for="personnesPrevenir">Personnes à prévenir en priorité</label>
                                <textarea id="personnesPrevenir" name="personnesPrevenir" placeholder="Liste des personnes à contacter en priorité en cas de décès, avec leurs coordonnées complètes"></textarea>
                            </div>

                            <div class="form-group">
                                <label for="conseillersLegaux">Conseillers légaux ou religieux</label>
                                <textarea id="conseillersLegaux" name="conseillersLegaux" placeholder="Nom et coordonnées de votre imam, avocat, notaire ou autre conseiller à consulter"></textarea>
                            </div>

                            <div class="form-group">
                                <label for="membresNonMusulmans">Membres de famille non-musulmans</label>
                                <textarea id="membresNonMusulmans" name="membresNonMusulmans" placeholder="Précisez s'il y a des membres de famille non-musulmans et vos souhaits les concernant"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Étape 3: Biens matériels et financiers -->
                <div id="step3" class="form-step" style="display: none;">
                    <div class="form-container">
                        <div class="form-section">
                            <h2 class="section-title"><i class="fas fa-home"></i> Biens immobiliers</h2>
                            
                            <div class="asset-category">
                                <div class="category-header" onclick="toggleCategory('immobilier')">
                                    <div class="category-title">
                                        <i class="fas fa-building"></i> Propriétés immobilières
                                    </div>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div id="immobilier" class="category-content">
                                    <div id="immobilier-container">
                                        <div class="asset-entry">
                                            <div class="form-group">
                                                <label>Type de bien immobilier</label>
                                                <select name="immobilier[0][type]">
                                                    <option value="">Sélectionner le type</option>
                                                    <option value="appartement">Appartement</option>
                                                    <option value="maison">Maison</option>
                                                    <option value="terrain">Terrain</option>
                                                    <option value="garage">Garage/Parking</option>
                                                    <option value="local-commercial">Local commercial</option>
                                                    <option value="immeuble">Immeuble</option>
                                                    <option value="autre">Autre</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Description détaillée</label>
                                                <textarea name="immobilier[0][description]" placeholder="Description précise du bien (nombre de pièces, superficie, caractéristiques particulières, etc.)"></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label>Adresse complète</label>
                                                <textarea name="immobilier[0][adresse]" placeholder="Adresse complète avec code postal et ville"></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label>Valeur estimée (€)</label>
                                                <input type="number" name="immobilier[0][valeur]" min="0" step="100" placeholder="Valeur marchande estimée">
                                            </div>
                                            <div class="form-group">
                                                <label>Mode d'acquisition</label>
                                                <select name="immobilier[0][acquisition]">
                                                    <option value="achat">Achat</option>
                                                    <option value="heritage">Héritage</option>
                                                    <option value="donation">Donation</option>
                                                    <option value="construction">Construction</option>
                                                    <option value="autre">Autre</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Date d'acquisition</label>
                                                <input type="date" name="immobilier[0][dateAcquisition]">
                                            </div>
                                            <div class="form-group">
                                                <label>Références cadastrales</label>
                                                <input type="text" name="immobilier[0][cadastre]" placeholder="Références cadastrales ou numéro de lot">
                                            </div>
                                            <div class="form-group">
                                                <label>Hypothèques ou charges</label>
                                                <textarea name="immobilier[0][charges]" placeholder="Précisez s'il existe des hypothèques, prêts en cours, charges de copropriété, etc."></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label>Documents importants</label>
                                                <textarea name="immobilier[0][documents]" placeholder="Localisation des documents : acte de propriété, contrats, assurances, etc."></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="button" class="add-person-btn" onclick="addAsset('immobilier')">
                                        <i class="fas fa-plus"></i> Ajouter un bien immobilier
                                    </button>
                                </div>
                            </div>

                            <div class="privacy-notice">
                                <i class="fas fa-shield-alt"></i> <strong>Confidentialité :</strong> Les informations personnelles que vous saisissez sont stockées localement sur votre appareil. Nous recommandons de ne pas inclure de données trop sensibles et de sauvegarder ce document dans un lieu sécurisé.
                            </div>
                        </div>

                        <div class="form-section">
                            <h2 class="section-title"><i class="fas fa-car"></i> Biens matériels</h2>
                            
                            <div class="asset-category">
                                <div class="category-header" onclick="toggleCategory('materiel')">
                                    <div class="category-title">
                                        <i class="fas fa-tshirt"></i> Biens de valeur
                                    </div>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div id="materiel" class="category-content">
                                    <div id="materiel-container">
                                        <div class="asset-entry">
                                            <div class="form-group">
                                                <label>Type de bien</label>
                                                <select name="materiel[0][type]">
                                                    <option value="">Sélectionner le type</option>
                                                    <option value="vehicule">Véhicule</option>
                                                    <option value="bijoux">Bijoux</option>
                                                    <option value="art">Œuvre d'art</option>
                                                    <option value="collection">Collection</option>
                                                    <option value="electromenager">Électroménager</option>
                                                    <option value="mobilier">Mobilier</option>
                                                    <option value="informatique">Matériel informatique</option>
                                                    <option value="autre">Autre</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Description détaillée</label>
                                                <textarea name="materiel[0][description]" placeholder="Description précise : marque, modèle, caractéristiques, état, etc."></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label>Valeur estimée (€)</label>
                                                <input type="number" name="materiel[0][valeur]" min="0" step="0.01" placeholder="Valeur actuelle estimée">
                                            </div>
                                            <div class="form-group">
                                                <label>Localisation</label>
                                                <input type="text" name="materiel[0][localisation]" placeholder="Où se trouve ce bien actuellement">
                                            </div>
                                            <div class="form-group">
                                                <label>Documents associés</label>
                                                <textarea name="materiel[0][documents]" placeholder="Factures, certificats, garanties, expertises, etc."></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label>Instructions particulières</label>
                                                <textarea name="materiel[0][instructions]" placeholder="Instructions spéciales pour ce bien (entretien, utilisation, etc.)"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="button" class="add-person-btn" onclick="addAsset('materiel')">
                                        <i class="fas fa-plus"></i> Ajouter un bien matériel
                                    </button>
                                </div>
                            </div>

                            <div class="asset-category">
                                <div class="category-header" onclick="toggleCategory('personnels')">
                                    <div class="category-title">
                                        <i class="fas fa-book"></i> Biens personnels
                                    </div>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div id="personnels" class="category-content">
                                    <div id="personnels-container">
                                        <div class="asset-entry">
                                            <div class="form-group">
                                                <label>Type de bien personnel</label>
                                                <select name="personnels[0][type]">
                                                    <option value="">Sélectionner le type</option>
                                                    <option value="livres">Livres religieux/Coran</option>
                                                    <option value="vetements">Vêtements traditionnels</option>
                                                    <option value="souvenirs">Souvenirs de famille</option>
                                                    <option value="photos">Photos/Albums</option>
                                                    <option value="lettres">Lettres/Correspondances</option>
                                                    <option value="objets-religieux">Objets religieux</option>
                                                    <option value="autre">Autre</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Description</label>
                                                <textarea name="personnels[0][description]" placeholder="Description détaillée de ces biens personnels"></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label>Valeur sentimentale</label>
                                                <select name="personnels[0][valeurSentimentale]">
                                                    <option value="faible">Faible</option>
                                                    <option value="moyenne">Moyenne</option>
                                                    <option value="elevee">Élevée</option>
                                                    <option value="tres-elevee">Très élevée</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Valeur marchande (€)</label>
                                                <input type="number" name="personnels[0][valeur]" min="0" step="0.01" placeholder="Valeur estimée si applicable">
                                            </div>
                                            <div class="form-group">
                                                <label>Localisation</label>
                                                <input type="text" name="personnels[0][localisation]" placeholder="Où se trouvent ces biens">
                                            </div>
                                            <div class="form-group">
                                                <label>Destinataire souhaité</label>
                                                <input type="text" name="personnels[0][destinataire]" placeholder="Personne à qui vous souhaitez léguer ces biens">
                                            </div>
                                            <div class="form-group">
                                                <label>Instructions particulières</label>
                                                <textarea name="personnels[0][instructions]" placeholder="Instructions spéciales concernant ces biens personnels"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="button" class="add-person-btn" onclick="addAsset('personnels')">
                                        <i class="fas fa-plus"></i> Ajouter un bien personnel
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2 class="section-title"><i class="fas fa-university"></i> Comptes bancaires</h2>
                            
                            <div class="asset-category">
                                <div class="category-header" onclick="toggleCategory('comptes')">
                                    <div class="category-title">
                                        <i class="fas fa-piggy-bank"></i> Comptes et épargnes
                                    </div>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div id="comptes" class="category-content">
                                    <div id="comptes-container">
                                        <div class="asset-entry">
                                            <div class="form-group">
                                                <label>Type de compte</label>
                                                <select name="comptes[0][type]">
                                                    <option value="">Sélectionner le type</option>
                                                    <option value="courant">Compte courant</option>
                                                    <option value="epargne">Compte d'épargne</option>
                                                    <option value="livret">Livret</option>
                                                    <option value="pel">Plan Épargne Logement</option>
                                                    <option value="assurance-vie">Assurance vie</option>
                                                    <option value="actions">Compte-titres</option>
                                                    <option value="pea">Plan d'Épargne en Actions</option>
                                                    <option value="autre">Autre</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Nom de la banque</label>
                                                <input type="text" name="comptes[0][banque]" placeholder="Nom de l'établissement bancaire">
                                            </div>
                                            <div class="form-group">
                                                <label>Numéro de compte (IBAN)</label>
                                                <input type="text" name="comptes[0][numeroCompte]" placeholder="IBAN ou numéro de compte">
                                            </div>
                                            <div class="form-group">
                                                <label>Agence</label>
                                                <input type="text" name="comptes[0][agence]" placeholder="Nom et adresse de l'agence">
                                            </div>
                                            <div class="form-group">
                                                <label>Solde approximatif (€)</label>
                                                <input type="number" name="comptes[0][solde]" min="0" step="0.01" placeholder="Solde actuel approximatif">
                                            </div>
                                            <div class="form-group">
                                                <label>Titulaires du compte</label>
                                                <input type="text" name="comptes[0][titulaires]" placeholder="Nom des titulaires (joint, indivis, etc.)">
                                            </div>
                                            <div class="form-group">
                                                <label>Contact conseiller</label>
                                                <input type="text" name="comptes[0][conseiller]" placeholder="Nom et coordonnées du conseiller bancaire">
                                            </div>
                                            <div class="form-group">
                                                <label>Informations d'accès</label>
                                                <textarea name="comptes[0][acces]" placeholder="Informations pour accéder au compte (identifiants, localisation des documents, etc.)"></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label>Instructions particulières</label>
                                                <textarea name="comptes[0][instructions]" placeholder="Instructions spéciales concernant ce compte"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="button" class="add-person-btn" onclick="addAsset('comptes')">
                                        <i class="fas fa-plus"></i> Ajouter un compte
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2 class="section-title"><i class="fas fa-credit-card"></i> Cartes et accès bancaires</h2>
                            
                            <div class="asset-category">
                                <div class="category-header" onclick="toggleCategory('cartes')">
                                    <div class="category-title">
                                        <i class="fas fa-credit-card"></i> Cartes bancaires
                                    </div>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div id="cartes" class="category-content">
                                    <div id="cartes-container">
                                        <div class="asset-entry">
                                            <div class="form-group">
                                                <label>Type de carte</label>
                                                <select name="cartes[0][type]">
                                                    <option value="">Sélectionner le type</option>
                                                    <option value="visa">Visa</option>
                                                    <option value="mastercard">Mastercard</option>
                                                    <option value="amex">American Express</option>
                                                    <option value="autre">Autre</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Banque émettrice</label>
                                                <input type="text" name="cartes[0][banque]" placeholder="Nom de la banque">
                                            </div>
                                            <div class="form-group">
                                                <label>Numéro de carte (4 derniers chiffres seulement)</label>
                                                <input type="text" name="cartes[0][numero]" placeholder="**** **** **** 1234" maxlength="4">
                                            </div>
                                            <div class="form-group">
                                                <label>Date d'expiration</label>
                                                <input type="month" name="cartes[0][expiration]">
                                            </div>
                                            <div class="form-group">
                                                <label>Code PIN</label>
                                                <input type="password" name="cartes[0][pin]" placeholder="Code confidentiel" maxlength="4">
                                            </div>
                                            <div class="form-group">
                                                <label>Localisation de la carte</label>
                                                <input type="text" name="cartes[0][localisation]" placeholder="Où se trouve actuellement la carte">
                                            </div>
                                            <div class="form-group">
                                                <label>Instructions d'urgence</label>
                                                <textarea name="cartes[0][instructions]" placeholder="Instructions en cas de perte ou vol, numéros d'opposition, etc."></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="button" class="add-person-btn" onclick="addAsset('cartes')">
                                        <i class="fas fa-plus"></i> Ajouter une carte
                                    </button>
                                </div>
                            </div>

                            <div class="asset-category">
                                <div class="category-header" onclick="toggleCategory('applications')">
                                    <div class="category-title">
                                        <i class="fas fa-mobile-alt"></i> Applications bancaires
                                    </div>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div id="applications" class="category-content">
                                    <div id="applications-container">
                                        <div class="asset-entry">
                                            <div class="form-group">
                                                <label>Nom de l'application</label>
                                                <input type="text" name="applications[0][nom]" placeholder="Nom de l'application bancaire">
                                            </div>
                                            <div class="form-group">
                                                <label>Banque</label>
                                                <input type="text" name="applications[0][banque]" placeholder="Nom de la banque">
                                            </div>
                                            <div class="form-group">
                                                <label>Identifiant utilisateur</label>
                                                <input type="text" name="applications[0][identifiant]" placeholder="Nom d'utilisateur ou identifiant client">
                                            </div>
                                            <div class="form-group">
                                                <label>Mot de passe</label>
                                                <input type="password" name="applications[0][motdepasse]" placeholder="Mot de passe de l'application">
                                            </div>
                                            <div class="form-group">
                                                <label>Code d'accès/PIN app</label>
                                                <input type="password" name="applications[0][codeapp]" placeholder="Code PIN de l'application">
                                            </div>
                                            <div class="form-group">
                                                <label>Appareils configurés</label>
                                                <textarea name="applications[0][appareils]" placeholder="Liste des appareils sur lesquels l'application est installée"></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label>Authentification à deux facteurs</label>
                                                <textarea name="applications[0][2fa]" placeholder="Informations sur l'authentification à deux facteurs (SMS, authentificator, etc.)"></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label>Instructions de récupération</label>
                                                <textarea name="applications[0][recuperation]" placeholder="Instructions pour récupérer l'accès au compte en cas de problème"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="button" class="add-person-btn" onclick="addAsset('applications')">
                                        <i class="fas fa-plus"></i> Ajouter une application
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="total-assets">
                        <h3>Récapitulatif des biens</h3>
                        <div class="total-value" id="totalValue">Calcul automatique...</div>
                        <p>Total estimé de votre patrimoine (sera calculé automatiquement)</p>
                        <div class="form-group">
                            <label for="evaluationDate">Date de la dernière évaluation</label>
                            <input type="date" id="evaluationDate" name="evaluationDate">
                        </div>
                        <div class="form-group">
                            <label for="evaluationNotes">Notes sur l'évaluation</label>
                            <textarea id="evaluationNotes" name="evaluationNotes" placeholder="Précisions sur l'évaluation du patrimoine, expertise récente, etc."></textarea>
                        </div>
                    </div>
                </div>
                <!-- Étape 4: Dettes, créances et Zakat -->
                <div id="step4" class="form-step" style="display: none;">
                    <div class="form-container">
                        <div class="form-section">
                            <h2 class="section-title"><i class="fas fa-calculator"></i> Calcul de la Zakat</h2>
                            
                            <div class="zakat-calculator">
                                <div class="form-group">
                                    <label for="zakatEpargne">Épargne et liquidités (€)</label>
                                    <input type="number" id="zakatEpargne" name="zakatEpargne" min="0" step="0.01" oninput="calculerZakat()" placeholder="Montant total de vos liquidités">
                                </div>

                                <div class="form-group">
                                    <label for="zakatOr">Or et bijoux en or (€)</label>
                                    <input type="number" id="zakatOr" name="zakatOr" min="0" step="0.01" oninput="calculerZakat()" placeholder="Valeur de vos bijoux et or">
                                </div>

                                <div class="form-group">
                                    <label for="zakatArgent">Argent et bijoux en argent (€)</label>
                                    <input type="number" id="zakatArgent" name="zakatArgent" min="0" step="0.01" oninput="calculerZakat()" placeholder="Valeur de vos bijoux et argent">
                                </div>

                                <div class="form-group">
                                    <label for="zakatInvestissements">Investissements et placements (€)</label>
                                    <input type="number" id="zakatInvestissements" name="zakatInvestissements" min="0" step="0.01" oninput="calculerZakat()" placeholder="Actions, obligations, fonds, crypto-monnaies">
                                </div>

                                <div class="form-group">
                                    <label for="zakatCommerce">Marchandises commerciales (€)</label>
                                    <input type="number" id="zakatCommerce" name="zakatCommerce" min="0" step="0.01" oninput="calculerZakat()" placeholder="Stock de marchandises destinées à la vente">
                                </div>

                                <div class="form-group">
                                    <label for="zakatCreances">Créances recouvrables (€)</label>
                                    <input type="number" id="zakatCreances" name="zakatCreances" min="0" step="0.01" oninput="calculerZakat()" placeholder="Argent que l'on vous doit">
                                </div>

                                <div class="form-group">
                                    <label for="zakatDettes">Dettes à déduire (€)</label>
                                    <input type="number" id="zakatDettes" name="zakatDettes" min="0" step="0.01" oninput="calculerZakat()" placeholder="Montant total de vos dettes">
                                </div>

                                <div class="calculator-result" id="zakatResult">
                                    <h4>Résultat du calcul de Zakat</h4>
                                    <p><strong>Patrimoine soumis à Zakat :</strong> <span id="zakatPatrimoine">0 €</span></p>
                                    <p><strong>Nissab (seuil minimum) :</strong> <span id="zakatNissab">4 914 €</span></p>
                                    <p><strong>Zakat due (2,5%) :</strong> <span id="zakatMontant">0 €</span></p>
                                    <div id="zakatStatus"></div>
                                    <div class="form-group" style="margin-top: 15px;">
                                        <label for="zakatDerniereAnnee">Dernière année de paiement de la Zakat</label>
                                        <input type="number" id="zakatDerniereAnnee" name="zakatDerniereAnnee" min="1400" max="1500" placeholder="Année hégirienne">
                                    </div>
                                    <div class="form-group">
                                        <label for="zakatBeneficiaires">Bénéficiaires habituels de votre Zakat</label>
                                        <textarea id="zakatBeneficiaires" name="zakatBeneficiaires" placeholder="Organisations, mosquées, ou personnes à qui vous versez habituellement la Zakat"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2 class="section-title"><i class="fas fa-handshake"></i> Dettes et créances</h2>
                            
                            <div class="asset-category">
                                <div class="category-header" onclick="toggleCategory('dettes')">
                                    <div class="category-title">
                                        <i class="fas fa-money-bill-wave"></i> Dettes à rembourser
                                    </div>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div id="dettes" class="category-content">
                                    <div id="dettes-container">
                                        <div class="asset-entry">
                                            <div class="form-group">
                                                <label>Type de dette</label>
                                                <select name="dettes[0][type]">
                                                    <option value="">Sélectionner le type</option>
                                                    <option value="pret-bancaire">Prêt bancaire</option>
                                                    <option value="pret-immobilier">Prêt immobilier</option>
                                                    <option value="pret-personnel">Prêt personnel</option>
                                                    <option value="carte-credit">Carte de crédit</option>
                                                    <option value="pret-famille">Prêt familial</option>
                                                    <option value="pret-ami">Prêt d'un ami</option>
                                                    <option value="factures">Factures impayées</option>
                                                    <option value="impots">Impôts/Taxes</option>
                                                    <option value="autre">Autre</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Créancier</label>
                                                <input type="text" name="dettes[0][creancier]" placeholder="Nom de la banque, personne ou organisme">
                                            </div>
                                            <div class="form-group">
                                                <label>Montant total dû (€)</label>
                                                <input type="number" name="dettes[0][montant]" min="0" step="0.01" placeholder="Montant restant à rembourser">
                                            </div>
                                            <div class="form-group">
                                                <label>Mensualité (€)</label>
                                                <input type="number" name="dettes[0][mensualite]" min="0" step="0.01" placeholder="Montant des mensualités">
                                            </div>
                                            <div class="form-group">
                                                <label>Date de fin prévue</label>
                                                <input type="date" name="dettes[0][dateFin]">
                                            </div>
                                            <div class="form-group">
                                                <label>Coordonnées du créancier</label>
                                                <textarea name="dettes[0][coordonnees]" placeholder="Adresse, téléphone, email du créancier"></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label>Numéro de contrat/dossier</label>
                                                <input type="text" name="dettes[0][numeroContrat]" placeholder="Référence du contrat ou du dossier">
                                            </div>
                                            <div class="form-group">
                                                <label>Documents liés</label>
                                                <textarea name="dettes[0][documents]" placeholder="Localisation des contrats, échéanciers, etc."></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label>Instructions particulières</label>
                                                <textarea name="dettes[0][instructions]" placeholder="Instructions spéciales pour le remboursement de cette dette"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="button" class="add-person-btn" onclick="addAsset('dettes')">
                                        <i class="fas fa-plus"></i> Ajouter une dette
                                    </button>
                                </div>
                            </div>

                            <div class="asset-category">
                                <div class="category-header" onclick="toggleCategory('creances')">
                                    <div class="category-title">
                                        <i class="fas fa-receipt"></i> Créances à récupérer
                                    </div>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div id="creances" class="category-content">
                                    <div id="creances-container">
                                        <div class="asset-entry">
                                            <div class="form-group">
                                                <label>Type de créance</label>
                                                <select name="creances[0][type]">
                                                    <option value="">Sélectionner le type</option>
                                                    <option value="pret-famille">Prêt à la famille</option>
                                                    <option value="pret-ami">Prêt à un ami</option>
                                                    <option value="salaire">Salaire dû</option>
                                                    <option value="remboursement">Remboursement dû</option>
                                                    <option value="caution">Caution à récupérer</option>
                                                    <option value="investissement">Retour d'investissement</option>
                                                    <option value="autre">Autre</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Débiteur</label>
                                                <input type="text" name="creances[0][debiteur]" placeholder="Nom de la personne ou organisme qui vous doit de l'argent">
                                            </div>
                                            <div class="form-group">
                                                <label>Montant dû (€)</label>
                                                <input type="number" name="creances[0][montant]" min="0" step="0.01" placeholder="Montant total de la créance">
                                            </div>
                                            <div class="form-group">
                                                <label>Date de l'engagement</label>
                                                <input type="date" name="creances[0][dateEngagement]">
                                            </div>
                                            <div class="form-group">
                                                <label>Date d'échéance</label>
                                                <input type="date" name="creances[0][dateEcheance]">
                                            </div>
                                            <div class="form-group">
                                                <label>Coordonnées du débiteur</label>
                                                <textarea name="creances[0][coordonnees]" placeholder="Adresse, téléphone, email du débiteur"></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label>Preuves/Documents</label>
                                                <textarea name="creances[0][preuves]" placeholder="Localisation des preuves : contrat, reconnaissance de dette, emails, témoins, etc."></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label>Probabilité de récupération</label>
                                                <select name="creances[0][probabilite]">
                                                    <option value="elevee">Élevée</option>
                                                    <option value="moyenne">Moyenne</option>
                                                    <option value="faible">Faible</option>
                                                    <option value="nulle">Nulle</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Instructions de recouvrement</label>
                                                <textarea name="creances[0][instructions]" placeholder="Instructions pour récupérer cette créance"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="button" class="add-person-btn" onclick="addAsset('creances')">
                                        <i class="fas fa-plus"></i> Ajouter une créance
                                    </button>
                                </div>
                            </div>

                            <div class="asset-category">
                                <div class="category-header" onclick="toggleCategory('dons-sadaqat')">
                                    <div class="category-title">
                                        <i class="fas fa-hand-holding-heart"></i> Dons et Sadaqat réguliers
                                    </div>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div id="dons-sadaqat" class="category-content">
                                    <div id="dons-sadaqat-container">
                                        <div class="asset-entry">
                                            <div class="form-group">
                                                <label>Type de don</label>
                                                <select name="dons-sadaqat[0][type]">
                                                    <option value="">Sélectionner le type</option>
                                                    <option value="zakat">Zakat</option>
                                                    <option value="sadaqa">Sadaqa</option>
                                                    <option value="mosquee">Don à la mosquée</option>
                                                    <option value="orphelinat">Don à un orphelinat</option>
                                                    <option value="education">Don pour l'éducation</option>
                                                    <option value="pauvres">Aide aux pauvres</option>
                                                    <option value="autre">Autre</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Bénéficiaire</label>
                                                <input type="text" name="dons-sadaqat[0][beneficiaire]" placeholder="Nom de l'organisation ou de la personne">
                                            </div>
                                            <div class="form-group">
                                                <label>Montant annuel (€)</label>
                                                <input type="number" name="dons-sadaqat[0][montant]" min="0" step="0.01" placeholder="Montant versé annuellement">
                                            </div>
                                            <div class="form-group">
                                                <label>Fréquence</label>
                                                <select name="dons-sadaqat[0][frequence]">
                                                    <option value="mensuel">Mensuel</option>
                                                    <option value="trimestriel">Trimestriel</option>
                                                    <option value="semestriel">Semestriel</option>
                                                    <option value="annuel">Annuel</option>
                                                    <option value="ramadan">Pendant le Ramadan</option>
                                                    <option value="occasionnel">Occasionnel</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Mode de versement</label>
                                                <select name="dons-sadaqat[0][mode]">
                                                    <option value="virement">Virement bancaire</option>
                                                    <option value="cheque">Chèque</option>
                                                    <option value="especes">Espèces</option>
                                                    <option value="prelevement">Prélèvement automatique</option>
                                                    <option value="autre">Autre</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Coordonnées du bénéficiaire</label>
                                                <textarea name="dons-sadaqat[0][coordonnees]" placeholder="Adresse, IBAN, téléphone du bénéficiaire"></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label>Instructions de continuité</label>
                                                <textarea name="dons-sadaqat[0][instructions]" placeholder="Souhaitez-vous que ces dons continuent après votre décès ? Instructions particulières."></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="button" class="add-person-btn" onclick="addAsset('dons-sadaqat')">
                                        <i class="fas fa-plus"></i> Ajouter un don/sadaqa
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Étape 5: Héritage islamique et legs -->
                <div id="step5" class="form-step" style="display: none;">
                    <div class="heritage-section">
                        <h2 class="heritage-title"><i class="fas fa-balance-scale"></i> Répartition selon l'héritage islamique</h2>
                        
                        <div class="heritage-note">
                            <p><strong>Information importante :</strong> La répartition de l'héritage en Islam suit des règles précises établies par le Coran et la Sunna. Cette section vous aide à organiser vos legs conformément à la loi islamique.</p>
                            <p><strong>Rappel :</strong> Les legs (wassiya) ne peuvent excéder 1/3 du patrimoine total et ne peuvent pas bénéficier aux héritiers légaux sauf accord de tous les héritiers.</p>
                        </div>

                        <div class="legs-container">
                            <h3>Legs spécifiques (wassiya) - Maximum 1/3 du patrimoine</h3>
                            <div id="legs-container">
                                <div class="leg-entry">
                                    <div class="form-group">
                                        <label>Type de legs</label>
                                        <select name="legs[0][type]">
                                            <option value="">Sélectionner le type</option>
                                            <option value="monetaire">Legs monétaire</option>
                                            <option value="bien-specifique">Bien spécifique</option>
                                            <option value="pourcentage">Pourcentage du patrimoine</option>
                                            <option value="usufruit">Usufruit</option>
                                            <option value="autre">Autre</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Bénéficiaire</label>
                                        <input type="text" name="legs[0][beneficiaire]" placeholder="Nom complet du bénéficiaire">
                                    </div>
                                    <div class="form-group">
                                        <label>Relation avec le bénéficiaire</label>
                                        <input type="text" name="legs[0][relation]" placeholder="Ami, œuvre caritative, mosquée, etc.">
                                    </div>
                                    <div class="form-group">
                                        <label>Description détaillée du legs</label>
                                        <textarea name="legs[0][description]" placeholder="Description précise de ce que vous léguez"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label>Valeur ou montant (€)</label>
                                        <input type="number" name="legs[0][valeur]" min="0" step="0.01" oninput="updateLegsTotal()" placeholder="Valeur estimée en euros">
                                    </div>
                                    <div class="form-group">
                                        <label>Coordonnées du bénéficiaire</label>
                                        <textarea name="legs[0][coordonnees]" placeholder="Adresse complète, téléphone, email du bénéficiaire"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label>Conditions particulières</label>
                                        <textarea name="legs[0][conditions]" placeholder="Conditions ou restrictions pour ce legs"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label>Instructions d'exécution</label>
                                        <textarea name="legs[0][instructions]" placeholder="Instructions détaillées pour l'exécution de ce legs"></textarea>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="add-person-btn" onclick="addLeg()">
                                <i class="fas fa-plus"></i> Ajouter un legs
                            </button>

                            <div class="legs-summary" id="legsSummary">
                                <div><strong>Total des legs :</strong> <span id="totalLegs">0 €</span></div>
                                <div><strong>Maximum autorisé (1/3) :</strong> <span id="maxLegs">Calculé automatiquement</span></div>
                                <div id="legsWarning" class="warning" style="display: none;">
                                    ⚠️ Attention : Le total des legs dépasse le tiers autorisé par l'Islam
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Instructions pour l'héritage légal</h3>
                            <div class="form-group">
                                <label for="heritageInstructions">Instructions générales pour la répartition</label>
                                <textarea id="heritageInstructions" name="heritageInstructions" placeholder="Instructions générales concernant la répartition de votre héritage selon les règles islamiques"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="evaluationPatrimoine">Méthode d'évaluation du patrimoine</label>
                                <textarea id="evaluationPatrimoine" name="evaluationPatrimoine" placeholder="Instructions sur la façon d'évaluer votre patrimoine (expert, estimation, etc.)"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="fraisObseques">Instructions pour les frais d'obsèques</label>
                                <textarea id="fraisObseques" name="fraisObseques" placeholder="Instructions concernant le paiement des frais d'obsèques et funérailles"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="dettesHeritag">Instructions pour les dettes</label>
                                <textarea id="dettesHeritage" name="dettesHeritage" placeholder="Instructions concernant le remboursement des dettes avant répartition"></textarea>
                            </div>

                            <button type="button" class="btn btn-primary" onclick="calculerHeritage()">
                                <i class="fas fa-calculator"></i> Calculer la répartition islamique
                            </button>
                            
                            <div class="heritage-grid" id="heritageGrid" style="display: none;">
                                <!-- Les résultats du calcul apparaîtront ici -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Étape 6: Comptes numériques et mots de passe -->
                <div id="step6" class="form-step" style="display: none;">
                    <div class="form-container">
                        <div class="form-section">
                            <h2 class="section-title"><i class="fas fa-laptop"></i> Comptes numériques</h2>
                            
                            <div class="asset-category">
                                <div class="category-header" onclick="toggleCategory('emails')">
                                    <div class="category-title">
                                        <i class="fas fa-envelope"></i> Comptes email
                                    </div>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div id="emails" class="category-content">
                                    <div id="emails-container">
                                        <div class="asset-entry">
                                            <div class="form-group">
                                                <label>Fournisseur d'email</label>
                                                <select name="emails[0][fournisseur]">
                                                    <option value="">Sélectionner</option>
                                                    <option value="gmail">Gmail</option>
                                                    <option value="outlook">Outlook/Hotmail</option>
                                                    <option value="yahoo">Yahoo</option>
                                                    <option value="apple">iCloud/Apple</option>
                                                    <option value="professionnel">Email professionnel</option>
                                                    <option value="autre">Autre</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Adresse email</label>
                                                <input type="email" name="emails[0][adresse]" placeholder="exemple@email.com">
                                            </div>
                                            <div class="form-group">
                                                <label>Mot de passe</label>
                                                <input type="password" name="emails[0][motdepasse]" placeholder="Mot de passe du compte">
                                            </div>
                                            <div class="form-group">
                                                <label>Téléphone de récupération</label>
                                                <input type="tel" name="emails[0][telephone]" placeholder="Numéro associé au compte">
                                            </div>
                                            <div class="form-group">
                                                <label>Email de récupération</label>
                                                <input type="email" name="emails[0][emailRecup]" placeholder="Email de récupération">
                                            </div>
                                            <div class="form-group">
                                                <label>Questions de sécurité</label>
                                                <textarea name="emails[0][questions]" placeholder="Questions et réponses de sécurité"></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label>Authentification à deux facteurs</label>
                                                <textarea name="emails[0][2fa]" placeholder="Informations sur la double authentification (app, SMS, etc.)"></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label>Utilisation principale</label>
                                                <input type="text" name="emails[0][utilisation]" placeholder="Personnel, professionnel, achats en ligne, etc.">
                                            </div>
                                            <div class="form-group">
                                                <label>Instructions</label>
                                                <textarea name="emails[0][instructions]" placeholder="Que faire avec ce compte email après votre décès ?"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="button" class="add-person-btn" onclick="addDigitalAccount('emails')">
                                        <i class="fas fa-plus"></i> Ajouter un compte email
                                    </button>
                                </div>
                            </div>

                            <div class="asset-category">
                                <div class="category-header" onclick="toggleCategory('reseaux-sociaux')">
                                    <div class="category-title">
                                        <i class="fas fa-share-alt"></i> Réseaux sociaux
                                    </div>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div id="reseaux-sociaux" class="category-content">
                                    <div id="reseaux-sociaux-container">
                                        <div class="asset-entry">
                                            <div class="form-group">
                                                <label>Plateforme</label>
                                                <select name="reseaux-sociaux[0][plateforme]">
                                                    <option value="">Sélectionner</option>
                                                    <option value="facebook">Facebook</option>
                                                    <option value="instagram">Instagram</option>
                                                    <option value="twitter">Twitter/X</option>
                                                    <option value="linkedin">LinkedIn</option>
                                                    <option value="tiktok">TikTok</option>
                                                    <option value="snapchat">Snapchat</option>
                                                    <option value="youtube">YouTube</option>
                                                    <option value="whatsapp">WhatsApp Business</option>
                                                    <option value="autre">Autre</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Nom d'utilisateur</label>
                                                <input type="text" name="reseaux-sociaux[0][username]" placeholder="@nomutilisateur ou nom d'utilisateur">
                                            </div>
                                            <div class="form-group">
                                                <label>Email associé</label>
                                                <input type="email" name="reseaux-sociaux[0][email]" placeholder="Email utilisé pour ce compte">
                                            </div>
                                            <div class="form-group">
                                                <label>Mot de passe</label>
                                                <input type="password" name="reseaux-sociaux[0][motdepasse]" placeholder="Mot de passe du compte">
                                            </div>
                                            <div class="form-group">
                                                <label>Téléphone associé</label>
                                                <input type="tel" name="reseaux-sociaux[0][telephone]" placeholder="Numéro lié au compte">
                                            </div>
                                            <div class="form-group">
                                                <label>Authentification à deux facteurs</label>
                                                <textarea name="reseaux-sociaux[0][2fa]" placeholder="Informations sur la double authentification"></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label>Utilisation du compte</label>
                                                <select name="reseaux-sociaux[0][utilisation]">
                                                    <option value="personnel">Personnel</option>
                                                    <option value="professionnel">Professionnel</option>
                                                    <option value="business">Business</option>
                                                    <option value="dawah">Da'wah/Religieux</option>
                                                    <option value="autre">Autre</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Instructions</label>
                                                <textarea name="reseaux-sociaux[0][instructions]" placeholder="Souhaitez-vous supprimer le compte, le transformer en mémorial, le transférer ?"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="button" class="add-person-btn" onclick="addDigitalAccount('reseaux-sociaux')">
                                        <i class="fas fa-plus"></i> Ajouter un réseau social
                                    </button>
                                </div>
                            </div>

                            <div class="asset-category">
                                <div class="category-header" onclick="toggleCategory('services-en-ligne')">
                                    <div class="category-title">
                                        <i class="fas fa-cloud"></i> Services en ligne
                                    </div>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div id="services-en-ligne" class="category-content">
                                    <div id="services-en-ligne-container">
                                        <div class="asset-entry">
                                            <div class="form-group">
                                                <label>Type de service</label>
                                                <select name="services-en-ligne[0][type]">
                                                    <option value="">Sélectionner</option>
                                                    <option value="streaming">Streaming (Netflix, Prime, etc.)</option>
                                                    <option value="cloud">Stockage cloud (Google Drive, iCloud, etc.)</option>
                                                    <option value="ecommerce">E-commerce (Amazon, etc.)</option>
                                                    <option value="finance">Services financiers en ligne</option>
                                                    <option value="education">Plateformes éducatives</option>
                                                    <option value="professionnel">Services professionnels</option>
                                                    <option value="autre">Autre</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Nom du service</label>
                                                <input type="text" name="services-en-ligne[0][nom]" placeholder="Netflix, Amazon, Dropbox, etc.">
                                            </div>
                                            <div class="form-group">
                                                <label>Identifiant/Email</label>
                                                <input type="text" name="services-en-ligne[0][identifiant]" placeholder="Nom d'utilisateur ou email">
                                            </div>
                                            <div class="form-group">
                                                <label>Mot de passe</label>
                                                <input type="password" name="services-en-ligne[0][motdepasse]" placeholder="Mot de passe du service">
                                            </div>
                                            <div class="form-group">
                                                <label>Type d'abonnement</label>
                                                <input type="text" name="services-en-ligne[0][abonnement]" placeholder="Gratuit, Premium, Famille, etc.">
                                            </div>
                                            <div class="form-group">
                                                <label>Coût mensuel/annuel (€)</label>
                                                <input type="number" name="services-en-ligne[0][cout]" min="0" step="0.01" placeholder="Coût de l'abonnement">
                                            </div>
                                            <div class="form-group">
                                                <label>Mode de paiement</label>
                                                <input type="text" name="services-en-ligne[0][paiement]" placeholder="Carte bancaire, PayPal, etc.">
                                            </div>
                                            <div class="form-group">
                                                <label>Date de renouvellement</label>
                                                <input type="date" name="services-en-ligne[0][renouvellement]">
                                            </div>
                                            <div class="form-group">
                                                <label>Données importantes</label>
                                                <textarea name="services-en-ligne[0][donnees]" placeholder="Photos, documents, playlists, ou autres données importantes sur ce service"></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label>Instructions</label>
                                                <textarea name="services-en-ligne[0][instructions]" placeholder="Que faire avec ce service et ses données ?"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="button" class="add-person-btn" onclick="addDigitalAccount('services-en-ligne')">
                                        <i class="fas fa-plus"></i> Ajouter un service
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2 class="section-title"><i class="fas fa-mobile-alt"></i> Appareils et mots de passe</h2>
                            
                            <div class="asset-category">
                                <div class="category-header" onclick="toggleCategory('appareils')">
                                    <div class="category-title">
                                        <i class="fas fa-phone"></i> Appareils électroniques
                                    </div>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div id="appareils" class="category-content">
                                    <div id="appareils-container">
                                        <div class="asset-entry">
                                            <div class="form-group">
                                                <label>Type d'appareil</label>
                                                <select name="appareils[0][type]">
                                                    <option value="">Sélectionner</option>
                                                    <option value="smartphone">Smartphone</option>
                                                    <option value="tablette">Tablette</option>
                                                    <option value="ordinateur-portable">Ordinateur portable</option>
                                                    <option value="ordinateur-fixe">Ordinateur fixe</option>
                                                    <option value="montre-connectee">Montre connectée</option>
                                                    <option value="autre">Autre</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Marque et modèle</label>
                                                <input type="text" name="appareils[0][modele]" placeholder="iPhone 13, Samsung Galaxy, MacBook Pro, etc.">
                                            </div>
                                            <div class="form-group">
                                                <label>Système d'exploitation</label>
                                                <select name="appareils[0][os]">
                                                    <option value="">Sélectionner</option>
                                                    <option value="ios">iOS</option>
                                                    <option value="android">Android</option>
                                                    <option value="windows">Windows</option>
                                                    <option value="macos">macOS</option>
                                                    <option value="linux">Linux</option>
                                                    <option value="autre">Autre</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Code de déverrouillage/PIN</label>
                                                <input type="password" name="appareils[0][code]" placeholder="Code, motif, ou PIN de déverrouillage">
                                            </div>
                                            <div class="form-group">
                                                <label>Mot de passe utilisateur</label>
                                                <input type="password" name="appareils[0][motdepasse]" placeholder="Mot de passe de session utilisateur">
                                            </div>
                                            <div class="form-group">
                                                <label>Authentification biométrique</label>
                                                <input type="text" name="appareils[0][biometrie]" placeholder="Empreinte digitale, Face ID, reconnaissance vocale">
                                            </div>
                                            <div class="form-group">
                                                <label>Localisation actuelle</label>
                                                <input type="text" name="appareils[0][localisation]" placeholder="Où se trouve actuellement cet appareil">
                                            </div>
                                            <div class="form-group">
                                                <label>Comptes principaux connectés</label>
                                                <textarea name="appareils[0][comptes]" placeholder="Apple ID, Google Account, Microsoft, etc."></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label>Applications importantes</label>
                                                <textarea name="appareils[0][applications]" placeholder="Applications contenant des données importantes"></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label>Données importantes</label>
                                                <textarea name="appareils[0][donnees]" placeholder="Photos, vidéos, documents, contacts importants sur cet appareil"></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label>Sauvegardes</label>
                                                <textarea name="appareils[0][sauvegardes]" placeholder="Informations sur les sauvegardes (iCloud, Google, etc.)"></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label>Instructions d'accès</label>
                                                <textarea name="appareils[0][instructions]" placeholder="Instructions détaillées pour accéder à cet appareil"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="button" class="add-person-btn" onclick="addDevice()">
                                        <i class="fas fa-plus"></i> Ajouter un appareil
                                    </button>
                                </div>
                            </div>

                            <div class="privacy-notice">
                                <i class="fas fa-exclamation-triangle"></i> <strong>Sécurité critique :</strong> Les mots de passe et codes d'accès sont des informations extrêmement sensibles. Assurez-vous que ce document soit conservé dans un lieu parfaitement sécurisé et accessible uniquement aux personnes de confiance désignées comme exécuteurs testamentaires.
                            </div>

                            <div class="form-group">
                                <label for="gestionnaireMdp">Gestionnaire de mots de passe</label>
                                <input type="text" id="gestionnaireMdp" name="gestionnaireMdp" placeholder="LastPass, 1Password, Bitwarden, etc.">
                            </div>

                            <div class="form-group">
                                <label for="motDePasseMaitre">Mot de passe maître du gestionnaire</label>
                                <input type="password" id="motDePasseMaitre" name="motDePasseMaitre" placeholder="Mot de passe principal du gestionnaire">
                            </div>

                            <div class="form-group">
                                <label for="instructionsNumeriques">Instructions générales pour les comptes numériques</label>
                                <textarea id="instructionsNumeriques" name="instructionsNumeriques" placeholder="Instructions générales concernant tous vos comptes numériques : fermeture, transfert, sauvegarde des données, transformation en mémorial, etc. Précisez également qui peut accéder à quoi et dans quelles circonstances."></textarea>
                            </div>

                            <div class="form-group">
                                <label for="contactTechnique">Contact technique de confiance</label>
                                <input type="text" id="contactTechnique" name="contactTechnique" placeholder="Nom et coordonnées d'une personne compétente techniquement">
                            </div>

                            <div class="form-group">
                                <label for="documentsNumeriques">Documents numériques importants</label>
                                <textarea id="documentsNumeriques" name="documentsNumeriques" placeholder="Localisation de vos documents numériques importants : testaments, contrats, photos de famille, etc."></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Actions de navigation -->
                <div class="actions">
                    <button type="button" class="btn btn-secondary" id="prevStep" onclick="previousStep()" style="display: none;">
                        <i class="fas fa-arrow-left"></i> Étape précédente
                    </button>
                    
                    <button type="button" class="btn btn-primary" id="nextStep" onclick="nextStep()">
                        Étape suivante <i class="fas fa-arrow-right"></i>
                    </button>
                    
                    <button type="button" class="btn btn-secondary" onclick="sauvegarderBrouillon()">
                        <i class="fas fa-save"></i> Sauvegarder brouillon
                    </button>
                </div>

                <!-- Actions finales (affichées à la dernière étape) -->
                <div id="finalActions" class="actions" style="display: none;">
                    <button type="button" class="btn btn-primary" onclick="genererPDF()">
                        <i class="fas fa-file-pdf"></i> Générer le PDF
                    </button>
                    
                    <button type="button" class="btn btn-secondary" onclick="envoyerParEmail()">
                        <i class="fas fa-envelope"></i> Envoyer par email
                    </button>
                    
                    <button type="button" class="btn btn-secondary" onclick="imprimerTestament()">
                        <i class="fas fa-print"></i> Imprimer
                    </button>
                </div>
            </form>
        </main>

        <!-- Section de partage -->
        <div class="share-section">
            <div class="share-title">Partager Al Wassiya</div>
            <div class="share-buttons">
                <div class="share-btn whatsapp" onclick="partagerWhatsApp()">
                    <i class="fab fa-whatsapp"></i>
                </div>
                <div class="share-btn facebook" onclick="partagerFacebook()">
                    <i class="fab fa-facebook-f"></i>
                </div>
                <div class="share-btn twitter" onclick="partagerTwitter()">
                    <i class="fab fa-twitter"></i>
                </div>
                <div class="share-btn email" onclick="partagerEmail()">
                    <i class="fas fa-envelope"></i>
                </div>
            </div>
        </div>

        <!-- Note de fin -->
        <div class="footer-note">
            <p><strong>Note importante :</strong> Ce testament est un outil d'aide à la rédaction basé sur les principes islamiques. Nous recommandons fortement de consulter un juriste spécialisé en droit islamique et/ou un imam qualifié pour valider le contenu selon votre situation personnelle et la législation de votre pays de résidence.</p>
            <p><strong>Responsabilité :</strong> Al Wassiya facilite la préparation de votre testament islamique mais ne remplace pas un conseil juridique professionnel. Chaque situation familiale étant unique, une consultation avec des experts est recommandée.</p>
            <p><strong>Qu'Allah vous facilite dans cette démarche pieuse et accepte vos bonnes œuvres. Amin.</strong></p>
        </div>
    </div>

    <!-- Indicateur de sauvegarde -->
    <div class="save-indicator" id="saveIndicator">
        <i class="fas fa-check"></i> Sauvegardé automatiquement
    </div>
    <script>
        // Variables globales
        let currentStep = 1;
        const totalSteps = 6;
        let currentLanguage = 'fr';
        let totalPatrimoine = 0;

        // MODIFICATION 6: Traductions pour le multilingue
        const translations = {
            fr: {
                'step1': 'Étape 1 sur 6 : Informations personnelles et volontés générales',
                'step2': 'Étape 2 sur 6 : Famille et proches',
                'step3': 'Étape 3 sur 6 : Biens matériels et financiers',
                'step4': 'Étape 4 sur 6 : Dettes, créances et Zakat',
                'step5': 'Étape 5 sur 6 : Héritage islamique et legs',
                'step6': 'Étape 6 sur 6 : Comptes numériques et finalisation',
                'prevStep': 'Étape précédente',
                'nextStep': 'Étape suivante',
                'finalizeStep': 'Finaliser le testament',
                'title': 'Al Wassiya - Testament Islamique',
                'subtitle': 'الوصية',
                'generatePdf': 'Générer le PDF',
                'sendEmail': 'Envoyer par email',
                'print': 'Imprimer',
                'save': 'Sauvegarder brouillon'
            },
            ar: {
                'step1': 'الخطوة 1 من 6: المعلومات الشخصية والأمنيات العامة',
                'step2': 'الخطوة 2 من 6: العائلة والأقارب',
                'step3': 'الخطوة 3 من 6: الممتلكات المادية والمالية',
                'step4': 'الخطوة 4 من 6: الديون والمستحقات والزكاة',
                'step5': 'الخطوة 5 من 6: الميراث الإسلامي والوصايا',
                'step6': 'الخطوة 6 من 6: الحسابات الرقمية والإنهاء',
                'prevStep': 'الخطوة السابقة',
                'nextStep': 'الخطوة التالية',
                'finalizeStep': 'إنهاء الوصية',
                'title': 'الوصية - الوصية الإسلامية',
                'subtitle': 'Al Wassiya',
                'generatePdf': 'إنشاء ملف PDF',
                'sendEmail': 'إرسال بالبريد الإلكتروني',
                'print': 'طباعة',
                'save': 'حفظ المسودة'
            }
        };

        // MODIFICATION 6: Fonction de changement de langue
        function switchLanguage(lang) {
            currentLanguage = lang;
            const root = document.getElementById('html-root');
            
            // Mise à jour des boutons de langue
            document.getElementById('lang-fr').classList.toggle('active', lang === 'fr');
            document.getElementById('lang-ar').classList.toggle('active', lang === 'ar');
            
            // Configuration RTL pour l'arabe
            if (lang === 'ar') {
                root.setAttribute('dir', 'rtl');
                root.setAttribute('lang', 'ar');
            } else {
                root.setAttribute('dir', 'ltr');
                root.setAttribute('lang', 'fr');
            }
            
            // Mise à jour des textes
            updateLanguageTexts();
            updateStepIndicator();
            updateNavigationButtons();
        }

        function updateLanguageTexts() {
            const lang = translations[currentLanguage];
            
            // Mise à jour des boutons principaux
            const generateBtn = document.querySelector('[onclick="genererPDF()"]');
            const emailBtn = document.querySelector('[onclick="envoyerParEmail()"]');
            const printBtn = document.querySelector('[onclick="imprimerTestament()"]');
            const saveBtn = document.querySelector('[onclick="sauvegarderBrouillon()"]');
            
            if (generateBtn) generateBtn.innerHTML = `<i class="fas fa-file-pdf"></i> ${lang.generatePdf}`;
            if (emailBtn) emailBtn.innerHTML = `<i class="fas fa-envelope"></i> ${lang.sendEmail}`;
            if (printBtn) printBtn.innerHTML = `<i class="fas fa-print"></i> ${lang.print}`;
            if (saveBtn) saveBtn.innerHTML = `<i class="fas fa-save"></i> ${lang.save}`;
            
            // Mise à jour du titre si nécessaire
            document.title = lang.title;
        }

        // Initialisation au chargement de la page
        document.addEventListener('DOMContentLoaded', function() {
            // Définir la date actuelle pour les champs de date
            const today = new Date().toISOString().split('T')[0];
            const dateFields = document.querySelectorAll('input[type="date"]');
            dateFields.forEach(field => {
                if (field.name === 'evaluationDate') {
                    field.value = today;
                }
            });

            // Initialisation des indicateurs et de l'interface
            updateStepIndicator();
            updateProgressBar();
            updateNavigationButtons();
            
            // Charger le brouillon s'il existe
            chargerBrouillon();
            
            // Sauvegarde automatique toutes les 30 secondes
            setInterval(sauvegarderBrouillon, 30000);

            // Gestion des points d'étape cliquables
            const stepDots = document.querySelectorAll('.step-dot');
            stepDots.forEach((dot, index) => {
                dot.addEventListener('click', function() {
                    const targetStep = index + 1;
                    if (targetStep <= currentStep) {
                        goToStep(targetStep);
                    }
                });
            });
        });

        // Navigation entre les étapes
        function nextStep() {
            if (validateCurrentStep()) {
                if (currentStep < totalSteps) {
                    document.getElementById(`step${currentStep}`).style.display = 'none';
                    currentStep++;
                    document.getElementById(`step${currentStep}`).style.display = 'block';
                    updateStepIndicator();
                    updateProgressBar();
                    updateNavigationButtons();
                    
                    // Afficher les actions finales à la dernière étape
                    if (currentStep === totalSteps) {
                        document.getElementById('nextStep').style.display = 'none';
                        document.getElementById('finalActions').style.display = 'flex';
                    }
                }
            } else {
                alert('Veuillez remplir tous les champs requis avant de continuer.');
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                document.getElementById(`step${currentStep}`).style.display = 'none';
                currentStep--;
                document.getElementById(`step${currentStep}`).style.display = 'block';
                updateStepIndicator();
                updateProgressBar();
                updateNavigationButtons();
                
                // Masquer les actions finales si on revient en arrière
                document.getElementById('nextStep').style.display = 'inline-flex';
                document.getElementById('finalActions').style.display = 'none';
            }
        }

        function goToStep(step) {
            document.getElementById(`step${currentStep}`).style.display = 'none';
            currentStep = step;
            document.getElementById(`step${currentStep}`).style.display = 'block';
            updateStepIndicator();
            updateProgressBar();
            updateNavigationButtons();
            
            if (currentStep === totalSteps) {
                document.getElementById('nextStep').style.display = 'none';
                document.getElementById('finalActions').style.display = 'flex';
            } else {
                document.getElementById('nextStep').style.display = 'inline-flex';
                document.getElementById('finalActions').style.display = 'none';
            }
        }

        function updateStepIndicator() {
            const indicator = document.getElementById('stepIndicator');
            const stepKey = `step${currentStep}`;
            const lang = translations[currentLanguage];
            indicator.textContent = lang[stepKey] || `Étape ${currentStep} sur ${totalSteps}`;
            
            // Mise à jour des points d'étape
            const dots = document.querySelectorAll('.step-dot');
            dots.forEach((dot, index) => {
                dot.classList.remove('active', 'completed');
                if (index + 1 === currentStep) {
                    dot.classList.add('active');
                } else if (index + 1 < currentStep) {
                    dot.classList.add('completed');
                }
            });
        }

        function updateProgressBar() {
            const progress = (currentStep / totalSteps) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevStep');
            const nextBtn = document.getElementById('nextStep');
            const lang = translations[currentLanguage];
            
            if (prevBtn) {
                prevBtn.style.display = currentStep === 1 ? 'none' : 'inline-flex';
                prevBtn.innerHTML = `<i class="fas fa-arrow-left"></i> ${lang.prevStep}`;
            }
            
            if (nextBtn) {
                if (currentStep === totalSteps) {
                    nextBtn.innerHTML = `${lang.finalizeStep} <i class="fas fa-check"></i>`;
                } else {
                    nextBtn.innerHTML = `${lang.nextStep} <i class="fas fa-arrow-right"></i>`;
                }
            }
        }

        function validateCurrentStep() {
            const currentStepElement = document.getElementById(`step${currentStep}`);
            const requiredFields = currentStepElement.querySelectorAll('[required]');
            let isValid = true;
            
            requiredFields.forEach(field => {
                const errorDiv = document.getElementById(field.id + '-error');
                if (!field.value.trim()) {
                    field.style.borderColor = 'var(--error)';
                    if (errorDiv) {
                        errorDiv.style.display = 'block';
                    }
                    isValid = false;
                } else {
                    field.style.borderColor = '';
                    if (errorDiv) {
                        errorDiv.style.display = 'none';
                    }
                }
            });
            
            return isValid;
        }

        // Fonctions pour les catégories
        function toggleCategory(categoryId) {
            const content = document.getElementById(categoryId);
            const header = content.previousElementSibling;
            const icon = header.querySelector('i.fa-chevron-down');
            
            content.classList.toggle('active');
            
            if (content.classList.contains('active')) {
                icon.style.transform = 'rotate(180deg)';
            } else {
                icon.style.transform = 'rotate(0deg)';
            }
        }

        function toggleConjointField() {
            const situation = document.getElementById('situationFamiliale').value;
            const sexe = document.getElementById('sexe').value;
            const conjointGroup = document.getElementById('conjointGroup');
            const conjointLabel = document.getElementById('conjointLabel');
            
            if (situation === 'marie') {
                conjointGroup.style.display = 'block';
                if (sexe === 'homme') {
                    conjointLabel.textContent = 'Identité de l\'épouse';
                } else if (sexe === 'femme') {
                    conjointLabel.textContent = 'Identité de l\'époux';
                } else {
                    conjointLabel.textContent = 'Identité de l\'époux/épouse';
                }
            } else {
                conjointGroup.style.display = 'none';
            }
        }

        // MODIFICATION 2: Fonctions pour ajouter des personnes avec menus déroulants
        function addPerson(category) {
            const container = document.getElementById(`${category}-container`);
            const index = container.children.length;
            
            let typeOptions = '';
            let typeLabel = 'Type';
            let additionalFields = '';
            
            switch(category) {
                case 'parents':
                    typeOptions = '<option value="">Sélectionner le type</option><option value="pere">Père</option><option value="mere">Mère</option>';
                    typeLabel = 'Type de parent';
                    additionalFields = `
                        <div class="form-group">
                            <label>Statut</label>
                            <select name="${category}[${index}][statut]">
                                <option value="vivant">Vivant</option>
                                <option value="decede">Décédé</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Adresse (si différente)</label>
                            <input type="text" name="${category}[${index}][adresse]" placeholder="Adresse du parent">
                        </div>
                        <div class="form-group">
                            <label>Téléphone</label>
                            <input type="tel" name="${category}[${index}][telephone]" placeholder="Numéro de téléphone">
                        </div>`;
                    break;
                case 'conjoints':
                    typeOptions = '<option value="">Sélectionner le type</option><option value="epoux">Époux</option><option value="epouse">Épouse</option>';
                    typeLabel = 'Type de conjoint';
                    additionalFields = `
                        <div class="form-group">
                            <label>Date de mariage</label>
                            <input type="date" name="${category}[${index}][dateMarriage]">
                        </div>
                        <div class="form-group">
                            <label>Lieu de mariage</label>
                            <input type="text" name="${category}[${index}][lieuMarriage]" placeholder="Ville et pays du mariage">
                        </div>
                        <div class="form-group">
                            <label>Adresse (si différente)</label>
                            <input type="text" name="${category}[${index}][adresse]" placeholder="Adresse du conjoint">
                        </div>
                        <div class="form-group">
                            <label>Téléphone</label>
                            <input type="tel" name="${category}[${index}][telephone]" placeholder="Numéro de téléphone">
                        </div>`;
                    break;
                case 'freres-soeurs':
                    typeOptions = '<option value="">Sélectionner le type</option><option value="frere">Frère</option><option value="soeur">Sœur</option>';
                    typeLabel = 'Type de fratrie';
                    additionalFields = `
                        <div class="form-group">
                            <label>Statut</label>
                            <select name="${category}[${index}][statut]">
                                <option value="vivant">Vivant</option>
                                <option value="decede">Décédé</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Adresse</label>
                            <input type="text" name="${category}[${index}][adresse]" placeholder="Adresse">
                        </div>
                        <div class="form-group">
                            <label>Téléphone</label>
                            <input type="tel" name="${category}[${index}][telephone]" placeholder="Numéro de téléphone">
                        </div>
                        <div class="form-group">
                            <label>Profession</label>
                            <input type="text" name="${category}[${index}][profession]" placeholder="Profession actuelle">
                        </div>`;
                    break;
                case 'enfants':
                    typeOptions = '<option value="">Sélectionner le type</option><option value="fils">Fils</option><option value="fille">Fille</option>';
                    typeLabel = 'Type d\'enfant';
                    additionalFields = `
                        <div class="form-group">
                            <label>Lieu de naissance</label>
                            <input type="text" name="${category}[${index}][lieuNaissance]" placeholder="Ville et pays de naissance">
                        </div>
                        <div class="form-group">
                            <label>Statut</label>
                            <select name="${category}[${index}][statut]">
                                <option value="vivant">Vivant</option>
                                <option value="decede">Décédé</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Adresse (si différente)</label>
                            <input type="text" name="${category}[${index}][adresse]" placeholder="Adresse de l'enfant">
                        </div>
                        <div class="form-group">
                            <label>Téléphone</label>
                            <input type="tel" name="${category}[${index}][telephone]" placeholder="Numéro de téléphone">
                        </div>
                        <div class="form-group">
                            <label>Profession / Études</label>
                            <input type="text" name="${category}[${index}][profession]" placeholder="Profession ou études en cours">
                        </div>
                        <div class="form-group">
                            <label>Situation familiale</label>
                            <select name="${category}[${index}][situationFamiliale]">
                                <option value="celibataire">Célibataire</option>
                                <option value="marie">Marié(e)</option>
                                <option value="divorce">Divorcé(e)</option>
                                <option value="veuf">Veuf/Veuve</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Enfants (petits-enfants)</label>
                            <input type="number" name="${category}[${index}][nombreEnfants]" min="0" placeholder="Nombre d'enfants">
                        </div>`;
                    break;
                case 'amis':
                    typeOptions = '<option value="">Sélectionner le type</option><option value="ami">Ami</option><option value="amie">Amie</option>';
                    typeLabel = 'Type';
                    additionalFields = `
                        <div class="form-group">
                            <label>Adresse</label>
                            <input type="text" name="${category}[${index}][adresse]" placeholder="Adresse de l'ami(e)">
                        </div>
                        <div class="form-group">
                            <label>Téléphone</label>
                            <input type="tel" name="${category}[${index}][telephone]" placeholder="Numéro de téléphone">
                        </div>
                        <div class="form-group">
                            <label>Relation</label>
                            <input type="text" name="${category}[${index}][relation]" placeholder="Nature de la relation">
                        </div>`;
                    break;
            }
            
            const personEntry = document.createElement('div');
            personEntry.className = 'person-entry';
            personEntry.innerHTML = `
                <div class="form-group">
                    <label class="family-type-label">${typeLabel}</label>
                    <select class="family-dropdown" name="${category}[${index}][type]">
                        ${typeOptions}
                    </select>
                </div>
                <div class="form-group">
                    <label>Nom complet</label>
                    <input type="text" name="${category}[${index}][nom]" placeholder="Nom et prénom">
                </div>
                <div class="form-group">
                    <label>Date de naissance</label>
                    <input type="date" name="${category}[${index}][dateNaissance]">
                </div>
                ${additionalFields}
                <button type="button" class="remove-person-btn" onclick="this.parentElement.remove()">
                    <i class="fas fa-trash"></i> Supprimer
                </button>
            `;
            
            container.appendChild(personEntry);
        }

        // Fonction pour ajouter des biens
        function addAsset(category) {
            const container = document.getElementById(`${category}-container`);
            const index = container.children.length;
            
            const assetEntry = document.createElement('div');
            assetEntry.className = 'asset-entry';
            
            let fields = '';
            switch(category) {
                case 'immobilier':
                    fields = `
                        <div class="form-group">
                            <label>Type de bien immobilier</label>
                            <select name="${category}[${index}][type]">
                                <option value="">Sélectionner le type</option>
                                <option value="appartement">Appartement</option>
                                <option value="maison">Maison</option>
                                <option value="terrain">Terrain</option>
                                <option value="garage">Garage/Parking</option>
                                <option value="local-commercial">Local commercial</option>
                                <option value="immeuble">Immeuble</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Description détaillée</label>
                            <textarea name="${category}[${index}][description]" placeholder="Description précise du bien"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Adresse complète</label>
                            <textarea name="${category}[${index}][adresse]" placeholder="Adresse complète"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Valeur estimée (€)</label>
                            <input type="number" name="${category}[${index}][valeur]" min="0" step="100" oninput="updateTotal()">
                        </div>
                        <div class="form-group">
                            <label>Mode d'acquisition</label>
                            <select name="${category}[${index}][acquisition]">
                                <option value="achat">Achat</option>
                                <option value="heritage">Héritage</option>
                                <option value="donation">Donation</option>
                                <option value="construction">Construction</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Date d'acquisition</label>
                            <input type="date" name="${category}[${index}][dateAcquisition]">
                        </div>
                        <div class="form-group">
                            <label>Références cadastrales</label>
                            <input type="text" name="${category}[${index}][cadastre]" placeholder="Références cadastrales">
                        </div>
                        <div class="form-group">
                            <label>Hypothèques ou charges</label>
                            <textarea name="${category}[${index}][charges]" placeholder="Hypothèques, prêts, charges"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Documents importants</label>
                            <textarea name="${category}[${index}][documents]" placeholder="Localisation des documents"></textarea>
                        </div>
                    `;
                    break;
                
                case 'materiel':
                    fields = `
                        <div class="form-group">
                            <label>Type de bien</label>
                            <select name="${category}[${index}][type]">
                                <option value="">Sélectionner le type</option>
                                <option value="vehicule">Véhicule</option>
                                <option value="bijoux">Bijoux</option>
                                <option value="art">Œuvre d'art</option>
                                <option value="collection">Collection</option>
                                <option value="electromenager">Électroménager</option>
                                <option value="mobilier">Mobilier</option>
                                <option value="informatique">Matériel informatique</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Description détaillée</label>
                            <textarea name="${category}[${index}][description]" placeholder="Description précise du bien"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Valeur estimée (€)</label>
                            <input type="number" name="${category}[${index}][valeur]" min="0" step="0.01" oninput="updateTotal()">
                        </div>
                        <div class="form-group">
                            <label>Localisation</label>
                            <input type="text" name="${category}[${index}][localisation]" placeholder="Où se trouve ce bien">
                        </div>
                        <div class="form-group">
                            <label>Documents associés</label>
                            <textarea name="${category}[${index}][documents]" placeholder="Factures, certificats, garanties"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Instructions particulières</label>
                            <textarea name="${category}[${index}][instructions]" placeholder="Instructions spéciales"></textarea>
                        </div>
                    `;
                    break;
                
                case 'personnels':
                    fields = `
                        <div class="form-group">
                            <label>Type de bien personnel</label>
                            <select name="${category}[${index}][type]">
                                <option value="">Sélectionner le type</option>
                                <option value="livres">Livres religieux/Coran</option>
                                <option value="vetements">Vêtements traditionnels</option>
                                <option value="souvenirs">Souvenirs de famille</option>
                                <option value="photos">Photos/Albums</option>
                                <option value="lettres">Lettres/Correspondances</option>
                                <option value="objets-religieux">Objets religieux</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea name="${category}[${index}][description]" placeholder="Description détaillée"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Valeur sentimentale</label>
                            <select name="${category}[${index}][valeurSentimentale]">
                                <option value="faible">Faible</option>
                                <option value="moyenne">Moyenne</option>
                                <option value="elevee">Élevée</option>
                                <option value="tres-elevee">Très élevée</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Valeur marchande (€)</label>
                            <input type="number" name="${category}[${index}][valeur]" min="0" step="0.01" oninput="updateTotal()">
                        </div>
                        <div class="form-group">
                            <label>Localisation</label>
                            <input type="text" name="${category}[${index}][localisation]" placeholder="Où se trouvent ces biens">
                        </div>
                        <div class="form-group">
                            <label>Destinataire souhaité</label>
                            <input type="text" name="${category}[${index}][destinataire]" placeholder="Personne à qui léguer">
                        </div>
                        <div class="form-group">
                            <label>Instructions particulières</label>
                            <textarea name="${category}[${index}][instructions]" placeholder="Instructions spéciales"></textarea>
                        </div>
                    `;
                    break;
                
                case 'comptes':
                    fields = `
                        <div class="form-group">
                            <label>Type de compte</label>
                            <select name="${category}[${index}][type]">
                                <option value="">Sélectionner le type</option>
                                <option value="courant">Compte courant</option>
                                <option value="epargne">Compte d'épargne</option>
                                <option value="livret">Livret</option>
                                <option value="pel">Plan Épargne Logement</option>
                                <option value="assurance-vie">Assurance vie</option>
                                <option value="actions">Compte-titres</option>
                                <option value="pea">Plan d'Épargne en Actions</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Nom de la banque</label>
                            <input type="text" name="${category}[${index}][banque]" placeholder="Nom de l'établissement">
                        </div>
                        <div class="form-group">
                            <label>Numéro de compte (IBAN)</label>
                            <input type="text" name="${category}[${index}][numeroCompte]" placeholder="IBAN ou numéro">
                        </div>
                        <div class="form-group">
                            <label>Agence</label>
                            <input type="text" name="${category}[${index}][agence]" placeholder="Nom et adresse de l'agence">
                        </div>
                        <div class="form-group">
                            <label>Solde approximatif (€)</label>
                            <input type="number" name="${category}[${index}][solde]" min="0" step="0.01" oninput="updateTotal()">
                        </div>
                        <div class="form-group">
                            <label>Titulaires du compte</label>
                            <input type="text" name="${category}[${index}][titulaires]" placeholder="Titulaires">
                        </div>
                        <div class="form-group">
                            <label>Contact conseiller</label>
                            <input type="text" name="${category}[${index}][conseiller]" placeholder="Conseiller bancaire">
                        </div>
                        <div class="form-group">
                            <label>Informations d'accès</label>
                            <textarea name="${category}[${index}][acces]" placeholder="Informations d'accès"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Instructions particulières</label>
                            <textarea name="${category}[${index}][instructions]" placeholder="Instructions spéciales"></textarea>
                        </div>
                    `;
                    break;
                
                case 'cartes':
                    fields = `
                        <div class="form-group">
                            <label>Type de carte</label>
                            <select name="${category}[${index}][type]">
                                <option value="">Sélectionner le type</option>
                                <option value="visa">Visa</option>
                                <option value="mastercard">Mastercard</option>
                                <option value="amex">American Express</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Banque émettrice</label>
                            <input type="text" name="${category}[${index}][banque]" placeholder="Nom de la banque">
                        </div>
                        <div class="form-group">
                            <label>Numéro de carte (4 derniers chiffres)</label>
                            <input type="text" name="${category}[${index}][numero]" placeholder="**** 1234" maxlength="4">
                        </div>
                        <div class="form-group">
                            <label>Date d'expiration</label>
                            <input type="month" name="${category}[${index}][expiration]">
                        </div>
                        <div class="form-group">
                            <label>Code PIN</label>
                            <input type="password" name="${category}[${index}][pin]" placeholder="Code confidentiel" maxlength="4">
                        </div>
                        <div class="form-group">
                            <label>Localisation de la carte</label>
                            <input type="text" name="${category}[${index}][localisation]" placeholder="Où se trouve la carte">
                        </div>
                        <div class="form-group">
                            <label>Instructions d'urgence</label>
                            <textarea name="${category}[${index}][instructions]" placeholder="Instructions d'urgence"></textarea>
                        </div>
                    `;
                    break;
                
                case 'applications':
                    fields = `
                        <div class="form-group">
                            <label>Nom de l'application</label>
                            <input type="text" name="${category}[${index}][nom]" placeholder="Nom de l'application">
                        </div>
                        <div class="form-group">
                            <label>Banque</label>
                            <input type="text" name="${category}[${index}][banque]" placeholder="Nom de la banque">
                        </div>
                        <div class="form-group">
                            <label>Identifiant utilisateur</label>
                            <input type="text" name="${category}[${index}][identifiant]" placeholder="Identifiant">
                        </div>
                        <div class="form-group">
                            <label>Mot de passe</label>
                            <input type="password" name="${category}[${index}][motdepasse]" placeholder="Mot de passe">
                        </div>
                        <div class="form-group">
                            <label>Code d'accès/PIN app</label>
                            <input type="password" name="${category}[${index}][codeapp]" placeholder="Code PIN">
                        </div>
                        <div class="form-group">
                            <label>Appareils configurés</label>
                            <textarea name="${category}[${index}][appareils]" placeholder="Liste des appareils"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Authentification à deux facteurs</label>
                            <textarea name="${category}[${index}][2fa]" placeholder="Informations 2FA"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Instructions de récupération</label>
                            <textarea name="${category}[${index}][recuperation]" placeholder="Instructions de récupération"></textarea>
                        </div>
                    `;
                    break;
                
                case 'dettes':
                    fields = `
                        <div class="form-group">
                            <label>Type de dette</label>
                            <select name="${category}[${index}][type]">
                                <option value="">Sélectionner le type</option>
                                <option value="pret-bancaire">Prêt bancaire</option>
                                <option value="pret-immobilier">Prêt immobilier</option>
                                <option value="pret-personnel">Prêt personnel</option>
                                <option value="carte-credit">Carte de crédit</option>
                                <option value="pret-famille">Prêt familial</option>
                                <option value="pret-ami">Prêt d'un ami</option>
                                <option value="factures">Factures impayées</option>
                                <option value="impots">Impôts/Taxes</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Créancier</label>
                            <input type="text" name="${category}[${index}][creancier]" placeholder="Nom du créancier">
                        </div>
                        <div class="form-group">
                            <label>Montant total dû (€)</label>
                            <input type="number" name="${category}[${index}][montant]" min="0" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>Mensualité (€)</label>
                            <input type="number" name="${category}[${index}][mensualite]" min="0" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>Date de fin prévue</label>
                            <input type="date" name="${category}[${index}][dateFin]">
                        </div>
                        <div class="form-group">
                            <label>Coordonnées du créancier</label>
                            <textarea name="${category}[${index}][coordonnees]" placeholder="Coordonnées"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Numéro de contrat/dossier</label>
                            <input type="text" name="${category}[${index}][numeroContrat]" placeholder="Référence">
                        </div>
                        <div class="form-group">
                            <label>Documents liés</label>
                            <textarea name="${category}[${index}][documents]" placeholder="Localisation des documents"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Instructions particulières</label>
                            <textarea name="${category}[${index}][instructions]" placeholder="Instructions"></textarea>
                        </div>
                    `;
                    break;
                
                case 'creances':
                    fields = `
                        <div class="form-group">
                            <label>Type de créance</label>
                            <select name="${category}[${index}][type]">
                                <option value="">Sélectionner le type</option>
                                <option value="pret-famille">Prêt à la famille</option>
                                <option value="pret-ami">Prêt à un ami</option>
                                <option value="salaire">Salaire dû</option>
                                <option value="remboursement">Remboursement dû</option>
                                <option value="caution">Caution à récupérer</option>
                                <option value="investissement">Retour d'investissement</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Débiteur</label>
                            <input type="text" name="${category}[${index}][debiteur]" placeholder="Nom du débiteur">
                        </div>
                        <div class="form-group">
                            <label>Montant dû (€)</label>
                            <input type="number" name="${category}[${index}][montant]" min="0" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>Date de l'engagement</label>
                            <input type="date" name="${category}[${index}][dateEngagement]">
                        </div>
                        <div class="form-group">
                            <label>Date d'échéance</label>
                            <input type="date" name="${category}[${index}][dateEcheance]">
                        </div>
                        <div class="form-group">
                            <label>Coordonnées du débiteur</label>
                            <textarea name="${category}[${index}][coordonnees]" placeholder="Coordonnées"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Preuves/Documents</label>
                            <textarea name="${category}[${index}][preuves]" placeholder="Localisation des preuves"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Probabilité de récupération</label>
                            <select name="${category}[${index}][probabilite]">
                                <option value="elevee">Élevée</option>
                                <option value="moyenne">Moyenne</option>
                                <option value="faible">Faible</option>
                                <option value="nulle">Nulle</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Instructions de recouvrement</label>
                            <textarea name="${category}[${index}][instructions]" placeholder="Instructions"></textarea>
                        </div>
                    `;
                    break;
                
                case 'dons-sadaqat':
                    fields = `
                        <div class="form-group">
                            <label>Type de don</label>
                            <select name="${category}[${index}][type]">
                                <option value="">Sélectionner le type</option>
                                <option value="zakat">Zakat</option>
                                <option value="sadaqa">Sadaqa</option>
                                <option value="mosquee">Don à la mosquée</option>
                                <option value="orphelinat">Don à un orphelinat</option>
                                <option value="education">Don pour l'éducation</option>
                                <option value="pauvres">Aide aux pauvres</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Bénéficiaire</label>
                            <input type="text" name="${category}[${index}][beneficiaire]" placeholder="Nom du bénéficiaire">
                        </div>
                        <div class="form-group">
                            <label>Montant annuel (€)</label>
                            <input type="number" name="${category}[${index}][montant]" min="0" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>Fréquence</label>
                            <select name="${category}[${index}][frequence]">
                                <option value="mensuel">Mensuel</option>
                                <option value="trimestriel">Trimestriel</option>
                                <option value="semestriel">Semestriel</option>
                                <option value="annuel">Annuel</option>
                                <option value="ramadan">Pendant le Ramadan</option>
                                <option value="occasionnel">Occasionnel</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Mode de versement</label>
                            <select name="${category}[${index}][mode]">
                                <option value="virement">Virement bancaire</option>
                                <option value="cheque">Chèque</option>
                                <option value="especes">Espèces</option>
                                <option value="prelevement">Prélèvement automatique</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Coordonnées du bénéficiaire</label>
                            <textarea name="${category}[${index}][coordonnees]" placeholder="Coordonnées complètes"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Instructions de continuité</label>
                            <textarea name="${category}[${index}][instructions]" placeholder="Instructions"></textarea>
                        </div>
                    `;
                    break;
                
                default:
                    fields = `
                        <div class="form-group">
                            <label>Description</label>
                            <input type="text" name="${category}[${index}][description]" placeholder="Description">
                        </div>
                        <div class="form-group">
                            <label>Valeur (€)</label>
                            <input type="number" name="${category}[${index}][valeur]" min="0" step="0.01" oninput="updateTotal()">
                        </div>
                    `;
            }
            
            assetEntry.innerHTML = `
                ${fields}
                <button type="button" class="remove-person-btn" onclick="this.parentElement.remove(); updateTotal();">
                    <i class="fas fa-trash"></i> Supprimer
                </button>
            `;
            
            container.appendChild(assetEntry);
            updateTotal();
        }

        // Fonction pour ajouter des comptes numériques
        function addDigitalAccount(category) {
            const container = document.getElementById(`${category}-container`);
            const index = container.children.length;
            
            const accountEntry = document.createElement('div');
            accountEntry.className = 'asset-entry';
            
            let fields = '';
            switch(category) {
                case 'emails':
                    fields = `
                        <div class="form-group">
                            <label>Fournisseur d'email</label>
                            <select name="${category}[${index}][fournisseur]">
                                <option value="">Sélectionner</option>
                                <option value="gmail">Gmail</option>
                                <option value="outlook">Outlook/Hotmail</option>
                                <option value="yahoo">Yahoo</option>
                                <option value="apple">iCloud/Apple</option>
                                <option value="professionnel">Email professionnel</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Adresse email</label>
                            <input type="email" name="${category}[${index}][adresse]" placeholder="exemple@email.com">
                        </div>
                        <div class="form-group">
                            <label>Mot de passe</label>
                            <input type="password" name="${category}[${index}][motdepasse]" placeholder="Mot de passe">
                        </div>
                        <div class="form-group">
                            <label>Téléphone de récupération</label>
                            <input type="tel" name="${category}[${index}][telephone]" placeholder="Téléphone">
                        </div>
                        <div class="form-group">
                            <label>Email de récupération</label>
                            <input type="email" name="${category}[${index}][emailRecup]" placeholder="Email de récupération">
                        </div>
                        <div class="form-group">
                            <label>Questions de sécurité</label>
                            <textarea name="${category}[${index}][questions]" placeholder="Questions et réponses"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Authentification à deux facteurs</label>
                            <textarea name="${category}[${index}][2fa]" placeholder="Informations 2FA"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Utilisation principale</label>
                            <input type="text" name="${category}[${index}][utilisation]" placeholder="Personnel, professionnel, etc.">
                        </div>
                        <div class="form-group">
                            <label>Instructions</label>
                            <textarea name="${category}[${index}][instructions]" placeholder="Que faire avec ce compte ?"></textarea>
                        </div>
                    `;
                    break;
                    
                case 'reseaux-sociaux':
                    fields = `
                        <div class="form-group">
                            <label>Plateforme</label>
                            <select name="${category}[${index}][plateforme]">
                                <option value="">Sélectionner</option>
                                <option value="facebook">Facebook</option>
                                <option value="instagram">Instagram</option>
                                <option value="twitter">Twitter/X</option>
                                <option value="linkedin">LinkedIn</option>
                                <option value="tiktok">TikTok</option>
                                <option value="snapchat">Snapchat</option>
                                <option value="youtube">YouTube</option>
                                <option value="whatsapp">WhatsApp Business</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Nom d'utilisateur</label>
                            <input type="text" name="${category}[${index}][username]" placeholder="@nomutilisateur">
                        </div>
                        <div class="form-group">
                            <label>Email associé</label>
                            <input type="email" name="${category}[${index}][email]" placeholder="Email du compte">
                        </div>
                        <div class="form-group">
                            <label>Mot de passe</label>
                            <input type="password" name="${category}[${index}][motdepasse]" placeholder="Mot de passe">
                        </div>
                        <div class="form-group">
                            <label>Téléphone associé</label>
                            <input type="tel" name="${category}[${index}][telephone]" placeholder="Téléphone">
                        </div>
                        <div class="form-group">
                            <label>Authentification à deux facteurs</label>
                            <textarea name="${category}[${index}][2fa]" placeholder="Informations 2FA"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Utilisation du compte</label>
                            <select name="${category}[${index}][utilisation]">
                                <option value="personnel">Personnel</option>
                                <option value="professionnel">Professionnel</option>
                                <option value="business">Business</option>
                                <option value="dawah">Da'wah/Religieux</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Instructions</label>
                            <textarea name="${category}[${index}][instructions]" placeholder="Supprimer, mémoriel, transférer ?"></textarea>
                        </div>
                    `;
                    break;
                    
                case 'services-en-ligne':
                    fields = `
                        <div class="form-group">
                            <label>Type de service</label>
                            <select name="${category}[${index}][type]">
                                <option value="">Sélectionner</option>
                                <option value="streaming">Streaming (Netflix, Prime, etc.)</option>
                                <option value="cloud">Stockage cloud</option>
                                <option value="ecommerce">E-commerce</option>
                                <option value="finance">Services financiers</option>
                                <option value="education">Plateformes éducatives</option>
                                <option value="professionnel">Services professionnels</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Nom du service</label>
                            <input type="text" name="${category}[${index}][nom]" placeholder="Netflix, Amazon, etc.">
                        </div>
                        <div class="form-group">
                            <label>Identifiant/Email</label>
                            <input type="text" name="${category}[${index}][identifiant]" placeholder="Identifiant">
                        </div>
                        <div class="form-group">
                            <label>Mot de passe</label>
                            <input type="password" name="${category}[${index}][motdepasse]" placeholder="Mot de passe">
                        </div>
                        <div class="form-group">
                            <label>Type d'abonnement</label>
                            <input type="text" name="${category}[${index}][abonnement]" placeholder="Gratuit, Premium, etc.">
                        </div>
                        <div class="form-group">
                            <label>Coût mensuel/annuel (€)</label>
                            <input type="number" name="${category}[${index}][cout]" min="0" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>Mode de paiement</label>
                            <input type="text" name="${category}[${index}][paiement]" placeholder="Carte, PayPal, etc.">
                        </div>
                        <div class="form-group">
                            <label>Date de renouvellement</label>
                            <input type="date" name="${category}[${index}][renouvellement]">
                        </div>
                        <div class="form-group">
                            <label>Données importantes</label>
                            <textarea name="${category}[${index}][donnees]" placeholder="Photos, documents importants"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Instructions</label>
                            <textarea name="${category}[${index}][instructions]" placeholder="Que faire avec ce service ?"></textarea>
                        </div>
                    `;
                    break;
            }
            
            accountEntry.innerHTML = `
                ${fields}
                <button type="button" class="remove-person-btn" onclick="this.parentElement.remove()">
                    <i class="fas fa-trash"></i> Supprimer
                </button>
            `;
            
            container.appendChild(accountEntry);
        }

        // Fonction pour ajouter des appareils
        function addDevice() {
            const container = document.getElementById('appareils-container');
            const index = container.children.length;
            
            const deviceEntry = document.createElement('div');
            deviceEntry.className = 'asset-entry';
            deviceEntry.innerHTML = `
                <div class="form-group">
                    <label>Type d'appareil</label>
                    <select name="appareils[${index}][type]">
                        <option value="">Sélectionner</option>
                        <option value="smartphone">Smartphone</option>
                        <option value="tablette">Tablette</option>
                        <option value="ordinateur-portable">Ordinateur portable</option>
                        <option value="ordinateur-fixe">Ordinateur fixe</option>
                        <option value="montre-connectee">Montre connectée</option>
                        <option value="autre">Autre</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Marque et modèle</label>
                    <input type="text" name="appareils[${index}][modele]" placeholder="iPhone 13, MacBook Pro, etc.">
                </div>
                <div class="form-group">
                    <label>Système d'exploitation</label>
                    <select name="appareils[${index}][os]">
                        <option value="">Sélectionner</option>
                        <option value="ios">iOS</option>
                        <option value="android">Android</option>
                        <option value="windows">Windows</option>
                        <option value="macos">macOS</option>
                        <option value="linux">Linux</option>
                        <option value="autre">Autre</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Code de déverrouillage/PIN</label>
                    <input type="password" name="appareils[${index}][code]" placeholder="Code de déverrouillage">
                </div>
                <div class="form-group">
                    <label>Mot de passe utilisateur</label>
                    <input type="password" name="appareils[${index}][motdepasse]" placeholder="Mot de passe de session">
                </div>
                <div class="form-group">
                    <label>Authentification biométrique</label>
                    <input type="text" name="appareils[${index}][biometrie]" placeholder="Empreinte, Face ID, etc.">
                </div>
                <div class="form-group">
                    <label>Localisation actuelle</label>
                    <input type="text" name="appareils[${index}][localisation]" placeholder="Où se trouve l'appareil">
                </div>
                <div class="form-group">
                    <label>Comptes principaux connectés</label>
                    <textarea name="appareils[${index}][comptes]" placeholder="Apple ID, Google Account, etc."></textarea>
                </div>
                <div class="form-group">
                    <label>Applications importantes</label>
                    <textarea name="appareils[${index}][applications]" placeholder="Applications importantes"></textarea>
                </div>
                <div class="form-group">
                    <label>Données importantes</label>
                    <textarea name="appareils[${index}][donnees]" placeholder="Photos, vidéos, documents importants"></textarea>
                </div>
                <div class="form-group">
                    <label>Sauvegardes</label>
                    <textarea name="appareils[${index}][sauvegardes]" placeholder="Informations sur les sauvegardes"></textarea>
                </div>
                <div class="form-group">
                    <label>Instructions d'accès</label>
                    <textarea name="appareils[${index}][instructions]" placeholder="Instructions détaillées"></textarea>
                </div>
                <button type="button" class="remove-person-btn" onclick="this.parentElement.remove()">
                    <i class="fas fa-trash"></i> Supprimer
                </button>
            `;
            
            container.appendChild(deviceEntry);
        }

        // Fonction pour ajouter un legs
        function addLeg() {
            const container = document.getElementById('legs-container');
            const index = container.children.length;
            
            const legEntry = document.createElement('div');
            legEntry.className = 'leg-entry';
            legEntry.innerHTML = `
                <div class="form-group">
                    <label>Type de legs</label>
                    <select name="legs[${index}][type]">
                        <option value="">Sélectionner le type</option>
                        <option value="monetaire">Legs monétaire</option>
                        <option value="bien-specifique">Bien spécifique</option>
                        <option value="pourcentage">Pourcentage du patrimoine</option>
                        <option value="usufruit">Usufruit</option>
                        <option value="autre">Autre</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Bénéficiaire</label>
                    <input type="text" name="legs[${index}][beneficiaire]" placeholder="Nom complet du bénéficiaire">
                </div>
                <div class="form-group">
                    <label>Relation avec le bénéficiaire</label>
                    <input type="text" name="legs[${index}][relation]" placeholder="Ami, œuvre caritative, mosquée, etc.">
                </div>
                <div class="form-group">
                    <label>Description détaillée du legs</label>
                    <textarea name="legs[${index}][description]" placeholder="Description précise de ce que vous léguez"></textarea>
                </div>
                <div class="form-group">
                    <label>Valeur ou montant (€)</label>
                    <input type="number" name="legs[${index}][valeur]" min="0" step="0.01" oninput="updateLegsTotal()" placeholder="Valeur estimée">
                </div>
                <div class="form-group">
                    <label>Coordonnées du bénéficiaire</label>
                    <textarea name="legs[${index}][coordonnees]" placeholder="Adresse complète, téléphone, email"></textarea>
                </div>
                <div class="form-group">
                    <label>Conditions particulières</label>
                    <textarea name="legs[${index}][conditions]" placeholder="Conditions ou restrictions"></textarea>
                </div>
                <div class="form-group">
                    <label>Instructions d'exécution</label>
                    <textarea name="legs[${index}][instructions]" placeholder="Instructions détaillées"></textarea>
                </div>
                <button type="button" class="remove-person-btn" onclick="this.parentElement.remove(); updateLegsTotal();">
                    <i class="fas fa-trash"></i> Supprimer
                </button>
            `;
            
            container.appendChild(legEntry);
            updateLegsTotal();
        }

        // Mise à jour du total des biens
        function updateTotal() {
            const inputs = document.querySelectorAll('input[name*="[valeur]"], input[name*="[solde]"]');
            let total = 0;
            
            inputs.forEach(input => {
                const value = parseFloat(input.value) || 0;
                total += value;
            });
            
            totalPatrimoine = total;
            document.getElementById('totalValue').textContent = total.toLocaleString('fr-FR') + ' €';
            updateLegsTotal();
        }

        // Mise à jour du total des legs
        function updateLegsTotal() {
            const legsInputs = document.querySelectorAll('input[name*="legs"][name*="[valeur]"]');
            let totalLegs = 0;
            
            legsInputs.forEach(input => {
                const value = parseFloat(input.value) || 0;
                totalLegs += value;
            });
            
            const maxLegs = totalPatrimoine / 3;
            
            document.getElementById('totalLegs').textContent = totalLegs.toLocaleString('fr-FR') + ' €';
            document.getElementById('maxLegs').textContent = maxLegs.toLocaleString('fr-FR') + ' €';
            
            const warning = document.getElementById('legsWarning');
            if (totalLegs > maxLegs) {
                warning.style.display = 'block';
            } else {
                warning.style.display = 'none';
            }
        }

        // Calcul de la Zakat
        function calculerZakat() {
            const epargne = parseFloat(document.getElementById('zakatEpargne').value) || 0;
            const or = parseFloat(document.getElementById('zakatOr').value) || 0;
            const argent = parseFloat(document.getElementById('zakatArgent').value) || 0;
            const investissements = parseFloat(document.getElementById('zakatInvestissements').value) || 0;
            const commerce = parseFloat(document.getElementById('zakatCommerce').value) || 0;
            const creances = parseFloat(document.getElementById('zakatCreances').value) || 0;
            const dettes = parseFloat(document.getElementById('zakatDettes').value) || 0;
            
            const totalPatrimoine = epargne + or + argent + investissements + commerce + creances - dettes;
            const nissab = 4914; // Seuil de Nissab en euros (approximatif)
            
            document.getElementById('zakatPatrimoine').textContent = totalPatrimoine.toLocaleString('fr-FR') + ' €';
            
            if (totalPatrimoine >= nissab) {
                const zakatDue = totalPatrimoine * 0.025; // 2,5%
                document.getElementById('zakatMontant').textContent = zakatDue.toLocaleString('fr-FR') + ' €';
                document.getElementById('zakatStatus').innerHTML = '<p style="color: var(--success);">✓ Zakat obligatoire - Le patrimoine dépasse le Nissab</p>';
            } else {
                document.getElementById('zakatMontant').textContent = '0 €';
                document.getElementById('zakatStatus').innerHTML = '<p style="color: var(--error);">⚠️ Zakat non obligatoire - Le patrimoine ne dépasse pas le Nissab</p>';
            }
            
            document.getElementById('zakatResult').style.display = 'block';
        }

        // Calcul de l'héritage islamique (votre fonction existante conservée)
        function calculerHeritage() {
            const heritageGrid = document.getElementById('heritageGrid');
            heritageGrid.innerHTML = '<div class="heritage-item"><div class="heritage-item-title">Calcul de l\'héritage</div><div class="heritage-share">Fonction de calcul à implémenter selon les règles islamiques complexes</div></div>';
            heritageGrid.style.display = 'grid';
        }

        // MODIFICATION 1 & 4: Génération PDF avec html2pdf.js et toutes les données
        function genererPDF() {
            const form = document.getElementById('testamentForm');
            const formData = new FormData(form);
            const today = new Date().toLocaleDateString('fr-FR');
            
            // MODIFICATION 4: Création du contenu HTML complet avec toutes les données du formulaire
            const pdfContent = `
                <div style="font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.6;">
                    <div style="text-align: center; border-bottom: 3px solid #C9B178; padding-bottom: 20px; margin-bottom: 30px;">
                        <h1 style="color: #C9B178; font-size: 2.5rem; margin: 0; font-family: 'Times New Roman', serif;">Al Wassiya</h1>
                        <div style="font-size: 1.5rem; color: #2D4C68; margin: 10px 0; font-family: 'Times New Roman', serif;">الوصية</div>
                        <h2 style="color: #2D4C68; margin: 10px 0; font-size: 1.8rem;">TESTAMENT ISLAMIQUE (WASSIYA)</h2>
                        <div style="color: #C9B178; font-size: 1.2rem; margin: 10px 0; font-family: 'Times New Roman', serif;">بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ</div>
                        <p style="margin-top: 20px; font-size: 1.1rem;">Date de rédaction : ${today}</p>
                    </div>
                    
                    ${generatePDFSections(formData)}
                    
                    <div style="margin-top: 50px; text-align: center; font-style: italic; color: #666; page-break-inside: avoid;">
                        <div style="border-top: 2px solid #C9B178; padding-top: 20px;">
                            <p style="margin-bottom: 15px; font-size: 1.1rem;"><strong>Document généré par Al Wassiya</strong></p>
                            <p style="margin-bottom: 15px;">Testament rédigé conformément aux préceptes islamiques</p>
                            <p style="margin-top: 20px; font-style: italic; color: #C9B178; font-size: 1rem;">« وَاتَّقُوا اللَّهَ وَيُعَلِّمُكُمُ اللَّهُ »</p>
                            <p style="font-size: 0.9rem;">"Craignez Allah et Allah vous enseignera" - Coran 2:282</p>
                        </div>
                    </div>
                </div>
            `;
            
            // Configuration html2pdf avec toutes les options
            const opt = {
                margin: [0.5, 0.5, 0.5, 0.5],
                filename: `Testament-Islamique-${formData.get('nom') || 'Al-Wassiya'}-${today.replace(/\//g, '-')}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { 
                    scale: 2, 
                    useCORS: true, 
                    letterRendering: true,
                    allowTaint: true 
                },
                jsPDF: { 
                    unit: 'in', 
                    format: 'a4', 
                    orientation: 'portrait',
                    compress: true
                },
                pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
            };
            
            // Génération du PDF
            html2pdf().set(opt).from(pdfContent).save()
                .then(() => {
                    showSaveIndicator('PDF généré avec succès !');
                })
                .catch(error => {
                    console.error('Erreur lors de la génération du PDF:', error);
                    alert('Erreur lors de la génération du PDF. Veuillez réessayer.');
                });
        }

        function generatePDFSections(formData) {
            let content = '';
            
            // Section 1: Informations personnelles
            content += `
                <div style="margin-bottom: 30px; page-break-inside: avoid;">
                    <h3 style="color: #2D4C68; border-bottom: 2px solid #C9B178; padding-bottom: 10px; margin-bottom: 20px;">INFORMATIONS PERSONNELLES</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <p><strong>Sexe :</strong> ${formData.get('sexe') || 'Non spécifié'}</p>
                            <p><strong>Prénom :</strong> ${formData.get('prenom') || 'Non spécifié'}</p>
                            <p><strong>Nom :</strong> ${formData.get('nom') || 'Non spécifié'}</p>
                            <p><strong>Date de naissance :</strong> ${formData.get('dateNaissance') || 'Non spécifiée'}</p>
                        </div>
                        <div>
                            <p><strong>Lieu de naissance :</strong> ${formData.get('lieuNaissance') || 'Non spécifié'}</p>
                            <p><strong>Nationalité :</strong> ${formData.get('nationalite') || 'Non spécifiée'}</p>
                            <p><strong>Situation familiale :</strong> ${formData.get('situationFamiliale') || 'Non spécifiée'}</p>
                        </div>
                    </div>
                    <p><strong>Adresse :</strong> ${formData.get('adresse') || 'Non spécifiée'}</p>
                </div>
            `;
            
            // Section 2: Volontés générales
            content += `
                <div style="margin-bottom: 30px; page-break-inside: avoid;">
                    <h3 style="color: #2D4C68; border-bottom: 2px solid #C9B178; padding-bottom: 10px; margin-bottom: 20px;">VOLONTÉS GÉNÉRALES</h3>
                    <p><strong>Volontés concernant les obsèques :</strong><br>${formData.get('volontesObseques') || 'Non spécifiées'}</p>
                    <p><strong>Recommandations à la famille :</strong><br>${formData.get('recommandationsFamille') || 'Aucune'}</p>
                    <p><strong>Exécuteur testamentaire :</strong> ${formData.get('executeurTestament') || 'Non désigné'}</p>
                    <p><strong>Contact de l'exécuteur :</strong> ${formData.get('contactExecuteur') || 'Non spécifié'}</p>
                    <p><strong>Autres volontés :</strong><br>${formData.get('autresVolontes') || 'Aucune'}</p>
                </div>
            `;
            
            // Section 3: Famille et proches
            content += generateFamilySection(formData);
            
            // Section 4: Biens et patrimoine
            content += generateAssetsSection(formData);
            
            // Section 5: Zakat et dettes
            content += generateZakatSection(formData);
            
            // Section 6: Legs
            content += generateLegsSection(formData);
            
            // Section 7: Patrimoine numérique
            content += generateDigitalSection(formData);
            
            return content;
        }

        function generateFamilySection(formData) {
            let content = `
                <div style="margin-bottom: 30px; page-break-inside: avoid;">
                    <h3 style="color: #2D4C68; border-bottom: 2px solid #C9B178; padding-bottom: 10px; margin-bottom: 20px;">FAMILLE ET PROCHES</h3>
            `;
            
            // Traitement des données familiales
            const categories = ['parents', 'conjoints', 'enfants', 'freres-soeurs', 'amis'];
            let hasFamily = false;
            
            categories.forEach(category => {
                let categoryContent = '';
                for (let [key, value] of formData.entries()) {
                    if (key.startsWith(category) && value) {
                        if (categoryContent === '') {
                            categoryContent += `<div style="margin-bottom: 20px;"><h4 style="color: #C9B178; margin-bottom: 10px; text-transform: capitalize;">${category.replace('-', ' ')}</h4>`;
                            hasFamily = true;
                        }
                        categoryContent += `<p style="margin-left: 20px;"><strong>${key} :</strong> ${value}</p>`;
                    }
                }
                if (categoryContent !== '') {
                    categoryContent += '</div>';
                    content += categoryContent;
                }
            });
            
            if (!hasFamily) {
                content += '<p>Aucune information familiale spécifiée.</p>';
            }
            
            // Informations complémentaires
            if (formData.get('autresProches') || formData.get('relationsParticulieres') || formData.get('personnesPrevenir')) {
                content += `
                    <div style="margin-top: 20px;">
                        <h4 style="color: #C9B178; margin-bottom: 10px;">Informations complémentaires</h4>
                        ${formData.get('autresProches') ? `<p><strong>Autres personnes :</strong><br>${formData.get('autresProches')}</p>` : ''}
                        ${formData.get('relationsParticulieres') ? `<p><strong>Relations particulières :</strong><br>${formData.get('relationsParticulieres')}</p>` : ''}
                        ${formData.get('personnesPrevenir') ? `<p><strong>Personnes à prévenir :</strong><br>${formData.get('personnesPrevenir')}</p>` : ''}
                    </div>
                `;
            }
            
            content += '</div>';
            return content;
        }

        function generateAssetsSection(formData) {
            let content = `
                <div style="margin-bottom: 30px; page-break-inside: avoid;">
                    <h3 style="color: #2D4C68; border-bottom: 2px solid #C9B178; padding-bottom: 10px; margin-bottom: 20px;">BIENS ET PATRIMOINE</h3>
            `;
            
            const assetCategories = ['immobilier', 'materiel', 'personnels', 'comptes', 'cartes', 'applications'];
            let hasAssets = false;
            let totalValue = 0;
            
            assetCategories.forEach(category => {
                let categoryContent = '';
                for (let [key, value] of formData.entries()) {
                    if (key.startsWith(category) && value) {
                        if (categoryContent === '') {
                            categoryContent += `<div style="margin-bottom: 20px;"><h4 style="color: #C9B178; margin-bottom: 10px; text-transform: capitalize;">${category.replace('-', ' ')}</h4>`;
                            hasAssets = true;
                        }
                        categoryContent += `<p style="margin-left: 20px;"><strong>${key} :</strong> ${value}</p>`;
                        
                        // Calcul du total si c'est une valeur monétaire
                        if (key.includes('[valeur]') || key.includes('[solde]')) {
                            totalValue += parseFloat(value) || 0;
                        }
                    }
                }
                if (categoryContent !== '') {
                    categoryContent += '</div>';
                    content += categoryContent;
                }
            });
            
            if (!hasAssets) {
                content += '<p>Aucun bien spécifié.</p>';
            }
            
            if (totalValue > 0) {
                content += `
                    <div style="background-color: #f5f5f5; padding: 15px; border-radius: 8px; margin-top: 20px;">
                        <h4 style="color: #2D4C68; margin-bottom: 10px;">Récapitulatif du patrimoine</h4>
                        <p><strong>Valeur totale estimée :</strong> ${totalValue.toLocaleString('fr-FR')} €</p>
                        <p style="font-size: 0.9rem; color: #666;">Date d'évaluation : ${formData.get('evaluationDate') || 'Non spécifiée'}</p>
                        ${formData.get('evaluationNotes') ? `<p style="font-size: 0.9rem;"><strong>Notes :</strong> ${formData.get('evaluationNotes')}</p>` : ''}
                    </div>
                `;
            }
            
            content += '</div>';
            return content;
        }

        function generateZakatSection(formData) {
            let content = `
                <div style="margin-bottom: 30px; page-break-inside: avoid;">
                    <h3 style="color: #2D4C68; border-bottom: 2px solid #C9B178; padding-bottom: 10px; margin-bottom: 20px;">ZAKAT, DETTES ET CRÉANCES</h3>
            `;
            
            // Calcul Zakat
            const zakatEpargne = parseFloat(formData.get('zakatEpargne')) || 0;
            const zakatOr = parseFloat(formData.get('zakatOr')) || 0;
            const zakatArgent = parseFloat(formData.get('zakatArgent')) || 0;
            const zakatInvestissements = parseFloat(formData.get('zakatInvestissements')) || 0;
            const zakatCommerce = parseFloat(formData.get('zakatCommerce')) || 0;
            const zakatCreances = parseFloat(formData.get('zakatCreances')) || 0;
            const zakatDettes = parseFloat(formData.get('zakatDettes')) || 0;
            
            const patrimoineZakat = zakatEpargne + zakatOr + zakatArgent + zakatInvestissements + zakatCommerce + zakatCreances - zakatDettes;
            const nissab = 4914;
            const zakatDue = patrimoineZakat >= nissab ? patrimoineZakat * 0.025 : 0;
            
            if (patrimoineZakat > 0) {
                content += `
                    <div style="background-color: #f0f8f0; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: #2D4C68; margin-bottom: 10px;">Calcul de la Zakat</h4>
                        <p><strong>Patrimoine soumis à Zakat :</strong> ${patrimoineZakat.toLocaleString('fr-FR')} €</p>
                        <p><strong>Nissab (seuil minimum) :</strong> ${nissab.toLocaleString('fr-FR')} €</p>
                        <p><strong>Zakat due (2,5%) :</strong> ${zakatDue.toLocaleString('fr-FR')} €</p>
                        <p><strong>Statut :</strong> ${patrimoineZakat >= nissab ? 'Zakat obligatoire' : 'Zakat non obligatoire'}</p>
                        ${formData.get('zakatDerniereAnnee') ? `<p><strong>Dernière année de paiement :</strong> ${formData.get('zakatDerniereAnnee')}</p>` : ''}
                        ${formData.get('zakatBeneficiaires') ? `<p><strong>Bénéficiaires habituels :</strong><br>${formData.get('zakatBeneficiaires')}</p>` : ''}
                    </div>
                `;
            }
            
            // Dettes et créances
            const debtCategories = ['dettes', 'creances', 'dons-sadaqat'];
            debtCategories.forEach(category => {
                let categoryContent = '';
                for (let [key, value] of formData.entries()) {
                    if (key.startsWith(category) && value) {
                        if (categoryContent === '') {
                            categoryContent += `<div style="margin-bottom: 20px;"><h4 style="color: #C9B178; margin-bottom: 10px; text-transform: capitalize;">${category.replace('-', ' ')}</h4>`;
                        }
                        categoryContent += `<p style="margin-left: 20px;"><strong>${key} :</strong> ${value}</p>`;
                    }
                }
                if (categoryContent !== '') {
                    categoryContent += '</div>';
                    content += categoryContent;
                }
            });
            
            content += '</div>';
            return content;
        }

        function generateLegsSection(formData) {
            let content = `
                <div style="margin-bottom: 30px; page-break-inside: avoid;">
                    <h3 style="color: #2D4C68; border-bottom: 2px solid #C9B178; padding-bottom: 10px; margin-bottom: 20px;">LEGS ET HÉRITAGE ISLAMIQUE</h3>
            `;
            
            // Legs
            let legsContent = '';
            let totalLegs = 0;
            for (let [key, value] of formData.entries()) {
                if (key.startsWith('legs') && value) {
                    if (legsContent === '') {
                        legsContent += '<div style="margin-bottom: 20px;"><h4 style="color: #C9B178; margin-bottom: 10px;">Legs spécifiques (Wassiya)</h4>';
                    }
                    legsContent += `<p style="margin-left: 20px;"><strong>${key} :</strong> ${value}</p>`;
                    
                    if (key.includes('[valeur]')) {
                        totalLegs += parseFloat(value) || 0;
                    }
                }
            }
            if (legsContent !== '') {
                legsContent += '</div>';
                content += legsContent;
                
                if (totalLegs > 0) {
                    const maxLegs = totalPatrimoine / 3;
                    content += `
                        <div style="background-color: ${totalLegs > maxLegs ? '#fff0f0' : '#f0f8f0'}; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <p><strong>Total des legs :</strong> ${totalLegs.toLocaleString('fr-FR')} €</p>
                            <p><strong>Maximum autorisé (1/3) :</strong> ${maxLegs.toLocaleString('fr-FR')} €</p>
                            ${totalLegs > maxLegs ? '<p style="color: #d32f2f;"><strong>⚠️ Attention :</strong> Les legs dépassent le tiers autorisé</p>' : ''}
                        </div>
                    `;
                }
            }
            
            // Instructions générales
            if (formData.get('heritageInstructions') || formData.get('evaluationPatrimoine') || formData.get('fraisObseques')) {
                content += `
                    <div style="margin-top: 20px;">
                        <h4 style="color: #C9B178; margin-bottom: 10px;">Instructions pour l'héritage</h4>
                        ${formData.get('heritageInstructions') ? `<p><strong>Instructions générales :</strong><br>${formData.get('heritageInstructions')}</p>` : ''}
                        ${formData.get('evaluationPatrimoine') ? `<p><strong>Évaluation du patrimoine :</strong><br>${formData.get('evaluationPatrimoine')}</p>` : ''}
                        ${formData.get('fraisObseques') ? `<p><strong>Frais d'obsèques :</strong><br>${formData.get('fraisObseques')}</p>` : ''}
                    </div>
                `;
            }
            
            content += '</div>';
            return content;
        }

        function generateDigitalSection(formData) {
            let content = `
                <div style="margin-bottom: 30px; page-break-inside: avoid;">
                    <h3 style="color: #2D4C68; border-bottom: 2px solid #C9B178; padding-bottom: 10px; margin-bottom: 20px;">PATRIMOINE NUMÉRIQUE</h3>
            `;
            
            const digitalCategories = ['emails', 'reseaux-sociaux', 'services-en-ligne', 'appareils'];
            let hasDigital = false;
            
            digitalCategories.forEach(category => {
                let categoryContent = '';
                for (let [key, value] of formData.entries()) {
                    if (key.startsWith(category) && value) {
                        if (categoryContent === '') {
                            categoryContent += `<div style="margin-bottom: 20px;"><h4 style="color: #C9B178; margin-bottom: 10px; text-transform: capitalize;">${category.replace('-', ' ')}</h4>`;
                            hasDigital = true;
                        }
                        // Masquer les mots de passe dans le PDF
                        if (key.includes('[motdepasse]') || key.includes('[pin]') || key.includes('[code]')) {
                            categoryContent += `<p style="margin-left: 20px;"><strong>${key} :</strong> [CONFIDENTIEL - Voir document sécurisé]</p>`;
                        } else {
                            categoryContent += `<p style="margin-left: 20px;"><strong>${key} :</strong> ${value}</p>`;
                        }
                    }
                }
                if (categoryContent !== '') {
                    categoryContent += '</div>';
                    content += categoryContent;
                }
            });
            
            if (!hasDigital) {
                content += '<p>Aucun compte numérique spécifié.</p>';
            }
            
            // Instructions générales
            if (formData.get('gestionnaireMdp') || formData.get('instructionsNumeriques') || formData.get('contactTechnique')) {
                content += `
                    <div style="background-color: #fff8e1; padding: 15px; border-radius: 8px; margin-top: 20px;">
                        <h4 style="color: #2D4C68; margin-bottom: 10px;">Informations générales</h4>
                        ${formData.get('gestionnaireMdp') ? `<p><strong>Gestionnaire de mots de passe :</strong> ${formData.get('gestionnaireMdp')}</p>` : ''}
                        ${formData.get('contactTechnique') ? `<p><strong>Contact technique :</strong> ${formData.get('contactTechnique')}</p>` : ''}
                        ${formData.get('instructionsNumeriques') ? `<p><strong>Instructions générales :</strong><br>${formData.get('instructionsNumeriques')}</p>` : ''}
                        ${formData.get('documentsNumeriques') ? `<p><strong>Documents numériques :</strong><br>${formData.get('documentsNumeriques')}</p>` : ''}
                        <p style="color: #d32f2f; font-size: 0.9rem; margin-top: 10px;"><strong>⚠️ Sécurité :</strong> Les mots de passe complets sont dans un document séparé sécurisé.</p>
                    </div>
                `;
            }
            
            content += '</div>';
            return content;
        }

        // Envoi par email
        function envoyerParEmail() {
            alert('La fonction d\'envoi par email nécessite un service backend pour des raisons de sécurité. Le PDF sera généré pour téléchargement.');
            genererPDF();
        }

        // Impression
        function imprimerTestament() {
            genererPDF();
        }

        // Sauvegarde automatique
        function sauvegarderBrouillon() {
            const form = document.getElementById('testamentForm');
            const formData = new FormData(form);
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }
            
            data['currentStep'] = currentStep;
            data['saveDate'] = new Date().toISOString();
            
            try {
                localStorage.setItem('testamentBrouillon', JSON.stringify(data));
                showSaveIndicator('Brouillon sauvegardé automatiquement');
            } catch (error) {
                console.error('Erreur lors de la sauvegarde:', error);
            }
        }

        function chargerBrouillon() {
            try {
                const brouillon = localStorage.getItem('testamentBrouillon');
                if (!brouillon) return;
                
                const data = JSON.parse(brouillon);
                
                Object.keys(data).forEach(key => {
                    if (key === 'currentStep' || key === 'saveDate') return;
                    
                    const element = document.querySelector(`[name="${key}"]`);
                    if (element) {
                        element.value = data[key];
                        
                        // Déclencher les recalculs si nécessaire
                        if (key.includes('[valeur]') || key.includes('[solde]')) {
                            updateTotal();
                        }
                        if (key.startsWith('zakat')) {
                            calculerZakat();
                        }
                        if (key.includes('legs')) {
                            updateLegsTotal();
                        }
                    }
                });
                
                if (data.currentStep && data.currentStep > 1) {
                    goToStep(parseInt(data.currentStep));
                }
                
                showSaveIndicator('Brouillon chargé');
            } catch (error) {
                console.error('Erreur lors du chargement du brouillon:', error);
            }
        }

        function showSaveIndicator(message) {
            const indicator = document.getElementById('saveIndicator');
            if (indicator) {
                indicator.innerHTML = `<i class="fas fa-check"></i> ${message}`;
                indicator.classList.add('visible');
                
                setTimeout(() => {
                    indicator.classList.remove('visible');
                }, 3000);
            }
        }

        // Fonctions de partage (vos fonctions existantes conservées)
        function partagerWhatsApp() {
            const url = encodeURIComponent(window.location.href);
            const text = encodeURIComponent('Découvrez Al Wassiya - Un outil gratuit pour créer votre testament islamique facilement et conformément à la Charia');
            window.open(`https://wa.me/?text=${text} ${url}`, '_blank');
        }

        function partagerFacebook() {
            const url = encodeURIComponent(window.location.href);
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
        }

        function partagerTwitter() {
            const url = encodeURIComponent(window.location.href);
            const text = encodeURIComponent('Al Wassiya - Testament islamique gratuit et conforme à la Charia');
            window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`, '_blank');
        }

        function partagerEmail() {
            const subject = encodeURIComponent('Al Wassiya - Testament islamique');
            const body = encodeURIComponent('Découvrez Al Wassiya, un outil gratuit pour créer votre testament islamique: ' + window.location.href);
            window.location.href = `mailto:?subject=${subject}&body=${body}`;
        }
    </script>

    <!-- MODIFICATION 7: Footer complet -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3><i class="fas fa-phone"></i> Contact</h3>
                <p><i class="fas fa-building"></i> Al Wassiya</p>
                <p><i class="fas fa-envelope"></i> contact@alwassiya.com</p>
                <p><i class="fas fa-phone-alt"></i> +33 1 23 45 67 89</p>
                <p><i class="fas fa-map-marker-alt"></i> Paris, France</p>
            </div>
            <div class="footer-section">
                <h3><i class="fas fa-balance-scale"></i> Informations légales</h3>
                <a href="#"><i class="fas fa-file-contract"></i> Mentions légales</a>
                <a href="#"><i class="fas fa-shield-alt"></i> Politique de confidentialité</a>
                <a href="#"><i class="fas fa-handshake"></i> Conditions d'utilisation</a>
                <a href="#"><i class="fas fa-cookie-bite"></i> Gestion des cookies</a>
            </div>
            <div class="footer-section">
                <h3><i class="fas fa-share-alt"></i> Suivez-nous</h3>
                <a href="#" onclick="partagerFacebook()" aria-label="Facebook"><i class="fab fa-facebook-f"></i> Facebook</a>
                <a href="#" onclick="partagerTwitter()" aria-label="Twitter"><i class="fab fa-twitter"></i> Twitter</a>
                <a href="#" onclick="partagerWhatsApp()" aria-label="WhatsApp"><i class="fab fa-whatsapp"></i> WhatsApp</a>
                <a href="#" onclick="partagerEmail()" aria-label="Email"><i class="fas fa-envelope"></i> Newsletter</a>
            </div>
            <div class="footer-section">
                <h3><i class="fas fa-info-circle"></i> À propos</h3>
                <p>Al Wassiya est un service gratuit qui vous aide à préparer votre testament islamique conformément aux préceptes du Coran et de la Sunna.</p>
                <p style="font-size: 0.9rem; margin-top: 15px; font-style: italic;">
                    <i class="fas fa-quote-right"></i> "Et quiconque craint Allah, Il lui donnera une issue favorable" - Coran 65:2
                </p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>© 2025 Al Wassiya. Tous droits réservés. | Développé pour la communauté musulmane</p>
        </div>
    </footer>

</body>
</html>
