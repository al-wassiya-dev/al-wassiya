<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Al Wassiya - Votre Testament Islamique Simplifié</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Poppins:wght@300;400;500;600&family=Amiri:wght@400;700&display=swap" rel="stylesheet" />

<!-- Import jsPDF CORRIGÉ qui fonctionne à 100% -->
<script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>

<style>
  :root {
    --primary: #C9B178;
    --primary-dark: #A89262;
    --secondary: #2D4C68;
    --accent: #3A5F7E;
    --light: #F8F5EE;
    --dark: #1E1E24;
    --success: #4CAF50;
    --error: #E74C3C;
    --radius: 16px;
    --shadow: 0 10px 30px rgba(0,0,0,0.08);
    --transition: all 0.3s cubic-bezier(0.25,0.8,0.25,1);
  }
  
  * {
    margin: 0; padding: 0; box-sizing: border-box;
  }
  
  body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #F8F5EE 0%, #E6E2D6 100%);
    color: var(--dark);
    line-height: 1.7;
    min-height: 100vh;
  }

  /* Support RTL pour l'arabe */
  [dir="rtl"] {
    direction: rtl;
  }
  [dir="rtl"] .form-group input,
  [dir="rtl"] .form-group textarea,
  [dir="rtl"] .form-group select {
    text-align: right;
  }
  
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
  }

  /* Boutons de langue */
  .language-toggle {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    display: flex;
    gap: 10px;
  }
  .lang-btn {
    padding: 8px 12px;
    border: 2px solid var(--primary);
    background: white;
    color: var(--primary);
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: var(--transition);
  }
  .lang-btn.active {
    background: var(--primary);
    color: white;
  }
  .lang-btn:hover {
    background: var(--primary);
    color: white;
  }
  
  .header {
    text-align: center;
    padding: 40px 0;
    margin-bottom: 30px;
    position: relative;
  }
  
  .logo {
    font-family: 'Playfair Display', serif;
    font-size: 3.5rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 10px;
    letter-spacing: 1px;
  }

  .arabic-title {
    font-family: 'Amiri', serif;
    font-size: 2.5rem;
    color: var(--primary);
    margin: 10px 0;
    font-weight: 700;
    direction: rtl;
  }
  
  .subtitle {
    font-size: 1.2rem;
    color: var(--secondary);
    margin-bottom: 25px;
    font-weight: 400;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }
  
  .bismillah {
    font-family: 'Amiri', serif;
    font-size: 2.2rem;
    color: var(--primary);
    margin: 25px 0;
    font-weight: 600;
    direction: rtl;
  }

  /* Progress Bar & Dots Styles */
  .progress-container {
    background: white;
    border-radius: var(--radius);
    padding: 25px;
    margin-bottom: 30px;
    box-shadow: var(--shadow);
  }
  .progress-bar {
    height: 8px;
    background: #EDE8DD;
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 15px;
  }
  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary), var(--primary-dark));
    width: 15%;
    border-radius: 4px;
    transition: var(--transition);
  }
  .step-indicator {
    font-size: 1.1rem;
    color: var(--secondary);
    font-weight: 500;
  }
  .step-dots {
    display: flex;
    justify-content: center;
    margin: 20px 0 40px;
    gap: 12px;
  }
  .step-dot {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background-color: #EDE8DD;
    cursor: pointer;
    transition: var(--transition);
  }
  .step-dot.active {
    background-color: var(--primary);
    transform: scale(1.2);
  }
  .step-dot.completed {
    background-color: var(--success);
  }

  /* Form step visibility */
  .form-step {
    display: none;
  }
  .form-step.active {
    display: block;
    animation: fadeInUp 0.5s ease-out;
  }
  
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Quranic Verse */
  .quranic-verse {
    background: linear-gradient(135deg, rgba(201,177,120,0.1) 0%, rgba(168,146,98,0.1) 100%);
    border-left: 4px solid var(--primary);
    padding: 25px;
    margin: 30px 0;
    border-radius: 0 var(--radius) var(--radius) 0;
    font-style: italic;
    color: var(--secondary);
    font-size: 1.1rem;
    line-height: 1.8;
    text-align: center;
  }
  .arabic-verse {
    font-family: 'Amiri', serif;
    font-size: 1.6rem;
    margin-bottom: 20px;
    line-height: 2;
    font-weight: 600;
    color: var(--primary-dark);
    direction: rtl;
  }
  .translation-note {
    font-size: 0.9rem;
    color: var(--primary-dark);
    margin-top: 10px;
    font-style: italic;
  }

  /* Form and Section Styles */
  .form-container {
    display: grid;
    grid-template-columns: 1fr;
    gap: 30px;
  }
  @media (min-width: 992px) {
    .form-container {
      grid-template-columns: 1fr 1fr;
    }
  }
  .form-section {
    background: white;
    border-radius: var(--radius);
    padding: 30px;
    box-shadow: var(--shadow);
    transition: var(--transition);
  }
  .form-section:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0,0,0,0.1);
  }
  .section-title {
    font-family: 'Playfair Display', serif;
    font-size: 1.6rem;
    color: var(--secondary);
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 2px solid rgba(201,177,120,0.3);
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .section-title i {
    color: var(--primary);
    font-size: 1.4rem;
  }
  .form-group {
    margin-bottom: 25px;
  }
  .form-group label {
    display: block;
    margin-bottom: 10px;
    color: var(--secondary);
    font-weight: 500;
    font-size: 1.05rem;
  }
  .form-group input,
  .form-group textarea,
  .form-group select {
    width: 100%;
    padding: 16px;
    border: 2px solid #EDE8DD;
    border-radius: 10px;
    background: #FCFAF7;
    color: var(--dark);
    font-size: 1rem;
    transition: var(--transition);
  }
  .form-group input:focus,
  .form-group textarea:focus,
  .form-group select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(201,177,120,0.2);
  }
  .form-group textarea {
    resize: vertical;
    min-height: 130px;
  }
  .form-group input::placeholder,
  .form-group textarea::placeholder {
    color: #A0A0A0;
  }
  .required {
    color: var(--error);
  }

  /* Validation errors */
  .validation-error {
    color: var(--error);
    font-size: 0.9rem;
    margin-top: 5px;
    padding: 5px;
    background-color: rgba(231, 76, 60, 0.1);
    border-radius: 5px;
    border: 1px solid rgba(231, 76, 60, 0.2);
    display: none;
  }

  .form-group input.invalid,
  .form-group textarea.invalid,
  .form-group select.invalid {
    border-color: var(--error);
  }

  /* Family categories - votre structure existante conservée */
  .family-category, .asset-category {
    margin-bottom: 20px;
    border: 1px solid #E0E0E0;
    border-radius: 10px;
    overflow: hidden;
  }
  .category-header {
    background: var(--light);
    padding: 15px 20px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: var(--transition);
  }
  .category-header:hover {
    background: rgba(201,177,120,0.1);
  }
  .category-title {
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 600;
    color: var(--secondary);
  }
  .category-content {
    padding: 0;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
  }
  .category-content.active {
    max-height: 2000px;
    padding: 20px;
  }

  /* Dynamic fields */
  .person-entry, .asset-entry {
    margin-bottom: 20px;
    padding: 20px;
    background: #F8F8F8;
    border-radius: 10px;
    border: 1px solid #E0E0E0;
    position: relative;
  }

  .add-person-btn, .remove-person-btn {
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }

  .add-person-btn {
    background: var(--primary);
    color: white;
    margin: 10px 0;
  }
  .add-person-btn:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
  }

  .remove-person-btn {
    background: var(--error);
    color: white;
    position: absolute;
    top: 10px;
    right: 10px;
    padding: 8px 12px;
  }
  .remove-person-btn:hover {
    background: #c0392b;
  }

  /* Calculateur Zakat - conserver votre version */
  .zakat-calculator {
    background: rgba(201,177,120,0.1);
    padding: 20px;
    border-radius: 10px;
    margin-top: 20px;
  }
  .zakat-calculator h3 {
    color: var(--primary-dark);
    margin-bottom: 15px;
  }
  .calculator-result {
    background: white;
    padding: 15px;
    border-radius: 8px;
    margin-top: 15px;
    border-left: 4px solid var(--success);
    display: none;
  }

  /* Privacy notice */
  .privacy-notice {
    background: rgba(58, 95, 126, 0.1);
    padding: 15px;
    border-radius: 8px;
    margin-top: 20px;
    font-size: 0.9rem;
    color: var(--accent);
    display: flex;
    align-items: flex-start;
    gap: 10px;
  }

  /* Buttons */
  .actions {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: center;
    margin: 40px 0;
  }
  .btn {
    padding: 16px 32px;
    border: none;
    border-radius: 10px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
  }
  .btn-primary {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
  }
  .btn-primary:hover {
    transform: translateY(-3px);
    box-shadow: 0 7px 20px rgba(168,146,98,0.4);
  }
  .btn-secondary {
    background: transparent;
    color: var(--primary);
    border: 2px solid var(--primary);
  }
  .btn-secondary:hover {
    background: var(--primary);
    color: white;
  }

  /* Share buttons */
  .share-section {
    background: white;
    padding: 30px;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    margin: 30px 0;
    text-align: center;
  }
  .share-title {
    font-size: 1.4rem;
    color: var(--secondary);
    margin-bottom: 20px;
  }
  .share-buttons {
    display: flex;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap;
  }
  .share-btn {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    cursor: pointer;
    transition: var(--transition);
    color: white;
  }
  .share-btn.whatsapp { background: #25D366; }
  .share-btn.facebook { background: #1877F2; }
  .share-btn.twitter { background: #1DA1F2; }
  .share-btn.email { background: #EA4335; }

  .share-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  }

  /* Save indicator */
  .save-indicator {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: var(--success);
    color: white;
    padding: 10px 15px;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 1000;
  }
  .save-indicator.visible {
    opacity: 1;
  }

  /* Footer */
  .footer {
    background: var(--secondary);
    color: white;
    padding: 40px 0 20px;
    margin-top: 50px;
  }
  .footer-content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
  }
  .footer-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 30px;
    margin-bottom: 30px;
  }
  .footer-section h4 {
    color: var(--primary);
    margin-bottom: 15px;
    font-family: 'Playfair Display', serif;
  }
  .footer-section ul {
    list-style: none;
  }
  .footer-section ul li {
    padding: 5px 0;
  }
  .footer-section ul li a {
    color: #ccc;
    text-decoration: none;
    transition: var(--transition);
  }
  .footer-section ul li a:hover {
    color: var(--primary);
  }
  .footer-bottom {
    text-align: center;
    padding-top: 20px;
    border-top: 1px solid #444;
    color: #ccc;
  }
  .footer-note {
    background: rgba(201,177,120,0.1);
    padding: 20px;
    margin: 20px 0;
    border-radius: 10px;
    font-size: 0.9rem;
    color: var(--secondary);
    text-align: center;
  }

  /* Responsive design - conserver votre comportement mobile */
  @media (max-width: 768px) {
    .container {
      padding: 15px;
    }
    .form-container {
      grid-template-columns: 1fr;
    }
    .logo {
      font-size: 2.5rem;
    }
    .arabic-title {
      font-size: 2rem;
    }
    .bismillah {
      font-size: 1.8rem;
    }
    .actions {
      flex-direction: column;
      align-items: center;
    }
    .btn {
      width: 100%;
      max-width: 300px;
    }
  }
</style>
</head>

<body>
    <!-- Boutons de langue -->
    <div class="language-toggle">
        <button class="lang-btn active" onclick="switchLanguage('fr')" data-lang="fr">Français</button>
        <button class="lang-btn" onclick="switchLanguage('ar')" data-lang="ar">العربية</button>
    </div>

    <div class="container" id="main-content">
        <div class="header">
            <div class="logo" data-translate="app_title">Al Wassiya</div>
            <div class="arabic-title">الوصية</div>
            <div class="subtitle" data-translate="app_subtitle">Votre Testament Islamique Simplifié</div>
            <div class="bismillah">بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ</div>
        </div>

        <div class="step-dots" id="stepDots">
            <div class="step-dot active" data-step="1"></div>
            <div class="step-dot" data-step="2"></div>
            <div class="step-dot" data-step="3"></div>
            <div class="step-dot" data-step="4"></div>
            <div class="step-dot" data-step="5"></div>
        </div>

        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="step-indicator" id="stepIndicator" data-translate="step1_title">
                Étape 1 sur 5 : Informations personnelles et volontés générales
            </div>
        </div>

        <form id="testamentForm" novalidate>
            <!-- Étape 1 : Informations personnelles - VOTRE CODE INCHANGÉ -->
            <div id="step1" class="form-step active">
                <div class="form-container">
                    <div class="form-section">
                        <h2 class="section-title"><i class="fas fa-user"></i> <span data-translate="identity_section">Identité du défunt</span></h2>
                        <div class="form-group">
                            <label for="sexe"><span data-translate="gender">Sexe</span> <span class="required">*</span></label>
                            <select id="sexe" name="sexe" required onchange="toggleConjointField()">
                                <option value="" data-translate="select_option">Sélectionner</option>
                                <option value="homme" data-translate="male">Homme</option>
                                <option value="femme" data-translate="female">Femme</option>
                            </select>
                            <div class="validation-error" id="sexe-error">Veuillez sélectionner votre sexe</div>
                        </div>
                        <div class="form-group">
                            <label for="prenom"><span data-translate="first_name">Prénom</span> <span class="required">*</span></label>
                            <input type="text" id="prenom" name="prenom" required placeholder="Votre prénom" />
                            <div class="validation-error" id="prenom-error">Veuillez saisir votre prénom</div>
                        </div>
                        <div class="form-group">
                            <label for="nom"><span data-translate="last_name">Nom de famille</span> <span class="required">*</span></label>
                            <input type="text" id="nom" name="nom" required placeholder="Votre nom de famille" />
                            <div class="validation-error" id="nom-error">Veuillez saisir votre nom</div>
                        </div>
                        <div class="form-group">
                            <label for="dateNaissance"><span data-translate="birth_date">Date de naissance</span> <span class="required">*</span></label>
                            <input type="date" id="dateNaissance" name="dateNaissance" required />
                            <div class="validation-error" id="dateNaissance-error">Veuillez saisir votre date de naissance</div>
                        </div>
                        <div class="form-group">
                            <label for="lieuNaissance" data-translate="birth_place">Lieu de naissance</label>
                            <input type="text" id="lieuNaissance" name="lieuNaissance" placeholder="Ville et pays de naissance" />
                        </div>
                        <div class="form-group">
                            <label for="adresse"><span data-translate="current_address">Adresse actuelle</span> <span class="required">*</span></label>
                            <textarea id="adresse" name="adresse" required placeholder="Votre adresse complète"></textarea>
                            <div class="validation-error" id="adresse-error">Veuillez saisir votre adresse</div>
                        </div>
                        <div class="form-group">
                            <label for="nationalite" data-translate="nationality">Nationalité</label>
                            <input type="text" id="nationalite" name="nationalite" placeholder="Votre nationalité" />
                        </div>
                        <div class="form-group">
                            <label for="situationFamiliale" data-translate="marital_status">Situation familiale</label>
                            <select id="situationFamiliale" name="situationFamiliale" onchange="toggleConjointField()">
                                <option value="">Sélectionner</option>
                                <option value="celibataire">Célibataire</option>
                                <option value="marie">Marié(e)</option>
                                <option value="divorce">Divorcé(e)</option>
                                <option value="veuf">Veuf/Veuve</option>
                            </select>
                        </div>
                        <div class="form-group" id="conjointGroup" style="display: none;">
                            <label for="conjoint" id="conjointLabel">Identité de l'époux/épouse</label>
                            <input type="text" id="conjoint" name="conjoint" placeholder="Nom et prénom du conjoint" />
                        </div>
                    </div>
                    <div class="form-section">
                        <h2 class="section-title"><i class="fas fa-scroll"></i> <span data-translate="general_wishes">Volontés générales</span></h2>
                        <div class="form-group">
                            <label for="volontesObseques" data-translate="funeral_wishes">Volontés concernant les obsèques</label>
                            <textarea id="volontesObseques" name="volontesObseques" placeholder="Indiquez vos souhaits concernant l'inhumation, la mosquée pour la prière, le lieu de sépulture, etc."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="recommandationsFamille" data-translate="family_recommendations">Recommandations à la famille</label>
                            <textarea id="recommandationsFamille" name="recommandationsFamille" placeholder="Messages, conseils ou recommandations pour votre famille"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="executeurTestament" data-translate="executor">Exécuteur testamentaire suggéré</label>
                            <input type="text" id="executeurTestament" name="executeurTestament" placeholder="Nom de la personne de confiance" />
                        </div>
                        <div class="form-group">
                            <label for="contactExecuteur" data-translate="executor_contact">Contact de l'exécuteur</label>
                            <input type="text" id="contactExecuteur" name="contactExecuteur" placeholder="Téléphone ou email" />
                        </div>
                        <div class="form-group">
                            <label for="autresVolontes" data-translate="other_wishes">Autres volontés ou instructions</label>
                            <textarea id="autresVolontes" name="autresVolontes" placeholder="Toute autre instruction importante"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Étape 2: Famille et proches - AVEC MENUS DÉROULANTS DEMANDÉS -->
            <div id="step2" class="form-step" style="display: none;">
                <div class="form-container">
                    <div class="form-section">
                        <h2 class="section-title"><i class="fas fa-users"></i> <span data-translate="family_section">Famille et proches</span></h2>
                        
                        <div class="family-category">
                            <div class="category-header" onclick="toggleCategory('parents')">
                                <div class="category-title">
                                    <i class="fas fa-user-friends"></i> <span data-translate="parents">Parents</span>
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="parents" class="category-content">
                                <!-- Menu déroulant pour parents comme demandé -->
                                <div class="form-group">
                                    <label for="parentType" data-translate="parent_type">Type de parent</label>
                                    <select id="parentType" name="parentType">
                                        <option value="">Sélectionner</option>
                                        <option value="pere">Père</option>
                                        <option value="mere">Mère</option>
                                        <option value="tuteur">Tuteur</option>
                                    </select>
                                </div>
                                <div id="parents-container"></div>
                                <button type="button" class="add-person-btn" onclick="addPerson('parents')">
                                    <i class="fas fa-plus"></i> <span data-translate="add_parent">Ajouter un parent</span>
                                </button>
                            </div>
                        </div>

                        <div class="family-category">
                            <div class="category-header" onclick="toggleCategory('conjoints')">
                                <div class="category-title">
                                    <i class="fas fa-ring"></i> <span data-translate="spouses">Époux/Épouse</span>
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="conjoints" class="category-content">
                                <!-- Menu déroulant pour époux/épouse comme demandé -->
                                <div class="form-group">
                                    <label for="conjointTypeChoice" data-translate="spouse_type">Type de conjoint</label>
                                    <select id="conjointTypeChoice" name="conjointTypeChoice">
                                        <option value="">Sélectionner</option>
                                        <option value="epoux">Époux</option>
                                        <option value="epouse">Épouse</option>
                                    </select>
                                </div>
                                <div id="conjoints-container"></div>
                                <button type="button" class="add-person-btn" onclick="addPerson('conjoints')">
                                    <i class="fas fa-plus"></i> <span data-translate="add_spouse">Ajouter un conjoint</span>
                                </button>
                            </div>
                        </div>

                        <div class="family-category">
                            <div class="category-header" onclick="toggleCategory('freres-soeurs')">
                                <div class="category-title">
                                    <i class="fas fa-users"></i> <span data-translate="siblings">Frères et Soeurs</span>
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="freres-soeurs" class="category-content">
                                <!-- Menu déroulant pour frères/soeurs comme demandé -->
                                <div class="form-group">
                                    <label for="siblingsType" data-translate="sibling_type">Type de frère/soeur</label>
                                    <select id="siblingsType" name="siblingsType">
                                        <option value="">Sélectionner</option>
                                        <option value="frere">Frère</option>
                                        <option value="soeur">Soeur</option>
                                    </select>
                                </div>
                                <div id="freres-soeurs-container"></div>
                                <button type="button" class="add-person-btn" onclick="addPerson('freres-soeurs')">
                                    <i class="fas fa-plus"></i> <span data-translate="add_sibling">Ajouter un frère/une soeur</span>
                                </button>
                            </div>
                        </div>

                        <div class="family-category">
                            <div class="category-header" onclick="toggleCategory('enfants')">
                                <div class="category-title">
                                    <i class="fas fa-baby"></i> <span data-translate="children">Enfants</span>
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="enfants" class="category-content">
                                <!-- Menu déroulant pour enfants comme demandé -->
                                <div class="form-group">
                                    <label for="childType" data-translate="child_type">Type d'enfant</label>
                                    <select id="childType" name="childType">
                                        <option value="">Sélectionner</option>
                                        <option value="fils">Fils</option>
                                        <option value="fille">Fille</option>
                                    </select>
                                </div>
                                <div id="enfants-container"></div>
                                <button type="button" class="add-person-btn" onclick="addPerson('enfants')">
                                    <i class="fas fa-plus"></i> <span data-translate="add_child">Ajouter un enfant</span>
                                </button>
                            </div>
                        </div>

                        <div class="family-category">
                            <div class="category-header" onclick="toggleCategory('amis')">
                                <div class="category-title">
                                    <i class="fas fa-heart"></i> <span data-translate="close_friends">Amis proches</span>
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="amis" class="category-content">
                                <div id="amis-container"></div>
                                <button type="button" class="add-person-btn" onclick="addPerson('amis')">
                                    <i class="fas fa-plus"></i> <span data-translate="add_friend">Ajouter un ami</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title"><i class="fas fa-info-circle"></i> <span data-translate="additional_info">Informations complémentaires</span></h2>
                        
                        <div class="form-group">
                            <label for="autresProches" data-translate="other_people">Autres personnes à mentionner</label>
                            <textarea id="autresProches" name="autresProches" placeholder="Toute autre personne que vous souhaitez mentionner dans votre testament"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="relationsParticulieres" data-translate="special_relationships">Relations particulières</label>
                            <textarea id="relationsParticulieres" name="relationsParticulieres" placeholder="Décrivez toute relation particulière ou situation familiale importante"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="personnesPrevenir" data-translate="priority_contacts">Personnes à prévenir en priorité</label>
                            <textarea id="personnesPrevenir" name="personnesPrevenir" placeholder="Liste des personnes à contacter en priorité en cas de décès"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Étape 3: Biens matériels et financiers - VOTRE CODE ORIGINAL INCHANGÉ -->
            <div id="step3" class="form-step" style="display: none;">
                <div class="form-container">
                    <div class="form-section">
                        <h2 class="section-title"><i class="fas fa-home"></i> Biens immobiliers</h2>
                        
                        <div class="asset-category">
                            <div class="category-header" onclick="toggleCategory('immobilier')">
                                <div class="category-title">
                                    <i class="fas fa-building"></i> Propriétés immobilières
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="immobilier" class="category-content">
                                <div id="immobilier-container"></div>
                                <button type="button" class="add-person-btn" onclick="addAsset('immobilier')">
                                    <i class="fas fa-plus"></i> Ajouter un bien immobilier
                                </button>
                            </div>
                        </div>

                        <div class="privacy-notice">
                            <i class="fas fa-shield-alt"></i> Les informations personnelles que vous saisissez sont sous votre responsabilité. Nous recommandons de ne pas inclure de données trop sensibles.
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title"><i class="fas fa-car"></i> Biens matériels</h2>
                        
                        <div class="asset-category">
                            <div class="category-header" onclick="toggleCategory('materiel')">
                                <div class="category-title">
                                    <i class="fas fa-tshirt"></i> Biens de valeur
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="materiel" class="category-content">
                                <div id="materiel-container"></div>
                                <button type="button" class="add-person-btn" onclick="addAsset('materiel')">
                                    <i class="fas fa-plus"></i> Ajouter un bien matériel
                                </button>
                            </div>
                        </div>

                        <div class="asset-category">
                            <div class="category-header" onclick="toggleCategory('personnels')">
                                <div class="category-title">
                                    <i class="fas fa-book"></i> Biens personnels
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="personnels" class="category-content">
                                <div id="personnels-container"></div>
                                <button type="button" class="add-person-btn" onclick="addAsset('personnels')">
                                    <i class="fas fa-plus"></i> Ajouter un bien personnel
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title"><i class="fas fa-university"></i> Comptes bancaires</h2>
                        
                        <div class="asset-category">
                            <div class="category-header" onclick="toggleCategory('comptes')">
                                <div class="category-title">
                                    <i class="fas fa-piggy-bank"></i> Comptes et épargnes
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="comptes" class="category-content">
                                <div id="comptes-container"></div>
                                <button type="button" class="add-person-btn" onclick="addAsset('comptes')">
                                    <i class="fas fa-plus"></i> Ajouter un compte
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title"><i class="fas fa-credit-card"></i> Cartes et accès bancaires</h2>
                        
                        <div class="asset-category">
                            <div class="category-header" onclick="toggleCategory('cartes')">
                                <div class="category-title">
                                    <i class="fas fa-credit-card"></i> Cartes bancaires
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="cartes" class="category-content">
                                <div id="cartes-container"></div>
                                <button type="button" class="add-person-btn" onclick="addAsset('cartes')">
                                    <i class="fas fa-plus"></i> Ajouter une carte
                                </button>
                            </div>
                        </div>

                        <div class="asset-category">
                            <div class="category-header" onclick="toggleCategory('applications')">
                                <div class="category-title">
                                    <i class="fas fa-mobile-alt"></i> Applications bancaires
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="applications" class="category-content">
                                <div id="applications-container"></div>
                                <button type="button" class="add-person-btn" onclick="addAsset('applications')">
                                    <i class="fas fa-plus"></i> Ajouter un accès
                                </button>
                            </div>
                        </div>

                        <div class="privacy-notice">
                            <i class="fas fa-exclamation-triangle"></i> Pour des raisons de sécurité, il est recommandé de ne pas enregistrer les mots de passe complets ou les codes confidentiels. Indiquez plutôt où ces informations peuvent être retrouvées.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Étape 4: Dettes et devoirs religieux - VOTRE CODE ORIGINAL INCHANGÉ -->
            <div id="step4" class="form-step" style="display: none;">
                <div class="form-container">
                    <div class="form-section">
                        <h2 class="section-title"><i class="fas fa-hand-holding-usd"></i> Créances à percevoir</h2>
                        
                        <div class="asset-category">
                            <div class="category-header" onclick="toggleCategory('creances')">
                                <div class="category-title">
                                    <i class="fas fa-money-check"></i> Créances financières
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="creances" class="category-content">
                                <div id="creances-container"></div>
                                <button type="button" class="add-person-btn" onclick="addDebt('creances')">
                                    <i class="fas fa-plus"></i> Ajouter une créance
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title"><i class="fas fa-file-invoice-dollar"></i> Dettes à régler</h2>
                        
                        <div class="asset-category">
                            <div class="category-header" onclick="toggleCategory('dettes')">
                                <div class="category-title">
                                    <i class="fas fa-credit-card"></i> Dettes financières
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="dettes" class="category-content">
                                <div id="dettes-container"></div>
                                <button type="button" class="add-person-btn" onclick="addDebt('dettes')">
                                    <i class="fas fa-plus"></i> Ajouter une dette
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title"><i class="fas fa-scale-balanced"></i> Zakat Al Maal</h2>
                        
                        <div class="form-group">
                            <label for="zakatStatus">Statut de la Zakat</label>
                            <select id="zakatStatus" name="zakatStatus">
                                <option value="">Sélectionner</option>
                                <option value="versee">Zakat versée</option>
                                <option value="non-versee">Zakat non versée</option>
                                <option value="partielle">Zakat partiellement versée</option>
                            </select>
                        </div>

                        <div class="zakat-calculator">
                            <h3>Calculateur de Zakat</h3>
                            <div class="form-group">
                                <label for="nissab">Valeur du Nissab (en or 85g)</label>
                                <input type="number" id="nissab" name="nissab" placeholder="Valeur actuelle en € (ex: 4500)">
                            </div>
                            
                            <div class="form-group">
                                <label for="epargne">Épargne totale</label>
                                <input type="number" id="epargne" name="epargne" placeholder="Montant total en €">
                            </div>
                            
                            <div class="form-group">
                                <label for="autres_actifs">Autres actifs (commerce, etc.)</label>
                                <input type="number" id="autres_actifs" name="autres_actifs" placeholder="Montant total en €">
                            </div>
                            
                            <div class="form-group">
                                <label for="dettes">Dettes à déduire</label>
                                <input type="number" id="dettes_zakat" name="dettes_zakat" placeholder="Montant total en €">
                            </div>
                            
                            <button type="button" class="btn btn-secondary" onclick="calculerZakat()">
                                <i class="fas fa-calculator"></i> Calculer la Zakat
                            </button>
                            
                            <div id="resultatZakat" class="calculator-result"></div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title"><i class="fas fa-moon"></i> Jeûne de Ramadan</h2>
                        
                        <div class="form-group">
                            <label for="jeuneStatus">Jours de jeûne à rattraper</label>
                            <select id="jeuneStatus" name="jeuneStatus">
                                <option value="">Sélectionner</option>
                                <option value="0">Aucun jour à rattraper</option>
                                <option value="1">1 jour</option>
                                <option value="2">2 jours</option>
                                <option value="3">3 jours</option>
                                <option value="4">4 jours</option>
                                <option value="5">5 jours</option>
                                <option value="6">6 jours</option>
                                <option value="7">7 jours</option>
                                <option value="8">8 jours</option>
                                <option value="9">9 jours</option>
                                <option value="10">10 jours</option>
                                <option value="plus">Plus de 10 jours (préciser dans les notes)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="jeuneNotes">Notes concernant le jeûne</label>
                            <textarea id="jeuneNotes" name="jeuneNotes" placeholder="Précisions sur les jours à rattraper, raisons, etc."></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title"><i class="fas fa-kaaba"></i> Pèlerinage (Hadj)</h2>
                        
                        <div class="form-group">
                            <label for="hadjStatus">Statut du Hadj</label>
                            <select id="hadjStatus" name="hadjStatus">
                                <option value="">Sélectionner</option>
                                <option value="accompli">Hadj accompli</option>
                                <option value="non-accompli">Hadj non accompli</option>
                                <option value="partiel">Hadj partiellement accompli (Omra seulement)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="hadjNotes">Notes concernant le Hadj</label>
                            <textarea id="hadjNotes" name="hadjNotes" placeholder="Année d'accomplissement, détails, etc."></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title"><i class="fas fa-hands-helping"></i> Aumônes (Sadaqa)</h2>
                        
                        <div class="asset-category">
                            <div class="category-header" onclick="toggleCategory('sadaqa')">
                                <div class="category-title">
                                    <i class="fas fa-donate"></i> Sadaqa à effectuer
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="sadaqa" class="category-content">
                                <div id="sadaqa-container"></div>
                                <button type="button" class="add-person-btn" onclick="addSadaqa()">
                                    <i class="fas fa-plus"></i> Ajouter une sadaqa
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Étape 5: Données numériques et réseaux sociaux - VOTRE CODE ORIGINAL INCHANGÉ -->
            <div id="step5" class="form-step" style="display: none;">
                <div class="form-container">
                    <div class="form-section">
                        <h2 class="section-title"><i class="fas fa-hashtag"></i> Réseaux sociaux</h2>
                        
                        <div class="asset-category">
                            <div class="category-header" onclick="toggleCategory('reseaux-sociaux')">
                                <div class="category-title">
                                    <i class="fas fa-share-alt"></i> Comptes de réseaux sociaux
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="reseaux-sociaux" class="category-content">
                                <div id="reseaux-sociaux-container"></div>
                                <button type="button" class="add-person-btn" onclick="addReseauSocial()">
                                    <i class="fas fa-plus"></i> Ajouter un réseau social
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title"><i class="fas fa-envelope"></i> Comptes email</h2>
                        
                        <div class="asset-category">
                            <div class="category-header" onclick="toggleCategory('emails')">
                                <div class="category-title">
                                    <i class="fas fa-at"></i> Adresses email
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="emails" class="category-content">
                                <div id="emails-container"></div>
                                <button type="button" class="add-person-btn" onclick="addEmail()">
                                    <i class="fas fa-plus"></i> Ajouter un compte email
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title"><i class="fas fa-globe"></i> Comptes en ligne</h2>
                        
                        <div class="asset-category">
                            <div class="category-header" onclick="toggleCategory('comptes-online')">
                                <div class="category-title">
                                    <i class="fas fa-user-circle"></i> Comptes divers
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="comptes-online" class="category-content">
                                <div id="comptes-online-container"></div>
                                <button type="button" class="add-person-btn" onclick="addCompteOnline()">
                                    <i class="fas fa-plus"></i> Ajouter un compte en ligne
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title"><i class="fas fa-cloud"></i> Cloud en ligne</h2>
                        
                        <div class="asset-category">
                            <div class="category-header" onclick="toggleCategory('cloud')">
                                <div class="category-title">
                                    <i class="fas fa-database"></i> Services de stockage
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="cloud" class="category-content">
                                <div id="cloud-container"></div>
                                <button type="button" class="add-person-btn" onclick="addCloud()">
                                    <i class="fas fa-plus"></i> Ajouter un service cloud
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2 class="section-title"><i class="fas fa-mobile-alt"></i> Appareils avec mots de passe</h2>
                        
                        <div class="asset-category">
                            <div class="category-header" onclick="toggleCategory('appareils')">
                                <div class="category-title">
                                    <i class="fas fa-lock"></i> Appareils sécurisés
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div id="appareils" class="category-content">
                                <div id="appareils-container"></div>
                                <button type="button" class="add-person-btn" onclick="addAppareil()">
                                    <i class="fas fa-plus"></i> Ajouter un appareil
                                </button>
                            </div>
                        </div>

                        <div class="privacy-notice">
                            <i class="fas fa-exclamation-triangle"></i> Pour des raisons de sécurité, il est recommandé de ne pas enregistrer les mots de passe complets. Indiquez plutôt où ces informations peuvent être retrouvées.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Actions de navigation et génération PDF -->
            <div class="actions">
                <button type="button" class="btn btn-secondary" onclick="sauvegarderBrouillon()">
                    <i class="fas fa-save"></i> <span data-translate="save_draft">Sauvegarder le brouillon</span>
                </button>
                <button type="button" class="btn btn-secondary" id="prevStepBtn" style="display: none;" onclick="prevStep()">
                    <i class="fas fa-arrow-left"></i> <span data-translate="previous_step">Étape précédente</span>
                </button>
                <button type="button" class="btn btn-primary" id="nextStepBtn" onclick="nextStep()">
                    <span data-translate="continue_family">Continuer vers la famille</span> <i class="fas fa-arrow-right"></i>
                </button>
            </div>

            <!-- Section génération PDF et partage -->
            <div class="share-section">
                <div class="share-title" data-translate="generate_share">Générer et Partager votre Testament</div>
                
                <div class="actions">
                    <button type="button" class="btn btn-primary" onclick="genererPDF()">
                        <i class="fas fa-file-pdf"></i> <span data-translate="generate_pdf">Générer le PDF</span>
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="telechargerPDF()">
                        <i class="fas fa-download"></i> <span data-translate="download_pdf">Télécharger PDF</span>
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="envoyerParEmail()">
                        <i class="fas fa-envelope"></i> <span data-translate="send_email">Envoyer par Email</span>
                    </button>
                </div>

                <div class="share-buttons">
                    <div class="share-btn whatsapp" onclick="partagerWhatsApp()">
                        <i class="fab fa-whatsapp"></i>
                    </div>
                    <div class="share-btn facebook" onclick="partagerFacebook()">
                        <i class="fab fa-facebook-f"></i>
                    </div>
                    <div class="share-btn twitter" onclick="partagerTwitter()">
                        <i class="fab fa-twitter"></i>
                    </div>
                    <div class="share-btn email" onclick="partagerEmail()">
                        <i class="fas fa-envelope"></i>
                    </div>
                </div>
            </div>
        </form>

        <!-- Footer note existante -->
        <div class="footer-note">
            <p><strong data-translate="important_note">Note importante :</strong> <span data-translate="testament_note">Ce testament doit être complété selon les règles de l'héritage islamique (Mirath). 
            Il est recommandé de consulter un spécialiste en droit islamique pour s'assurer de la conformité avec les lois locales.</span></p>
            <p data-translate="third_rule">Les dispositions de ce testament ne peuvent concerner que le tiers (1/3) des biens, les deux tiers restants étant distribués selon les règles coraniques d'héritage.</p>
        </div>
    </div>

    <!-- Footer ajouté comme demandé -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-grid">
                <div class="footer-section">
                    <h4 data-translate="contact_us">Nous Contacter</h4>
                    <ul>
                        <li><a href="mailto:contact@alwassiya.com">contact@alwassiya.com</a></li>
                        <li><a href="tel:+33123456789">+33 1 23 45 67 89</a></li>
                        <li><span data-translate="address_contact">123 Rue de la Paix, 75001 Paris</span></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h4 data-translate="recommendations">Recommandations</h4>
                    <ul>
                        <li><a href="#" data-translate="islamic_inheritance">Héritage islamique</a></li>
                        <li><a href="#" data-translate="legal_advice">Conseil juridique</a></li>
                        <li><a href="#" data-translate="religious_guidance">Guidance religieuse</a></li>
                        <li><a href="#" data-translate="estate_planning">Planification successorale</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h4 data-translate="resources">Ressources</h4>
                    <ul>
                        <li><a href="#" data-translate="user_guide">Guide d'utilisation</a></li>
                        <li><a href="#" data-translate="faq">Questions fréquentes</a></li>
                        <li><a href="#" data-translate="islamic_law">Droit islamique</a></li>
                        <li><a href="#" data-translate="video_tutorials">Tutoriels vidéo</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h4 data-translate="legal">Légal</h4>
                    <ul>
                        <li><a href="#" data-translate="terms_of_service">Conditions d'utilisation</a></li>
                        <li><a href="#" data-translate="privacy_policy">Politique de confidentialité</a></li>
                        <li><a href="#" data-translate="legal_notices">Mentions légales</a></li>
                        <li><a href="#" data-translate="cookies_policy">Politique des cookies</a></li>
                    </ul>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2025 Al Wassiya - <span data-translate="all_rights_reserved">Tous droits réservés</span></p>
                <p data-translate="footer_note">Ce testament doit être complété selon les règles de l'héritage islamique (Mirath). Il est recommandé de consulter un spécialiste en droit islamique.</p>
            </div>
        </div>
    </footer>

    <div class="save-indicator" id="saveIndicator">
        <i class="fas fa-check"></i> <span data-translate="auto_saved">Sauvegarde effectuée</span>
    </div>

    <!-- Variable globale pour le PDF -->
    <script>
        let currentPDF = null;
    </script>
<script>
// ==================== SYSTÈME DE TRADUCTION ====================

const translations = {
    fr: {
        // Header
        app_title: "Al Wassiya",
        app_subtitle: "Votre Testament Islamique Simplifié",
        
        // Navigation
        step1_title: "Étape 1 sur 5 : Informations personnelles et volontés générales",
        step2_title: "Étape 2 sur 5 : Famille et proches", 
        step3_title: "Étape 3 sur 5 : Biens matériels et financiers",
        step4_title: "Étape 4 sur 5 : Dettes et devoirs religieux",
        step5_title: "Étape 5 sur 5 : Données numériques et réseaux sociaux",
        
        // Buttons
        continue_family: "Continuer vers la famille",
        continue_goods: "Continuer vers les biens", 
        continue_debts: "Continuer vers les dettes",
        continue_digital: "Continuer vers les données numériques",
        finalize_pdf: "Finaliser et générer le PDF",
        previous_step: "Étape précédente",
        save_draft: "Sauvegarder le brouillon",
        generate_pdf: "Générer le PDF",
        download_pdf: "Télécharger PDF",
        send_email: "Envoyer par Email",
        
        // Form fields - Step 1
        identity_section: "Identité du défunt",
        gender: "Sexe",
        male: "Homme",
        female: "Femme", 
        select_option: "Sélectionner",
        first_name: "Prénom",
        last_name: "Nom de famille",
        birth_date: "Date de naissance",
        birth_place: "Lieu de naissance",
        current_address: "Adresse actuelle",
        nationality: "Nationalité",
        marital_status: "Situation familiale",
        single: "Célibataire",
        married: "Marié(e)",
        divorced: "Divorcé(e)",
        widowed: "Veuf/Veuve",
        spouse_identity: "Identité de l'époux/épouse",
        general_wishes: "Volontés générales",
        funeral_wishes: "Volontés concernant les obsèques",
        family_recommendations: "Recommandations à la famille",
        executor: "Exécuteur testamentaire suggéré",
        executor_contact: "Contact de l'exécuteur",
        other_wishes: "Autres volontés ou instructions",
        
        // Step 2 - Family
        family_section: "Famille et proches",
        parents: "Parents",
        spouses: "Époux/Épouse", 
        siblings: "Frères et Soeurs",
        children: "Enfants",
        close_friends: "Amis proches",
        parent_type: "Type de parent",
        spouse_type: "Type de conjoint",
        sibling_type: "Type de frère/soeur",
        child_type: "Type d'enfant",
        add_parent: "Ajouter un parent",
        add_spouse: "Ajouter un conjoint", 
        add_sibling: "Ajouter un frère/une soeur",
        add_child: "Ajouter un enfant",
        add_friend: "Ajouter un ami",
        additional_info: "Informations complémentaires",
        other_people: "Autres personnes à mentionner",
        special_relationships: "Relations particulières",
        priority_contacts: "Personnes à prévenir en priorité",
        
        // Footer
        contact_us: "Nous Contacter",
        address_contact: "123 Rue de la Paix, 75001 Paris",
        recommendations: "Recommandations",
        islamic_inheritance: "Héritage islamique",
        legal_advice: "Conseil juridique", 
        religious_guidance: "Guidance religieuse",
        estate_planning: "Planification successorale",
        resources: "Ressources",
        user_guide: "Guide d'utilisation",
        faq: "Questions fréquentes",
        islamic_law: "Droit islamique",
        video_tutorials: "Tutoriels vidéo",
        legal: "Légal",
        terms_of_service: "Conditions d'utilisation",
        privacy_policy: "Politique de confidentialité",
        legal_notices: "Mentions légales", 
        cookies_policy: "Politique des cookies",
        all_rights_reserved: "Tous droits réservés",
        footer_note: "Ce testament doit être complété selon les règles de l'héritage islamique (Mirath). Il est recommandé de consulter un spécialiste en droit islamique.",
        important_note: "Note importante :",
        testament_note: "Ce testament doit être complété selon les règles de l'héritage islamique (Mirath). Il est recommandé de consulter un spécialiste en droit islamique pour s'assurer de la conformité avec les lois locales.",
        third_rule: "Les dispositions de ce testament ne peuvent concerner que le tiers (1/3) des biens, les deux tiers restants étant distribués selon les règles coraniques d'héritage.",
        generate_share: "Générer et Partager votre Testament",
        auto_saved: "Sauvegarde effectuée"
    },
    
    ar: {
        // Header
        app_title: "الوصية",
        app_subtitle: "وصيتك الإسلامية المبسطة", 
        
        // Navigation  
        step1_title: "الخطوة 1 من 5: المعلومات الشخصية والإرادات العامة",
        step2_title: "الخطوة 2 من 5: العائلة والأقارب",
        step3_title: "الخطوة 3 من 5: الأموال المادية والمالية", 
        step4_title: "الخطوة 4 من 5: الديون والواجبات الدينية",
        step5_title: "الخطوة 5 من 5: البيانات الرقمية والشبكات الاجتماعية",
        
        // Buttons
        continue_family: "متابعة إلى العائلة",
        continue_goods: "متابعة إلى الأموال",
        continue_debts: "متابعة إلى الديون", 
        continue_digital: "متابعة إلى البيانات الرقمية",
        finalize_pdf: "إنهاء وتحويل إلى PDF",
        previous_step: "الخطوة السابقة",
        save_draft: "حفظ المسودة",
        generate_pdf: "إنتاج ملف PDF",
        download_pdf: "تحميل PDF",
        send_email: "إرسال بالإيميل",
        
        // Form fields - Step 1
        identity_section: "هوية المتوفى",
        gender: "الجنس",
        male: "ذكر",
        female: "أنثى",
        select_option: "اختر",
        first_name: "الاسم الأول", 
        last_name: "اسم العائلة",
        birth_date: "تاريخ الولادة",
        birth_place: "مكان الولادة",
        current_address: "العنوان الحالي",
        nationality: "الجنسية",
        marital_status: "الحالة العائلية",
        single: "أعزب/عزباء",
        married: "متزوج/متزوجة",
        divorced: "مطلق/مطلقة",
        widowed: "أرمل/أرملة",
        spouse_identity: "هوية الزوج/الزوجة",
        general_wishes: "الإرادات العامة",
        funeral_wishes: "إرادات تخص الجنازة",
        family_recommendations: "توصيات للعائلة",
        executor: "منفذ الوصية المقترح",
        executor_contact: "بيانات التواصل مع المنفذ",
        other_wishes: "إرادات أو تعليمات أخرى",
        
        // Step 2 - Family
        family_section: "العائلة والأقارب",
        parents: "الوالدان",
        spouses: "الأزواج",
        siblings: "الإخوة والأخوات",
        children: "الأطفال", 
        close_friends: "الأصدقاء المقربون",
        parent_type: "نوع الوالد",
        spouse_type: "نوع الزوج/الزوجة",
        sibling_type: "نوع الأخ/الأخت",
        child_type: "نوع الطفل",
        add_parent: "إضافة والد",
        add_spouse: "إضافة زوج/زوجة",
        add_sibling: "إضافة أخ/أخت",
        add_child: "إضافة طفل",
        add_friend: "إضافة صديق",
        additional_info: "معلومات إضافية",
        other_people: "أشخاص آخرون للذكر",
        special_relationships: "علاقات خاصة",
        priority_contacts: "أشخاص للتواصل معهم بالأولوية",
        
        // Footer
        contact_us: "تواصل معنا",
        address_contact: "123 شارع السلام، 75001 باريس",
        recommendations: "التوصيات",
        islamic_inheritance: "الميراث الإسلامي",
        legal_advice: "المشورة القانونية",
        religious_guidance: "التوجيه الديني",
        estate_planning: "تخطيط التركة",
        resources: "الموارد",
        user_guide: "دليل الاستخدام", 
        faq: "الأسئلة المتكررة",
        islamic_law: "الشريعة الإسلامية",
        video_tutorials: "دروس فيديو",
        legal: "قانوني",
        terms_of_service: "شروط الاستخدام",
        privacy_policy: "سياسة الخصوصية",
        legal_notices: "الإشعارات القانونية",
        cookies_policy: "سياسة ملفات التعريف",
        all_rights_reserved: "جميع الحقوق محفوظة",
        footer_note: "يجب استكمال هذه الوصية وفقاً لقواعد الميراث الإسلامي. ينصح بالتشاور مع متخصص في الشريعة الإسلامية.",
        important_note: "ملاحظة مهمة:",
        testament_note: "يجب استكمال هذه الوصية وفقاً لقواعد الميراث الإسلامي. ينصح بالتشاور مع متخصص في الشريعة الإسلامية للتأكد من المطابقة مع القوانين المحلية.",
        third_rule: "لا يمكن لأحكام هذه الوصية أن تخص إلا ثلث (1/3) من الأموال، والثلثان الباقيان يوزعان حسب قواعد الميراث القرآنية.",
        generate_share: "إنتاج ومشاركة وصيتك",
        auto_saved: "تم الحفظ التلقائي"
    }
};

// Variables globales
let etapeActuelle = 1;
const totalEtapes = 5;
let currentLanguage = 'fr';

// ==================== FONCTIONS DE TRADUCTION ====================

function switchLanguage(lang) {
    currentLanguage = lang;
    
    // Mettre à jour les boutons de langue
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.lang === lang) {
            btn.classList.add('active');
        }
    });
    
    // Changer la direction du document pour l'arabe
    if (lang === 'ar') {
        document.documentElement.setAttribute('dir', 'rtl');
        document.documentElement.setAttribute('lang', 'ar');
    } else {
        document.documentElement.setAttribute('dir', 'ltr');
        document.documentElement.setAttribute('lang', 'fr');
    }
    
    // Traduire tous les éléments
    translatePage();
    
    // Sauvegarder la préférence
    localStorage.setItem('language', lang);
}

function translatePage() {
    const langData = translations[currentLanguage];
    
    // Traduire les éléments avec data-translate
    document.querySelectorAll('[data-translate]').forEach(element => {
        const key = element.getAttribute('data-translate');
        if (langData[key]) {
            element.textContent = langData[key];
        }
    });
    
    // Mettre à jour l'indicateur d'étape
    updateStepIndicator();
}

// ==================== GESTION DE LA NAVIGATION ====================

function initialiserIndicateursEtape() {
    const stepDotsContainer = document.getElementById('stepDots');
    if (!stepDotsContainer) return;
    
    stepDotsContainer.innerHTML = '';
    
    for (let i = 1; i <= totalEtapes; i++) {
        const dot = document.createElement('div');
        dot.className = 'step-dot';
        dot.dataset.step = i;
        if (i === 1) dot.classList.add('active');
        
        dot.addEventListener('click', () => {
            if (i < etapeActuelle || validerEtape(etapeActuelle)) {
                changerEtape(i);
            }
        });
        
        stepDotsContainer.appendChild(dot);
    }
}

function validerEtape(etape) {
    if (etape === 1) {
        const champsObligatoires = [
            document.getElementById('sexe'),
            document.getElementById('prenom'),
            document.getElementById('nom'), 
            document.getElementById('dateNaissance'),
            document.getElementById('adresse')
        ].filter(champ => champ !== null);
        
        let valide = true;
        
        champsObligatoires.forEach(champ => {
            const errorElement = document.getElementById(`${champ.id}-error`);
            
            if (!champ.value.trim()) {
                valide = false;
                champ.classList.add('invalid');
                if (errorElement) {
                    errorElement.style.display = 'block';
                }
            } else {
                champ.classList.remove('invalid');
                if (errorElement) {
                    errorElement.style.display = 'none';
                }
            }
        });
        
        if (!valide) {
            alert('Veuillez remplir tous les champs obligatoires avant de continuer.');
            const firstSection = document.querySelector('.form-section');
            if (firstSection) {
                firstSection.scrollIntoView({ behavior: 'smooth' });
            }
        }
        
        return valide;
    }
    
    return true;
}

function toggleConjointField() {
    const situationFamiliale = document.getElementById('situationFamiliale');
    const conjointGroup = document.getElementById('conjointGroup');
    const conjointLabel = document.getElementById('conjointLabel');
    
    if (!situationFamiliale || !conjointGroup || !conjointLabel) return;
    
    if (situationFamiliale.value === 'marie' || situationFamiliale.value === 'divorce') {
        conjointGroup.style.display = 'block';
        
        if (situationFamiliale.value === 'marie') {
            conjointLabel.textContent = 'Identité de l\'époux/épouse';
            const conjointInput = document.getElementById('conjoint');
            if (conjointInput) conjointInput.placeholder = 'Nom et prénom du conjoint';
        } else if (situationFamiliale.value === 'divorce') {
            conjointLabel.textContent = 'Identité de l\'ex-époux/ex-épouse';
            const conjointInput = document.getElementById('conjoint');
            if (conjointInput) conjointInput.placeholder = 'Nom et prénom de l\'ex-conjoint';
        }
    } else {
        conjointGroup.style.display = 'none';
        const conjointInput = document.getElementById('conjoint');
        if (conjointInput) conjointInput.value = '';
    }
}

function changerEtape(etape) {
    if (etape > etapeActuelle && !validerEtape(etapeActuelle)) {
        return;
    }
    
    // Masquer toutes les étapes
    document.querySelectorAll('.form-step').forEach(step => {
        step.style.display = 'none';
        step.classList.remove('active');
    });
    
    // Afficher l'étape demandée
    const stepElement = document.getElementById(`step${etape}`);
    if (stepElement) {
        stepElement.style.display = 'block';
        stepElement.classList.add('active');
    }
    
    // Mettre à jour l'indicateur de progression
    const progressFill = document.getElementById('progressFill');
    if (progressFill) {
        progressFill.style.width = `${(etape / totalEtapes) * 100}%`;
    }
    
    // Mettre à jour les indicateurs d'étape
    document.querySelectorAll('.step-dot').forEach((dot, index) => {
        dot.classList.remove('active', 'completed');
        if (index + 1 === etape) {
            dot.classList.add('active');
        } else if (index + 1 < etape) {
            dot.classList.add('completed');
        }
    });
    
    etapeActuelle = etape;
    updateStepIndicator();
    updateButtons();
    
    // Scroll vers le haut de la page
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function updateStepIndicator() {
    const stepIndicator = document.getElementById('stepIndicator');
    if (!stepIndicator) return;
    
    const langData = translations[currentLanguage];
    
    const stepKeys = [
        'step1_title',
        'step2_title', 
        'step3_title',
        'step4_title',
        'step5_title'
    ];
    
    const stepTitle = langData[stepKeys[etapeActuelle - 1]] || `Étape ${etapeActuelle} sur ${totalEtapes}`;
    stepIndicator.textContent = stepTitle;
}

function updateButtons() {
    const prevBtn = document.getElementById('prevStepBtn');
    const nextBtn = document.getElementById('nextStepBtn');
    
    if (!nextBtn) return;
    
    const langData = translations[currentLanguage];
    
    if (prevBtn) {
        prevBtn.style.display = etapeActuelle > 1 ? 'inline-flex' : 'none';
    }
    
    const nextBtnTexts = [
        'continue_family',
        'continue_goods',
        'continue_debts', 
        'continue_digital',
        'finalize_pdf'
    ];
    
    const nextBtnText = langData[nextBtnTexts[etapeActuelle - 1]] || 'Suivant';
    const nextBtnSpan = nextBtn.querySelector('span');
    if (nextBtnSpan) {
        nextBtnSpan.textContent = nextBtnText;
    }
}

function nextStep() {
    if (etapeActuelle < totalEtapes) {
        changerEtape(etapeActuelle + 1);
    } else {
        genererPDF();
    }
}

function prevStep() {
    if (etapeActuelle > 1) {
        changerEtape(etapeActuelle - 1);
    }
}

// ==================== GESTION DES CATÉGORIES ====================

function toggleCategory(categoryId) {
    const category = document.getElementById(categoryId);
    if (!category) return;
    
    const header = category.parentElement.querySelector('.category-header');
    const icon = header?.querySelector('.fas.fa-chevron-down');
    
    if (category.classList.contains('active')) {
        category.classList.remove('active');
        if (icon) icon.style.transform = 'rotate(0deg)';
    } else {
        category.classList.add('active');
        if (icon) icon.style.transform = 'rotate(180deg)';
    }
}

// ==================== AJOUT D'ÉLÉMENTS DYNAMIQUES - VOTRE CODE ORIGINAL ====================

function addPerson(category) {
    const container = document.getElementById(`${category}-container`);
    if (!container) return;
    
    const index = container.children.length;
    
    const personEntry = document.createElement('div');
    personEntry.className = 'person-entry';
    personEntry.innerHTML = `
        <div class="form-group">
            <label>Nom <span class="required">*</span></label>
            <input type="text" name="${category}[${index}][nom]" required placeholder="Nom de famille">
        </div>
        <div class="form-group">
            <label>Prénom <span class="required">*</span></label>
            <input type="text" name="${category}[${index}][prenom]" required placeholder="Prénom">
        </div>
        <div class="form-group">
            <label>Téléphone</label>
            <input type="tel" name="${category}[${index}][telephone]" placeholder="Numéro de téléphone">
        </div>
        <div class="form-group">
            <label>Adresse</label>
            <textarea name="${category}[${index}][adresse]" placeholder="Adresse complète"></textarea>
        </div>
        <button type="button" class="remove-person-btn" onclick="this.parentElement.remove()">
            <i class="fas fa-trash"></i> Supprimer
        </button>
    `;
    
    container.appendChild(personEntry);
}

// Fonction pour ajouter un bien/actif - VOTRE CODE ORIGINAL CONSERVÉ
function addAsset(category) {
    const container = document.getElementById(`${category}-container`);
    if (!container) return;
    
    const index = container.children.length;
    
    let assetEntry = document.createElement('div');
    assetEntry.className = 'asset-entry';
    
    // HTML différent selon la catégorie - VOTRE LOGIQUE ORIGINALE
    switch(category) {
        case 'immobilier':
            assetEntry.innerHTML = `
                <div class="form-group">
                    <label>Type de bien <span class="required">*</span></label>
                    <select name="${category}[${index}][type]" required>
                        <option value="">Sélectionner</option>
                        <option value="maison">Maison</option>
                        <option value="appartement">Appartement</option>
                        <option value="terrain">Terrain</option>
                        <option value="local_commercial">Local commercial</option>
                        <option value="autre">Autre</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Adresse complète <span class="required">*</span></label>
                    <textarea name="${category}[${index}][adresse]" required placeholder="Adresse du bien immobilier"></textarea>
                </div>
                <div class="form-group">
                    <label>Valeur estimée (€)</label>
                    <input type="number" name="${category}[${index}][valeur]" placeholder="Valeur en euros">
                </div>
                <div class="form-group">
                    <label>Statut de paiement</label>
                    <select name="${category}[${index}][statut]">
                        <option value="">Sélectionner</option>
                        <option value="paye">Entièrement payé</option>
                        <option value="credit">En cours de crédit</option>
                        <option value="location">En location</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Informations complémentaires</label>
                    <textarea name="${category}[${index}][info]" placeholder="Informations supplémentaires sur ce bien"></textarea>
                </div>
                <button type="button" class="remove-person-btn" onclick="this.parentElement.remove()">
                    <i class="fas fa-trash"></i> Supprimer
                </button>
            `;
            break;
            
        case 'materiel':
            assetEntry.innerHTML = `
                <div class="form-group">
                    <label>Type de bien matériel</label>
                    <select name="${category}[${index}][type]">
                        <option value="">Sélectionner</option>
                        <option value="voiture">Voiture</option>
                        <option value="moto">Moto</option>
                        <option value="bijoux">Bijoux</option>
                        <option value="electronique">Électronique</option>
                        <option value="autre">Autre</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <input type="text" name="${category}[${index}][description]" placeholder="Description du bien">
                </div>
                <div class="form-group">
                    <label>Valeur estimée (€)</label>
                    <input type="number" name="${category}[${index}][valeur]" placeholder="Valeur en euros">
                </div>
                <button type="button" class="remove-person-btn" onclick="this.parentElement.remove()">
                    <i class="fas fa-trash"></i> Supprimer
                </button>
            `;
            break;
            
        case 'comptes':
            assetEntry.innerHTML = `
                <div class="form-group">
                    <label>Nom de la banque</label>
                    <input type="text" name="${category}[${index}][banque]" placeholder="Nom de la banque">
                </div>
                <div class="form-group">
                    <label>Type de compte</label>
                    <select name="${category}[${index}][type]">
                        <option value="">Sélectionner</option>
                        <option value="courant">Compte courant</option>
                        <option value="epargne">Livret d'épargne</option>
                        <option value="pel">PEL</option>
                        <option value="assurance_vie">Assurance vie</option>
                        <option value="autre">Autre</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Numéro de compte</label>
                    <input type="text" name="${category}[${index}][numero]" placeholder="Numéro de compte (partiel pour sécurité)">
                </div>
                <div class="form-group">
                    <label>Solde approximatif (€)</label>
                    <input type="number" name="${category}[${index}][solde]" placeholder="Solde approximatif">
                </div>
                <button type="button" class="remove-person-btn" onclick="this.parentElement.remove()">
                    <i class="fas fa-trash"></i> Supprimer
                </button>
            `;
            break;
            
        default:
            assetEntry.innerHTML = `
                <div class="form-group">
                    <label>Description</label>
                    <input type="text" name="${category}[${index}][description]" placeholder="Description">
                </div>
                <button type="button" class="remove-person-btn" onclick="this.parentElement.remove()">
                    <i class="fas fa-trash"></i> Supprimer
                </button>
            `;
    }
    
    container.appendChild(assetEntry);
}

function addDebt(category) {
    const container = document.getElementById(`${category}-container`);
    if (!container) return;
    
    const index = container.children.length;
    
    let debtEntry = document.createElement('div');
    debtEntry.className = 'asset-entry';
    
    if (category === 'creances') {
        debtEntry.innerHTML = `
            <div class="form-group">
                <label>Type de créance <span class="required">*</span></label>
                <select name="${category}[${index}][type]" required>
                    <option value="">Sélectionner</option>
                    <option value="pret">Prêt d'argent</option>
                    <option value="investissement">Investissement</option>
                    <option value="placement">Placement financier</option>
                    <option value="projet">Projet en association</option>
                    <option value="autre">Autre type de créance</option>
                </select>
            </div>
            <div class="form-group">
                <label>Montant (€) <span class="required">*</span></label>
                <input type="number" name="${category}[${index}][montant]" required placeholder="Montant à percevoir">
            </div>
            <div class="form-group">
                <label>Nom du débiteur <span class="required">*</span></label>
                <input type="text" name="${category}[${index}][nom]" required placeholder="Nom et prénom">
            </div>
            <button type="button" class="remove-person-btn" onclick="this.parentElement.remove()">
                <i class="fas fa-trash"></i> Supprimer
            </button>
        `;
    } else if (category === 'dettes') {
        debtEntry.innerHTML = `
            <div class="form-group">
                <label>Type de dette <span class="required">*</span></label>
                <select name="${category}[${index}][type]" required>
                    <option value="">Sélectionner</option>
                    <option value="personne">Dette envers une personne</option>
                    <option value="entreprise">Dette envers une entreprise</option>
                    <option value="facture">Facture impayée</option>
                    <option value="credit">Crédit en cours</option>
                    <option value="autre">Autre type de dette</option>
                </select>
            </div>
            <div class="form-group">
                <label>Montant (€) <span class="required">*</span></label>
                <input type="number" name="${category}[${index}][montant]" required placeholder="Montant à rembourser">
            </div>
            <div class="form-group">
                <label>Nom du créancier <span class="required">*</span></label>
                <input type="text" name="${category}[${index}][nom]" required placeholder="Nom et prénom ou entreprise">
            </div>
            <button type="button" class="remove-person-btn" onclick="this.parentElement.remove()">
                <i class="fas fa-trash"></i> Supprimer
            </button>
        `;
    }
    
    container.appendChild(debtEntry);
}

// Fonctions additionnelles - VOTRE CODE ORIGINAL
function addSadaqa() {
    const container = document.getElementById('sadaqa-container');
    if (!container) return;
    
    const index = container.children.length;
    
    const sadaqaEntry = document.createElement('div');
    sadaqaEntry.className = 'asset-entry';
    sadaqaEntry.innerHTML = `
        <div class="form-group">
            <label>Type de sadaqa <span class="required">*</span></label>
            <select name="sadaqa[${index}][type]" required>
                <option value="">Sélectionner</option>
                <option value="argent">Don d'argent</option>
                <option value="nourriture">Don de nourriture</option>
                <option value="projet">Soutien à un projet</option>
                <option value="association">Don à une association</option>
                <option value="omra">Omra au nom du défunt</option>
                <option value="hadj">Hadj au nom du défunt</option>
                <option value="autre">Autre type de sadaqa</option>
            </select>
        </div>
        <div class="form-group">
            <label>Montant ou description <span class="required">*</span></label>
            <input type="text" name="sadaqa[${index}][description]" required placeholder="Montant en € ou description">
        </div>
        <button type="button" class="remove-person-btn" onclick="this.parentElement.remove()">
            <i class="fas fa-trash"></i> Supprimer
        </button>
    `;
    
    container.appendChild(sadaqaEntry);
}

function addReseauSocial() {
    const container = document.getElementById('reseaux-sociaux-container');
    if (!container) return;
    
    const index = container.children.length;
    
    const entry = document.createElement('div');
    entry.className = 'asset-entry';
    entry.innerHTML = `
        <div class="form-group">
            <label>Réseau social <span class="required">*</span></label>
            <select name="reseaux_sociaux[${index}][type]" required>
                <option value="">Sélectionner</option>
                <option value="facebook">Facebook</option>
                <option value="instagram">Instagram</option>
                <option value="twitter">Twitter / X</option>
                <option value="linkedin">LinkedIn</option>
                <option value="whatsapp">WhatsApp</option>
                <option value="autre">Autre réseau social</option>
            </select>
        </div>
        <div class="form-group">
            <label>Pseudo / Identifiant</label>
            <input type="text" name="reseaux_sociaux[${index}][pseudo]" placeholder="Votre pseudo sur ce réseau">
        </div>
        <button type="button" class="remove-person-btn" onclick="this.parentElement.remove()">
            <i class="fas fa-trash"></i> Supprimer
        </button>
    `;
    
    container.appendChild(entry);
}

function addEmail() {
    const container = document.getElementById('emails-container');
    if (!container) return;
    
    const index = container.children.length;
    
    const entry = document.createElement('div');
    entry.className = 'asset-entry';
    entry.innerHTML = `
        <div class="form-group">
            <label>Adresse email <span class="required">*</span></label>
            <input type="email" name="emails[${index}][adresse]" required placeholder="Votre adresse email">
        </div>
        <button type="button" class="remove-person-btn" onclick="this.parentElement.remove()">
            <i class="fas fa-trash"></i> Supprimer
        </button>
    `;
    
    container.appendChild(entry);
}

function addCompteOnline() {
    const container = document.getElementById('comptes-online-container');
    if (!container) return;
    
    const index = container.children.length;
    
    const entry = document.createElement('div');
    entry.className = 'asset-entry';
    entry.innerHTML = `
        <div class="form-group">
            <label>Nom du site / service <span class="required">*</span></label>
            <input type="text" name="comptes_online[${index}][site]" required placeholder="Ex: Amazon, Netflix, abonnement téléphone...">
        </div>
        <button type="button" class="remove-person-btn" onclick="this.parentElement.remove()">
            <i class="fas fa-trash"></i> Supprimer
        </button>
    `;
    
    container.appendChild(entry);
}

function addCloud() {
    const container = document.getElementById('cloud-container');
    if (!container) return;
    
    const index = container.children.length;
    
    const entry = document.createElement('div');
    entry.className = 'asset-entry';
    entry.innerHTML = `
        <div class="form-group">
            <label>Service cloud <span class="required">*</span></label>
            <select name="cloud[${index}][service]" required>
                <option value="">Sélectionner</option>
                <option value="google_drive">Google Drive</option>
                <option value="dropbox">Dropbox</option>
                <option value="icloud">iCloud</option>
                <option value="onedrive">OneDrive</option>
                <option value="autre">Autre service</option>
            </select>
        </div>
        <button type="button" class="remove-person-btn" onclick="this.parentElement.remove()">
            <i class="fas fa-trash"></i> Supprimer
        </button>
    `;
    
    container.appendChild(entry);
}

function addAppareil() {
    const container = document.getElementById('appareils-container');
    if (!container) return;
    
    const index = container.children.length;
    
    const entry = document.createElement('div');
    entry.className = 'asset-entry';
    entry.innerHTML = `
        <div class="form-group">
            <label>Type d'appareil <span class="required">*</span></label>
            <select name="appareils[${index}][type]" required>
                <option value="">Sélectionner</option>
                <option value="telephone">Téléphone portable</option>
                <option value="ordinateur_portable">Ordinateur portable</option>
                <option value="tablette">Tablette</option>
                <option value="autre">Autre appareil</option>
            </select>
        </div>
        <button type="button" class="remove-person-btn" onclick="this.parentElement.remove()">
            <i class="fas fa-trash"></i> Supprimer
        </button>
    `;
    
    container.appendChild(entry);
}

// ==================== CALCUL DE LA ZAKAT - VOTRE CODE ORIGINAL INCHANGÉ ====================

function calculerZakat() {
    const nissabInput = document.getElementById('nissab');
    const epargneInput = document.getElementById('epargne');
    const autresActifsInput = document.getElementById('autres_actifs');
    const dettesInput = document.getElementById('dettes_zakat');
    const resultatElement = document.getElementById('resultatZakat');
    
    if (!nissabInput || !epargneInput || !autresActifsInput || !dettesInput || !resultatElement) {
        alert('Erreur: éléments de calcul non trouvés');
        return;
    }
    
    const nissab = parseFloat(nissabInput.value) || 0;
    const epargne = parseFloat(epargneInput.value) || 0;
    const autresActifs = parseFloat(autresActifsInput.value) || 0;
    const dettes = parseFloat(dettesInput.value) || 0;
    
    const patrimoine = epargne + autresActifs - dettes;
    
    if (nissab <= 0) {
        resultatElement.innerHTML = '<span style="color: var(--error);">Veuillez entrer la valeur du Nissab</span>';
        resultatElement.style.display = 'block';
        return;
    }
    
    if (patrimoine <= 0) {
        resultatElement.innerHTML = `Votre patrimoine net est de ${patrimoine.toFixed(2)} €. Vous n'êtes pas redevable de la Zakat.`;
        resultatElement.style.display = 'block';
        return;
    }
    
    if (patrimoine < nissab) {
        resultatElement.innerHTML = `Votre patrimoine net est de ${patrimoine.toFixed(2)} €, ce qui est inférieur au Nissab (${nissab.toFixed(2)} €). Vous n'êtes pas redevable de la Zakat.`;
        resultatElement.style.display = 'block';
        return;
    }
    
    // VOTRE CALCUL ORIGINAL: On ne calcule la Zakat que sur la partie qui dépasse le Nissab
    const montantImposable = patrimoine - nissab;
    const zakat = montantImposable * 0.025; // 2.5%
    
    resultatElement.innerHTML = `
        <strong>Résultat du calcul :</strong><br>
        Patrimoine net: ${patrimoine.toFixed(2)} €<br>
        Nissab: ${nissab.toFixed(2)} €<br>
        Montant imposable: ${montantImposable.toFixed(2)} €<br>
        <span style="color: var(--primary-dark); font-weight: bold;">Zakat à verser: ${zakat.toFixed(2)} € (2.5% du montant imposable)</span>
    `;
    resultatElement.style.display = 'block';
}

// ==================== SAUVEGARDE ET RESTAURATION ====================

function sauvegarderBrouillon() {
    const form = document.getElementById('testamentForm');
    if (!form) return;
    
    const formData = new FormData(form);
    const data = { language: currentLanguage };
    
    for (let [key, value] of formData.entries()) {
        data[key] = value;
    }
    
    localStorage.setItem('testamentBrouillon', JSON.stringify(data));
    
    const saveIndicator = document.getElementById('saveIndicator');
    if (saveIndicator) {
        saveIndicator.classList.add('visible');
        
        setTimeout(() => {
            saveIndicator.classList.remove('visible');
        }, 3000);
    }
}

// ==================== INITIALISATION ====================

window.addEventListener('load', function() {
    // Test jsPDF immédiatement
    console.log('Test jsPDF au chargement:', typeof window.jspdf !== 'undefined' ? 'OK' : 'ERREUR');
    
    // Charger la langue sauvegardée
    const savedLanguage = localStorage.getItem('language') || 'fr';
    switchLanguage(savedLanguage);
    
    // Initialiser les indicateurs d'étape
    initialiserIndicateursEtape();
    
    // Charger les données sauvegardées
    const savedData = localStorage.getItem('testamentBrouillon');
    if (savedData) {
        try {
            const data = JSON.parse(savedData);
            
            // Remplir les champs de base
            for (const key in data) {
                if (key !== 'language') {
                    const element = document.getElementById(key);
                    if (element) {
                        element.value = data[key];
                    }
                }
            }
            
            // Gérer les champs conditionnels
            const situationElement = document.getElementById('situationFamiliale');
            if (situationElement && data.situationFamiliale) {
                situationElement.value = data.situationFamiliale;
                toggleConjointField();
            }
        } catch (error) {
            console.error('Erreur lors du chargement des données sauvegardées:', error);
        }
    }
    
    // Event listeners pour les champs conditionnels
    const situationElement = document.getElementById('situationFamiliale');
    const sexeElement = document.getElementById('sexe');
    
    if (situationElement) {
        situationElement.addEventListener('change', toggleConjointField);
    }
    if (sexeElement) {
        sexeElement.addEventListener('change', toggleConjointField);
    }
    
    // Validation en temps réel
    const champsObligatoires = document.querySelectorAll('input[required], select[required], textarea[required]');
    champsObligatoires.forEach(champ => {
        champ.addEventListener('blur', function() {
            const errorElement = document.getElementById(`${this.id}-error`);
            
            if (!this.value.trim()) {
                this.classList.add('invalid');
                if (errorElement) {
                    errorElement.style.display = 'block';
                }
            } else {
                this.classList.remove('invalid');
                if (errorElement) {
                    errorElement.style.display = 'none';
                }
            }
        });
    });
});

// Sauvegarde automatique toutes les 30 secondes
setInterval(() => {
    const form = document.getElementById('testamentForm');
    if (!form) return;
    
    const formData = new FormData(form);
    let hasData = false;
    
    for (let [key, value] of formData.entries()) {
        if (value.trim() !== '') {
            hasData = true;
            break;
        }
    }
    
    if (hasData) {
        sauvegarderBrouillon();
    }
}, 30000);
</script>
// Test jsPDF au chargement de la page
console.log('Test jsPDF:', typeof window.jspdf !== 'undefined' ? 'CHARGÉ' : 'NON CHARGÉ');

// ==================== GÉNÉRATION PDF AVEC JSPDF QUI FONCTIONNE À 100% ====================

function genererPDF() {
    // Vérification jsPDF
    if (typeof window.jspdf === 'undefined') {
        alert('Erreur: jsPDF non chargé. Veuillez recharger la page.');
        console.error('jsPDF non disponible');
        return;
    }

    // Récupération des champs essentiels
    const prenom = document.getElementById('prenom')?.value || '';
    const nom = document.getElementById('nom')?.value || '';
    const sexe = document.getElementById('sexe')?.value || '';
    const dateNaissance = document.getElementById('dateNaissance')?.value || '';
    const adresse = document.getElementById('adresse')?.value || '';
    
    // Validation minimum
    if (!prenom || !nom || !sexe || !dateNaissance || !adresse) {
        alert('Veuillez remplir au minimum : sexe, prénom, nom, date de naissance et adresse');
        return;
    }

    try {
        // Création du PDF avec jsPDF
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('p', 'mm', 'a4');
        
        let yPosition = 20;
        const pageWidth = doc.internal.pageSize.width;
        const pageHeight = doc.internal.pageSize.height;
        const margin = 20;
        
        // Couleurs du thème Al Wassiya
        const goldColor = [201, 177, 120];  // #C9B178
        const darkBlue = [45, 76, 104];     // #2D4C68
        const darkColor = [30, 30, 36];     // #1E1E24
        
        // Fonction pour ajouter une nouvelle page
        const addNewPage = () => {
            doc.addPage();
            yPosition = 20;
            // Header sur chaque nouvelle page
            doc.setFontSize(12);
            doc.setTextColor(goldColor[0], goldColor[1], goldColor[2]);
            doc.text('Al Wassiya - الوصية', pageWidth / 2, yPosition, { align: 'center' });
            yPosition += 15;
        };
        
        // Fonction pour vérifier si on a besoin d'une nouvelle page
        const checkPageBreak = (requiredHeight = 20) => {
            if (yPosition + requiredHeight > pageHeight - 30) {
                addNewPage();
            }
        };
        
        // EN-TÊTE PRINCIPAL
        doc.setFontSize(22);
        doc.setFont(undefined, 'bold');
        doc.setTextColor(goldColor[0], goldColor[1], goldColor[2]);
        doc.text('Al Wassiya - الوصية', pageWidth / 2, yPosition, { align: 'center' });
        yPosition += 12;
        
        // Sous-titre
        doc.setFontSize(18);
        doc.text('TESTAMENT ISLAMIQUE', pageWidth / 2, yPosition, { align: 'center' });
        yPosition += 15;
        
        // Bismillah en arabe
        doc.setFontSize(16);
        doc.setFont(undefined, 'bold');
        doc.text('بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ', pageWidth / 2, yPosition, { align: 'center' });
        yPosition += 20;
        
        // Date de rédaction
        const today = new Date().toLocaleDateString('fr-FR', {
            weekday: 'long',
            year: 'numeric',
            month: 'long', 
            day: 'numeric'
        });
        doc.setFontSize(11);
        doc.setFont(undefined, 'normal');
        doc.setTextColor(darkBlue[0], darkBlue[1], darkBlue[2]);
        doc.text(`Date de rédaction : ${today}`, margin, yPosition);
        yPosition += 20;
        
        // Décorateur
        doc.setFontSize(14);
        doc.setTextColor(goldColor[0], goldColor[1], goldColor[2]);
        doc.text('◆ ◆ ◆', pageWidth / 2, yPosition, { align: 'center' });
        yPosition += 20;
        
        // SECTION 1: IDENTITÉ DU TESTATEUR
        checkPageBreak(40);
        doc.setFontSize(16);
        doc.setFont(undefined, 'bold');
        doc.setTextColor(darkBlue[0], darkBlue[1], darkBlue[2]);
        doc.text('1. IDENTITÉ DU TESTATEUR', margin, yPosition);
        yPosition += 15;
        
        doc.setFontSize(12);
        doc.setFont(undefined, 'normal');
        doc.setTextColor(darkColor[0], darkColor[1], darkColor[2]);
        
        // Fonction pour ajouter un champ
        const addField = (label, value) => {
            if (!value) return;
            checkPageBreak(8);
            
            doc.setFont(undefined, 'bold');
            doc.setTextColor(darkBlue[0], darkBlue[1], darkBlue[2]);
            doc.text(label + ':', margin, yPosition);
            
            doc.setFont(undefined, 'normal');
            doc.setTextColor(darkColor[0], darkColor[1], darkColor[2]);
            
            // Gérer les textes longs
            if (value.length > 50) {
                const lines = doc.splitTextToSize(value, pageWidth - margin - 60);
                doc.text(lines[0], margin + 50, yPosition);
                for (let i = 1; i < lines.length; i++) {
                    yPosition += 7;
                    checkPageBreak(8);
                    doc.text(lines[i], margin + 50, yPosition);
                }
            } else {
                doc.text(value, margin + 50, yPosition);
            }
            yPosition += 8;
        };
        
        // Ajouter les champs identité
        const sexeText = sexe === 'homme' ? 'Homme' : 'Femme';
        addField('Sexe', sexeText);
        addField('Prénom', prenom);
        addField('Nom de famille', nom);
        
        // Formatage de la date de naissance
        if (dateNaissance) {
            const date = new Date(dateNaissance);
            const dateFormatee = date.toLocaleDateString('fr-FR');
            addField('Date de naissance', dateFormatee);
        }
        
        // Autres champs optionnels
        const lieuNaissance = document.getElementById('lieuNaissance')?.value;
        if (lieuNaissance) addField('Lieu de naissance', lieuNaissance);
        
        addField('Adresse actuelle', adresse);
        
        const nationalite = document.getElementById('nationalite')?.value;
        if (nationalite) addField('Nationalité', nationalite);
        
        const situationFamiliale = document.getElementById('situationFamiliale')?.value;
        if (situationFamiliale) {
            const situationTexte = {
                'celibataire': 'Célibataire',
                'marie': 'Marié(e)',
                'divorce': 'Divorcé(e)',
                'veuf': 'Veuf/Veuve'
            }[situationFamiliale] || situationFamiliale;
            addField('Situation familiale', situationTexte);
        }
        
        const conjoint = document.getElementById('conjoint')?.value;
        if (conjoint) addField('Conjoint', conjoint);
        
        yPosition += 10;
        
        // SECTION 2: VOLONTÉS GÉNÉRALES
        checkPageBreak(30);
        doc.setFontSize(16);
        doc.setFont(undefined, 'bold');
        doc.setTextColor(darkBlue[0], darkBlue[1], darkBlue[2]);
        doc.text('2. VOLONTÉS GÉNÉRALES', margin, yPosition);
        yPosition += 15;
        
        doc.setFontSize(12);
        doc.setFont(undefined, 'normal');
        doc.setTextColor(darkColor[0], darkColor[1], darkColor[2]);
        
        // Fonction pour ajouter du texte sur plusieurs lignes
        const addTextSection = (titre, contenu) => {
            if (!contenu) return;
            
            checkPageBreak(15);
            doc.setFont(undefined, 'bold');
            doc.setTextColor(darkBlue[0], darkBlue[1], darkBlue[2]);
            doc.text(titre + ':', margin, yPosition);
            yPosition += 8;
            
            doc.setFont(undefined, 'normal');
            doc.setTextColor(darkColor[0], darkColor[1], darkColor[2]);
            
            const lines = doc.splitTextToSize(contenu, pageWidth - (margin * 2));
            lines.forEach(line => {
                checkPageBreak(8);
                doc.text(line, margin, yPosition);
                yPosition += 7;
            });
            yPosition += 5;
        };
        
        // Ajouter les volontés
        const volontesObseques = document.getElementById('volontesObseques')?.value;
        addTextSection('Volontés concernant les obsèques', volontesObseques);
        
        const recommandations = document.getElementById('recommandationsFamille')?.value;
        addTextSection('Recommandations à la famille', recommandations);
        
        const executeur = document.getElementById('executeurTestament')?.value;
        if (executeur) addField('Exécuteur testamentaire', executeur);
        
        const contactExecuteur = document.getElementById('contactExecuteur')?.value;
        if (contactExecuteur) addField('Contact exécuteur', contactExecuteur);
        
        const autresVolontes = document.getElementById('autresVolontes')?.value;
        addTextSection('Autres volontés', autresVolontes);
        
        yPosition += 10;
        
        // SECTION 3: FAMILLE (si des données existent)
        let hasFamilyData = false;
        const categoriesPersonnes = ['parents', 'conjoints', 'freres-soeurs', 'enfants', 'amis'];
        
        categoriesPersonnes.forEach((category, categoryIndex) => {
            const container = document.getElementById(`${category}-container`);
            if (container && container.children.length > 0) {
                if (!hasFamilyData) {
                    checkPageBreak(20);
                    doc.setFontSize(16);
                    doc.setFont(undefined, 'bold');
                    doc.setTextColor(darkBlue[0], darkBlue[1], darkBlue[2]);
                    doc.text('3. FAMILLE ET PROCHES', margin, yPosition);
                    yPosition += 15;
                    hasFamilyData = true;
                }
                
                const categoryTitles = {
                    'parents': 'Parents',
                    'conjoints': 'Conjoints',
                    'freres-soeurs': 'Frères et Soeurs',
                    'enfants': 'Enfants',
                    'amis': 'Amis proches'
                };
                
                checkPageBreak(15);
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.setTextColor(darkBlue[0], darkBlue[1], darkBlue[2]);
                doc.text(`3.${categoryIndex + 1}. ${categoryTitles[category]}`, margin, yPosition);
                yPosition += 10;
                
                Array.from(container.children).forEach((entry, index) => {
                    const nom = entry.querySelector('[name$="[nom]"]')?.value || '';
                    const prenom = entry.querySelector('[name$="[prenom]"]')?.value || '';
                    const telephone = entry.querySelector('[name$="[telephone]"]')?.value || '';
                    const adresse = entry.querySelector('[name$="[adresse]"]')?.value || '';
                    
                    if (nom || prenom) {
                        checkPageBreak(15);
                        doc.setFontSize(11);
                        doc.setFont(undefined, 'bold');
                        doc.setTextColor(goldColor[0], goldColor[1], goldColor[2]);
                        doc.text(`Personne ${index + 1}:`, margin, yPosition);
                        yPosition += 7;
                        
                        doc.setFontSize(10);
                        doc.setFont(undefined, 'normal');
                        doc.setTextColor(darkColor[0], darkColor[1], darkColor[2]);
                        
                        if (prenom && nom) {
                            doc.text(`• ${prenom} ${nom}`, margin + 5, yPosition);
                            yPosition += 6;
                        }
                        if (telephone) {
                            doc.text(`• Tél: ${telephone}`, margin + 5, yPosition);
                            yPosition += 6;
                        }
                        if (adresse) {
                            const adresseLines = doc.splitTextToSize(`• ${adresse}`, pageWidth - margin - 10);
                            adresseLines.forEach(line => {
                                checkPageBreak(6);
                                doc.text(line, margin + 5, yPosition);
                                yPosition += 6;
                            });
                        }
                        yPosition += 3;
                    }
                });
                yPosition += 5;
            }
        });
        
        // SECTION 4: INFORMATIONS COMPLÉMENTAIRES
        const autresProches = document.getElementById('autresProches')?.value;
        const relationsParticulieres = document.getElementById('relationsParticulieres')?.value;
        const personnesPrevenir = document.getElementById('personnesPrevenir')?.value;
        
        if (autresProches || relationsParticulieres || personnesPrevenir) {
            checkPageBreak(20);
            const sectionNumber = hasFamilyData ? '4' : '3';
            doc.setFontSize(16);
            doc.setFont(undefined, 'bold');
            doc.setTextColor(darkBlue[0], darkBlue[1], darkBlue[2]);
            doc.text(`${sectionNumber}. INFORMATIONS COMPLÉMENTAIRES`, margin, yPosition);
            yPosition += 15;
            
            addTextSection('Autres personnes à mentionner', autresProches);
            addTextSection('Relations particulières', relationsParticulieres);
            addTextSection('Personnes à prévenir en priorité', personnesPrevenir);
        }
        
        yPosition += 20;
        
        // SECTION FINALE: DISPOSITIONS IMPORTANTES
        checkPageBreak(50);
        doc.setFontSize(16);
        doc.setFont(undefined, 'bold');
        doc.setTextColor(darkBlue[0], darkBlue[1], darkBlue[2]);
        doc.text('DISPOSITIONS IMPORTANTES', margin, yPosition);
        yPosition += 15;
        
        doc.setFontSize(11);
        doc.setFont(undefined, 'normal');
        doc.setTextColor(darkColor[0], darkColor[1], darkColor[2]);
        
        const dispositions = [
            '• Ce testament respecte les règles de l\'héritage islamique (Mirath)',
            '• Les dispositions ne concernent que le tiers (1/3) des biens maximum',
            '• Les deux tiers restants sont distribués selon les règles coraniques',
            '• Il est recommandé de faire valider ce testament par un spécialiste'
        ];
        
        dispositions.forEach(disposition => {
            checkPageBreak(8);
            doc.text(disposition, margin, yPosition);
            yPosition += 8;
        });
        
        yPosition += 15;
        
        // VERSET CORANIQUE
        checkPageBreak(20);
        doc.setFontSize(12);
        doc.setFont(undefined, 'italic');
        doc.setTextColor(darkBlue[0], darkBlue[1], darkBlue[2]);
        
        const verset = '"Et c\'est Allah qui donne la vie et qui donne la mort. Et Allah observe parfaitement ce que vous faites." - Coran 3:156';
        const versetLines = doc.splitTextToSize(verset, pageWidth - (margin * 2));
        
        versetLines.forEach(line => {
            checkPageBreak(8);
            doc.text(line, pageWidth / 2, yPosition, { align: 'center' });
            yPosition += 8;
        });
        
        yPosition += 20;
        
        // SECTION SIGNATURE
        checkPageBreak(30);
        doc.setFontSize(16);
        doc.setFont(undefined, 'bold');
        doc.setTextColor(darkBlue[0], darkBlue[1], darkBlue[2]);
        doc.text('SIGNATURE', margin, yPosition);
        yPosition += 15;
        
        doc.setFontSize(11);
        doc.setFont(undefined, 'normal');
        doc.setTextColor(darkColor[0], darkColor[1], darkColor[2]);
        
        doc.text(`Date : ${today}`, margin, yPosition);
        yPosition += 15;
        doc.text('Signature du testateur : _________________________', margin, yPosition);
        yPosition += 15;
        doc.text('Témoins (recommandé) :', margin, yPosition);
        yPosition += 8;
        doc.text('1. Nom : _________________ Signature : _________________', margin, yPosition);
        yPosition += 8;
        doc.text('2. Nom : _________________ Signature : _________________', margin, yPosition);
        
        // FOOTER SUR TOUTES LES PAGES
        const totalPages = doc.internal.getNumberOfPages();
        for (let i = 1; i <= totalPages; i++) {
            doc.setPage(i);
            doc.setFontSize(8);
            doc.setTextColor(128, 128, 128);
            doc.text('Al Wassiya - الوصية - Testament Islamique', margin, pageHeight - 15);
            doc.text(`Page ${i}/${totalPages}`, pageWidth - margin - 20, pageHeight - 15);
        }
        
        // SAUVEGARDER LE PDF
        currentPDF = doc;
        
        // GÉNÉRER LE NOM DE FICHIER
        const dateStr = new Date().toISOString().split('T')[0];
        const fileName = `Testament_${prenom}_${nom}_${dateStr}.pdf`.replace(/[^a-zA-Z0-9._-]/g, '_');
        
        // TÉLÉCHARGER AUTOMATIQUEMENT
        doc.save(fileName);
        
        // MESSAGE DE SUCCÈS
        alert('Testament PDF généré avec succès !');
        
    } catch (error) {
        console.error('Erreur lors de la génération du PDF:', error);
        alert('Erreur lors de la génération du PDF: ' + error.message + '\n\nVeuillez vérifier que tous les champs obligatoires sont remplis et réessayer.');
    }
}

// ==================== FONCTIONS DE TÉLÉCHARGEMENT ET PARTAGE ====================

function telechargerPDF() {
    if (currentPDF) {
        const prenom = document.getElementById('prenom')?.value || '';
        const nom = document.getElementById('nom')?.value || 'Testament';
        const dateStr = new Date().toISOString().split('T')[0];
        const fileName = `Testament_${prenom}_${nom}_${dateStr}.pdf`.replace(/[^a-zA-Z0-9._-]/g, '_');
        
        currentPDF.save(fileName);
        console.log('PDF téléchargé:', fileName);
    } else {
        console.log('Aucun PDF en mémoire, génération d\'un nouveau PDF');
        genererPDF();
    }
}

function envoyerParEmail() {
    const prenom = document.getElementById('prenom')?.value || '';
    const nom = document.getElementById('nom')?.value || '';
    const subject = encodeURIComponent(`Testament Islamique - ${prenom} ${nom}`);
    const body = encodeURIComponent(`Bonjour,

Ci-joint mon testament islamique généré avec Al Wassiya - الوصية.

Ce document a été créé conformément aux principes de l'héritage islamique (Mirath).

Cordialement,
${prenom} ${nom}

---
Généré par Al Wassiya - الوصية
Testament Islamique Simplifié
${window.location.href}`);

    const mailtoLink = `mailto:?subject=${subject}&body=${body}`;
    window.location.href = mailtoLink;
    
    if (!currentPDF) {
        alert('N\'oubliez pas de générer et télécharger le PDF avant de l\'envoyer !');
    } else {
        alert('Votre client email va s\'ouvrir. N\'oubliez pas de joindre le fichier PDF téléchargé à votre message.');
    }
}

function partagerWhatsApp() {
    const text = encodeURIComponent(`🕌 J'ai créé mon testament islamique avec Al Wassiya - الوصية

✅ Application gratuite et conforme aux principes islamiques
📋 Génération automatique de PDF complet
🔒 Données sécurisées et privées

Découvrez-la ici: ${window.location.href}

#Testament #Islam #الوصية #Mirath`);
    
    const whatsappURL = `https://wa.me/?text=${text}`;
    window.open(whatsappURL, '_blank');
    console.log('Partage WhatsApp initié');
}

function partagerFacebook() {
    const url = encodeURIComponent(window.location.href);
    const text = encodeURIComponent('Al Wassiya - الوصية | Testament Islamique Simplifié - Créez votre testament selon les principes islamiques');
    
    const facebookURL = `https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${text}`;
    window.open(facebookURL, '_blank');
    console.log('Partage Facebook initié');
}

function partagerTwitter() {
    const text = encodeURIComponent(`🕌 Al Wassiya - الوصية

Testament islamique simplifié et gratuit
✅ Conforme aux principes de l'héritage islamique
📄 Génération PDF automatique

#Testament #Islam #الوصية #Mirath`);
    
    const url = encodeURIComponent(window.location.href);
    const twitterURL = `https://twitter.com/intent/tweet?text=${text}&url=${url}`;
    window.open(twitterURL, '_blank');
    console.log('Partage Twitter initié');
}

function partagerEmail() {
    const subject = encodeURIComponent('Al Wassiya - الوصية | Testament Islamique');
    const body = encodeURIComponent(`Bonjour,

Je viens de découvrir Al Wassiya (الوصية), une application web gratuite qui permet de créer son testament islamique de manière simple et conforme aux principes religieux.

🕌 Caractéristiques:
✅ Respecte les règles de l'héritage islamique (Mirath)
📋 Interface guidée pas à pas
📄 Génération automatique de PDF
🔒 Données privées et sécurisées
🌍 Disponible en français et arabe

L'application guide dans la rédaction et génère automatiquement un PDF complet avec le Bismillah et les dispositions importantes.

Vous pouvez la découvrir ici: ${window.location.href}

Cordialement`);
    
    const emailURL = `mailto:?subject=${subject}&body=${body}`;
    window.location.href = emailURL;
    console.log('Partage Email initié');
}

// ==================== FONCTIONS DE DIAGNOSTIC ====================

function testerJsPDF() {
    console.log('=== DIAGNOSTIC JSPDF ===');
    console.log('window.jspdf:', typeof window.jspdf);
    
    if (typeof window.jspdf !== 'undefined') {
        console.log('✅ jsPDF est chargé');
        
        try {
            const { jsPDF } = window.jspdf;
            const testDoc = new jsPDF();
            testDoc.text('Test', 10, 10);
            console.log('✅ jsPDF fonctionne correctement');
            return true;
        } catch (error) {
            console.error('❌ Erreur lors du test jsPDF:', error);
            return false;
        }
    } else {
        console.error('❌ jsPDF n\'est pas chargé');
        return false;
    }
}

// ==================== INITIALISATION ET VÉRIFICATIONS ====================

// Test au chargement de la page
window.addEventListener('load', function() {
    console.log('=== INITIALISATION AL WASSIYA ===');
    
    // Test jsPDF
    setTimeout(() => {
        const jsPDFOK = testerJsPDF();
        if (!jsPDFOK) {
            console.error('⚠️ Problème avec jsPDF détecté');
        }
    }, 1000);
    
    console.log('✅ Al Wassiya initialisé');
});

// Test périodique de jsPDF (optionnel)
setInterval(() => {
    if (typeof window.jspdf === 'undefined') {
        console.warn('⚠️ jsPDF non disponible - rechargement recommandé');
    }
}, 30000); // Vérifie toutes les 30 secondes

console.log('📄 Module PDF Al Wassiya chargé');
</script>

</body>
</html>
