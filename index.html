<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Al Wassiya - Votre Testament Islamique Simplifié</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #C9B178;
            --primary-dark: #A89262;
            --secondary: #2D4C68;
            --accent: #3A5F7E;
            --light: #F8F5EE;
            --dark: #1E1E24;
            --success: #4CAF50;
            --error: #E74C3C;
            --radius: 16px;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #F8F5EE 0%, #E8E2D1 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .skip-to-content {
            position: absolute;
            left: -10000px;
            top: auto;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }

        .skip-to-content:focus {
            position: static;
            width: auto;
            height: auto;
            background: var(--primary);
            color: white;
            padding: 10px;
            z-index: 1000;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        header {
            background: var(--secondary);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .bismillah {
            font-size: 2rem;
            margin: 20px 0;
            font-weight: bold;
        }

        .progress-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 100px;
            height: 12px;
            margin: 30px auto 20px;
            max-width: 600px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: var(--primary);
            border-radius: 100px;
            width: 0%;
            transition: var(--transition);
        }

        .etape-indicator {
            display: flex;
            justify-content: space-between;
            max-width: 600px;
            margin: 0 auto;
            position: relative;
        }

        .etape-point {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            position: relative;
            z-index: 2;
            transition: var(--transition);
        }

        .etape-point.active {
            background: var(--primary);
            transform: scale(1.2);
        }

        .etape-point.completed {
            background: var(--success);
        }

        .main-content {
            padding: 40px;
        }

        .etape {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .etape.active {
            display: block;
        }

        .etape-title {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            color: var(--secondary);
            margin-bottom: 10px;
            text-align: center;
        }

        .etape-subtitle {
            text-align: center;
            margin-bottom: 40px;
            color: var(--accent);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--secondary);
        }

        .form-control {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: var(--radius);
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(201, 177, 120, 0.3);
        }

        .form-select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: var(--radius);
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            background: white;
            transition: var(--transition);
        }

        .form-select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(201, 177, 120, 0.3);
        }

        .btn {
            display: inline-block;
            padding: 15px 30px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary {
            background: var(--accent);
        }

        .btn-secondary:hover {
            background: #2D4C68;
        }

        .btn-success {
            background: var(--success);
        }

        .btn-success:hover {
            background: #3d8b40;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #eee;
        }

        .card {
            background: var(--light);
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary);
        }

        .card-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            color: var(--secondary);
            margin-bottom: 20px;
        }

        .add-item-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(201, 177, 120, 0.1);
            border: 2px dashed var(--primary);
            border-radius: var(--radius);
            padding: 20px;
            width: 100%;
            color: var(--primary);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 20px;
        }

        .add-item-btn:hover {
            background: rgba(201, 177, 120, 0.2);
        }

        .add-item-btn i {
            margin-right: 10px;
        }

        .item-form {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px;
        }

        .form-col {
            flex: 1;
            padding: 0 10px;
            min-width: 250px;
            margin-bottom: 15px;
        }

        .remove-btn {
            background: var(--error);
            color: white;
            border: none;
            border-radius: var(--radius);
            padding: 10px 15px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            margin-top: 10px;
        }

        .remove-btn:hover {
            background: #c0392b;
        }

        .remove-btn i {
            margin-right: 5px;
        }

        .save-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 10px 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            opacity: 0;
            transform: translateY(20px);
            transition: var(--transition);
            z-index: 1000;
        }

        .save-indicator.show {
            opacity: 1;
            transform: translateY(0);
        }

        .help-text {
            font-size: 0.9rem;
            color: #777;
            margin-top: 5px;
        }

        .islamic-note {
            background: rgba(45, 76, 104, 0.05);
            border-left: 4px solid var(--secondary);
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            font-size: 0.9rem;
        }

        .summary-item {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
        }

        .summary-title {
            font-weight: 600;
            color: var(--secondary);
            margin-bottom: 10px;
        }

        .summary-content {
            color: #555;
        }

        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 100px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-right: 8px;
            margin-bottom: 8px;
        }

        .badge-primary {
            background: rgba(201, 177, 120, 0.2);
            color: var(--primary-dark);
        }

        .badge-secondary {
            background: rgba(45, 76, 104, 0.1);
            color: var(--secondary);
        }

        .badge-success {
            background: rgba(76, 175, 80, 0.2);
            color: #2e7d32;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            header {
                padding: 20px;
            }

            .logo {
                font-size: 2rem;
            }

            .bismillah {
                font-size: 1.5rem;
            }

            .main-content {
                padding: 20px;
            }

            .etape-title {
                font-size: 1.5rem;
            }

            .form-col {
                min-width: 100%;
            }

            .navigation {
                flex-direction: column;
                gap: 15px;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-to-content">Aller au contenu principal</a>

    <div class="container">
        <header>
            <div class="logo">Al Wassiya</div>
            <div class="subtitle">Votre Testament Islamique Simplifié</div>
            <div class="bismillah">بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ</div>

            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>

            <div class="etape-indicator">
                <div class="etape-point active" id="etapePoint1">1</div>
                <div class="etape-point" id="etapePoint2">2</div>
                <div class="etape-point" id="etapePoint3">3</div>
                <div class="etape-point" id="etapePoint4">4</div>
                <div class="etape-point" id="etapePoint5">5</div>
                <div class="etape-point" id="etapePoint6">6</div>
            </div>
        </header>

        <main id="main-content" class="main-content">
            <form id="testamentForm">
                <!-- Étape 1: Informations personnelles -->
                <div class="etape active" id="etape1">
                    <h2 class="etape-title">Vos Informations Personnelles</h2>
                    <p class="etape-subtitle">Renseignez vos informations de base pour commencer</p>

                    <div class="card">
                        <h3 class="card-title">Identité</h3>
                        
                        <div class="form-group">
                            <label class="form-label">Sexe *</label>
                            <select class="form-select" name="sexe" required>
                                <option value="">Sélectionnez votre sexe</option>
                                <option value="Masculin">Masculin</option>
                                <option value="Féminin">Féminin</option>
                            </select>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">Nom *</label>
                                    <input type="text" class="form-control" name="nom" required>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">Prénom *</label>
                                    <input type="text" class="form-control" name="prenom" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">Date de naissance *</label>
                                    <input type="date" class="form-control" name="dateNaissance" required>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">Lieu de naissance *</label>
                                    <input type="text" class="form-control" name="lieuNaissance" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Adresse complète *</label>
                            <textarea class="form-control" name="adresse" rows="3" required></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">Nationalité *</label>
                                    <input type="text" class="form-control" name="nationalite" required>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">Situation familiale *</label>
                                    <select class="form-select" name="situationFamiliale" required>
                                        <option value="">Sélectionnez</option>
                                        <option value="Célibataire">Célibataire</option>
                                        <option value="Marié(e)">Marié(e)</option>
                                        <option value="Divorcé(e)">Divorcé(e)</option>
                                        <option value="Veuf/ve">Veuf/ve</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group" id="conjointField">
                            <label class="form-label">Nom et prénom du conjoint</label>
                            <input type="text" class="form-control" name="conjoint">
                        </div>
                    </div>

                    <div class="navigation">
                        <div></div> <!-- Empty div for spacing -->
                        <button type="button" class="btn btn-secondary" onclick="changerEtape(2)">Suivant</button>
                    </div>
                </div>

                <!-- Étape 2: Personnes à prévenir -->
                <div class="etape" id="etape2">
                    <h2 class="etape-title">Personnes à Prévenir</h2>
                    <p class="etape-subtitle">Indiquez les personnes à contacter en cas de besoin</p>

                    <div class="card">
                        <h3 class="card-title">Parents</h3>
                        <p class="help-text">Ajoutez vos parents (père, mère, etc.)</p>
                        
                        <div id="parents-container"></div>
                        
                        <button type="button" class="add-item-btn" onclick="ajouterPersonne('parents')">
                            <i class="fas fa-plus"></i> Ajouter un parent
                        </button>
                    </div>

                    <div class="card">
                        <h3 class="card-title">Conjoint(s)</h3>
                        <p class="help-text">Ajoutez votre/vos conjoint(s) actuel(s) ou précédent(s)</p>
                        
                        <div id="conjoints-container"></div>
                        
                        <button type="button" class="add-item-btn" onclick="ajouterPersonne('conjoints')">
                            <i class="fas fa-plus"></i> Ajouter un conjoint
                        </button>
                    </div>

                    <div class="card">
                        <h3 class="card-title">Frères et Soeurs</h3>
                        <p class="help-text">Ajoutez vos frères et soeurs</p>
                        
                        <div id="freres-soeurs-container"></div>
                        
                        <button type="button" class="add-item-btn" onclick="ajouterPersonne('freres-soeurs')">
                            <i class="fas fa-plus"></i> Ajouter un frère/une soeur
                        </button>
                    </div>

                    <div class="card">
                        <h3 class="card-title">Enfants</h3>
                        <p class="help-text">Ajoutez vos enfants</p>
                        
                        <div id="enfants-container"></div>
                        
                        <button type="button" class="add-item-btn" onclick="ajouterPersonne('enfants')">
                            <i class="fas fa-plus"></i> Ajouter un enfant
                        </button>
                    </div>

                    <div class="card">
                        <h3 class="card-title">Amis proches</h3>
                        <p class="help-text">Ajoutez des amis proches ou autres personnes importantes</p>
                        
                        <div id="amis-container"></div>
                        
                        <button type="button" class="add-item-btn" onclick="ajouterPersonne('amis')">
                            <i class="fas fa-plus"></i> Ajouter un ami proche
                        </button>
                    </div>

                    <div class="navigation">
                        <button type="button" class="btn btn-outline" onclick="changerEtape(1)">Précédent</button>
                        <button type="button" class="btn btn-secondary" onclick="changerEtape(3)">Suivant</button>
                    </div>
                                    </div><!-- Étape 3: Biens et possessions -->
<div class="etape" id="etape3">
    <h2 class="etape-title">Biens et Possessions</h2>
    <p class="etape-subtitle">Déclarez vos biens matériels et financiers</p>

    <div class="islamic-note">
        <strong>Note importante:</strong> Selon le droit islamique, seuls le tiers (1/3) de vos biens peut être légué librement. Les deux tiers restants sont distribués selon les règles coraniques de l'héritage.
    </div>

    <div class="card">
        <h3 class="card-title">Biens immobiliers</h3>
        <p class="help-text">Maisons, appartements, terrains, etc.</p>
        
        <div id="immobilier-container"></div>
        
        <button type="button" class="add-item-btn" onclick="ajouterBien('immobilier')">
            <i class="fas fa-plus"></i> Ajouter un bien immobilier
        </button>
    </div>

    <div class="card">
        <h3 class="card-title">Véhicules et biens matériels</h3>
        <p class="help-text">Voitures, motos, équipements, etc.</p>
        
        <div id="materiel-container"></div>
        
        <button type="button" class="add-item-btn" onclick="ajouterBien('materiel')">
            <i class="fas fa-plus"></i> Ajouter un bien matériel
        </button>
    </div>

    <div class="card">
        <h3 class="card-title">Biens personnels de valeur</h3>
        <p class="help-text">Bijoux, œuvres d'art, collections, etc.</p>
        
        <div id="personnels-container"></div>
        
        <button type="button" class="add-item-btn" onclick="ajouterBien('personnels')">
            <i class="fas fa-plus"></i> Ajouter un bien personnel
        </button>
    </div>

    <div class="card">
        <h3 class="card-title">Comptes bancaires</h3>
        <p class="help-text">Comptes courants, comptes épargne, etc.</p>
        
        <div id="comptes-container"></div>
        
        <button type="button" class="add-item-btn" onclick="ajouterCompte('comptes')">
            <i class="fas fa-plus"></i> Ajouter un compte bancaire
        </button>
    </div>

    <div class="card">
        <h3 class="card-title">Cartes bancaires</h3>
        <p class="help-text">Cartes de crédit, cartes de débit, etc.</p>
        
        <div id="cartes-container"></div>
        
        <button type="button" class="add-item-btn" onclick="ajouterCarte('cartes')">
            <i class="fas fa-plus"></i> Ajouter une carte bancaire
        </button>
    </div>

    <div class="card">
        <h3 class="card-title">Applications bancaires</h3>
        <p class="help-text">Applications mobiles, codes d'accès, etc.</p>
        
        <div id="applications-container"></div>
        
        <button type="button" class="add-item-btn" onclick="ajouterApplication('applications')">
            <i class="fas fa-plus"></i> Ajouter une application bancaire
        </button>
    </div>

    <div class="navigation">
        <button type="button" class="btn btn-outline" onclick="changerEtape(2)">Précédent</button>
        <button type="button" class="btn btn-secondary" onclick="changerEtape(4)">Suivant</button>
    </div>
</div>

<!-- Étape 4: Dettes et obligations -->
<div class="etape" id="etape4">
    <h2 class="etape-title">Dettes et Obligations</h2>
    <p class="etape-subtitle">Déclarez vos dettes et obligations religieuses</p>

    <div class="islamic-note">
        <strong>Note importante:</strong> Selon l'Islam, toutes les dettes doivent être réglées avant la distribution de l'héritage. Il est essentiel de les mentionner ici.
    </div>

    <div class="card">
        <h3 class="card-title">Créances à percevoir</h3>
        <p class="help-text">Argent que d'autres personnes vous doivent</p>
        
        <div id="creances-container"></div>
        
        <button type="button" class="add-item-btn" onclick="ajouterCreance('creances')">
            <i class="fas fa-plus"></i> Ajouter une créance
        </button>
    </div>

    <div class="card">
        <h3 class="card-title">Dettes à régler</h3>
        <p class="help-text">Argent que vous devez à d'autres personnes</p>
        
        <div id="dettes-container"></div>
        
        <button type="button" class="add-item-btn" onclick="ajouterDette('dettes')">
            <i class="fas fa-plus"></i> Ajouter une dette
        </button>
    </div>

    <div class="card">
        <h3 class="card-title">Sadaqa et legs charitables</h3>
        <p class="help-text">Dons et œuvres caritatives que vous souhaitez effectuer</p>
        
        <div id="sadaqa-container"></div>
        
        <button type="button" class="add-item-btn" onclick="ajouterSadaqa('sadaqa')">
            <i class="fas fa-plus"></i> Ajouter un legs charitable
        </button>
    </div>

    <div class="card">
        <h3 class="card-title">Obligations religieuses</h3>
        
        <div class="form-group">
            <label class="form-label">Zakat</label>
            <select class="form-select" name="zakatStatus">
                <option value="">Sélectionnez le statut de votre Zakat</option>
                <option value="versee">Zakat versée</option>
                <option value="non-versee">Zakat non versée</option>
                <option value="partielle">Zakat partiellement versée</option>
            </select>
        </div>
        
        <div class="form-group">
            <label class="form-label">Jeûne de Ramadan</label>
            <select class="form-select" name="jeuneStatus">
                <option value="">Sélectionnez le statut de votre jeûne</option>
                <option value="0">Aucun jour à rattraper</option>
                <option value="1">1 jour à rattraper</option>
                <option value="2">2 jours à rattraper</option>
                <option value="3">3 jours à rattraper</option>
                <option value="4">4 jours à rattraper</option>
                <option value="5">5 jours à rattraper</option>
                <option value="plus">Plus de 5 jours à rattraper</option>
            </select>
        </div>
        
        <div class="form-group">
            <label class="form-label">Notes sur le jeûne (si nécessaire)</label>
            <textarea class="form-control" name="jeuneNotes" rows="3"></textarea>
        </div>
        
        <div class="form-group">
            <label class="form-label">Pèlerinage (Hadj)</label>
            <select class="form-select" name="hadjStatus">
                <option value="">Sélectionnez le statut de votre Hadj</option>
                <option value="accompli">Hadj accompli</option>
                <option value="non-accompli">Hadj non accompli</option>
                <option value="partiel">Hadj partiellement accompli (Omra seulement)</option>
            </select>
        </div>
        
        <div class="form-group">
            <label class="form-label">Notes sur le Hadj (si nécessaire)</label>
            <textarea class="form-control" name="hadjNotes" rows="3"></textarea>
        </div>
    </div>

    <div class="navigation">
        <button type="button" class="btn btn-outline" onclick="changerEtape(3)">Précédent</button>
        <button type="button" class="btn btn-secondary" onclick="changerEtape(5)">Suivant</button>
    </div>
</div>

<!-- Étape 5: Héritage et legs -->
<div class="etape" id="etape5">
    <h2 class="etape-title">Héritage et Legs</h2>
    <p class="etape-subtitle">Exprimez vos volontés concernant la répartition de vos biens</p>

    <div class="islamic-note">
        <strong>Note importante:</strong> Selon le droit islamique, seuls le tiers (1/3) de vos biens peut être légué librement. Les deux tiers restants sont distribués selon les règles coraniques de l'héritage.
    </div>

    <div class="card">
        <h3 class="card-title">Répartition de l'héritage</h3>
        <p class="help-text">Vous pouvez ajouter des notes concernant la répartition de vos biens selon les règles islamiques</p>
        
        <div class="form-group">
            <label class="form-label">Notes sur l'héritage</label>
            <textarea class="form-control" name="heritageNotes" rows="5" placeholder="Ex: Je souhaite que mes biens soient répartis selon les règles coraniques..."></textarea>
        </div>
    </div>

    <div class="card">
        <h3 class="card-title">Legs testamentaires (Wasiyya)</h3>
        <p class="help-text">Ajoutez des legs spécifiques (dans la limite du tiers de vos biens)</p>
        
        <div id="legs-container"></div>
        
        <button type="button" class="add-item-btn" onclick="ajouterLeg('legs')">
            <i class="fas fa-plus"></i> Ajouter un legs
        </button>
    </div>

    <div class="card">
        <h3 class="card-title">Exécuteur testamentaire</h3>
        <p class="help-text">Personne qui s'assurera que vos volontés sont respectées</p>
        
        <div class="form-group">
            <label class="form-label">Personne suggérée comme exécuteur testamentaire</label>
            <input type="text" class="form-control" name="executeurTestament" placeholder="Nom et prénom">
        </div>
        
        <div class="form-group">
            <label class="form-label">Contact de l'exécuteur testamentaire</label>
            <input type="text" class="form-control" name="contactExecuteur" placeholder="Téléphone ou email">
        </div>
    </div>

    <div class="card">
        <h3 class="card-title">Volontés concernant les obsèques</h3>
        
        <div class="form-group">
            <label class="form-label">Volontés particulières</label>
            <textarea class="form-control" name="volontesObseques" rows="4" placeholder="Ex: Je souhaite que mes obsèques soient effectuées selon les traditions islamiques..."></textarea>
        </div>
    </div>

    <div class="card">
        <h3 class="card-title">Recommandations à la famille</h3>
        
        <div class="form-group">
            <label class="form-label">Message à votre famille</label>
            <textarea class="form-control" name="recommandationsFamille" rows="4" placeholder="Ex: Je recommande à mes enfants de rester unis et de préserver leurs liens familiaux..."></textarea>
        </div>
    </div>

    <div class="navigation">
        <button type="button" class="btn btn-outline" onclick="changerEtape(4)">Précédent</button>
        <button type="button" class="btn btn-secondary" onclick="changerEtape(6)">Suivant</button>
    </div>
</div>            <!-- Étape 6: Données numériques -->
            <div class="etape" id="etape6">
                <h2 class="etape-title">Données Numériques</h2>
                <p class="etape-subtitle">Indiquez vos comptes numériques et mots de passe importants</p>

                <div class="islamic-note">
                    <strong>Note importante:</strong> Ces informations sont cruciales pour permettre à vos héritiers d'accéder à vos comptes et de gérer vos affaires numériques après votre décès.
                </div>

                <div class="card">
                    <h3 class="card-title">Réseaux sociaux</h3>
                    <p class="help-text">Comptes Facebook, Instagram, Twitter, LinkedIn, etc.</p>
                    
                    <div id="reseaux_sociaux-container"></div>
                    
                    <button type="button" class="add-item-btn" onclick="ajouterReseauSocial('reseaux_sociaux')">
                        <i class="fas fa-plus"></i> Ajouter un réseau social
                    </button>
                </div>

                <div class="card">
                    <h3 class="card-title">Comptes email</h3>
                    <p class="help-text">Adresses email personnelles et professionnelles</p>
                    
                    <div id="emails-container"></div>
                    
                    <button type="button" class="add-item-btn" onclick="ajouterEmail('emails')">
                        <i class="fas fa-plus"></i> Ajouter un compte email
                    </button>
                </div>

                <div class="card">
                    <h3 class="card-title">Comptes en ligne importants</h3>
                    <p class="help-text">Sites de e-commerce, abonnements, services en ligne</p>
                    
                    <div id="comptes_online-container"></div>
                    
                    <button type="button" class="add-item-btn" onclick="ajouterCompteOnline('comptes_online')">
                        <i class="fas fa-plus"></i> Ajouter un compte en ligne
                    </button>
                </div>

                <div class="card">
                    <h3 class="card-title">Services cloud et stockage</h3>
                    <p class="help-text">Google Drive, iCloud, Dropbox, etc.</p>
                    
                    <div id="cloud-container"></div>
                    
                    <button type="button" class="add-item-btn" onclick="ajouterCloud('cloud')">
                        <i class="fas fa-plus"></i> Ajouter un service cloud
                    </button>
                </div>

                <div class="card">
                    <h3 class="card-title">Appareils sécurisés</h3>
                    <p class="help-text">Téléphones, ordinateurs, tablettes avec codes d'accès</p>
                    
                    <div id="appareils-container"></div>
                    
                    <button type="button" class="add-item-btn" onclick="ajouterAppareil('appareils')">
                        <i class="fas fa-plus"></i> Ajouter un appareil
                    </button>
                </div>

                <div class="card">
                    <h3 class="card-title">Autres personnes à mentionner</h3>
                    
                    <div class="form-group">
                        <label class="form-label">Personnes importantes non mentionnées précédemment</label>
                        <textarea class="form-control" name="autresProches" rows="4" placeholder="Ex: Mes cousins, oncles, tantes, amis proches..."></textarea>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">Relations particulières</h3>
                    
                    <div class="form-group">
                        <label class="form-label">Relations à mentionner spécifiquement</label>
                        <textarea class="form-control" name="relationsParticulieres" rows="4" placeholder="Ex: Relations familiales particulières, amitiés importantes..."></textarea>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">Autres volontés</h3>
                    
                    <div class="form-group">
                        <label class="form-label">Toute autre volonté non mentionnée précédemment</label>
                        <textarea class="form-control" name="autresVolontes" rows="4" placeholder="Ex: Souhaits particuliers, messages personnels..."></textarea>
                    </div>
                </div>

                <div class="navigation">
                    <button type="button" class="btn btn-outline" onclick="changerEtape(5)">Précédent</button>
                    <button type="button" class="btn btn-success" onclick="afficherResume()">Voir le résumé</button>
                </div>
            </div>

            <!-- Étape 7: Récapitulatif -->
            <div class="etape" id="etape7">
                <h2 class="etape-title">Récapitulatif de Votre Testament</h2>
                <p class="etape-subtitle">Vérifiez toutes les informations avant de finaliser</p>

                <div id="resume-container" class="resume-container">
                    <!-- Le contenu du résumé sera généré ici par JavaScript -->
                </div>

                <div class="navigation">
                    <button type="button" class="btn btn-outline" onclick="changerEtape(6)">Précédent</button>
                    <button type="button" class="btn btn-success" onclick="genererPDF()">
                        <i class="fas fa-download"></i> Télécharger le PDF
                    </button>
                </div>
            </div>
        </form>
    </main>
</div>

<div class="save-indicator" id="saveIndicator">Sauvegarde effectuée</div>

<script>
    // Variables globales
    let etapeActuelle = 1;
    const totalEtapes = 6;

    // Afficher l'étape actuelle
    function afficherEtape(numero) {
        document.querySelectorAll('.etape').forEach(etape => {
            etape.classList.remove('active');
        });
        document.getElementById('etape' + numero).classList.add('active');
        
        // Mettre à jour la barre de progression
        const pourcentage = ((numero - 1) / (totalEtapes - 1)) * 100;
        document.getElementById('progressBar').style.width = pourcentage + '%';
        
        // Mettre à jour les points d'étape
        document.querySelectorAll('.etape-point').forEach((point, index) => {
            point.classList.remove('active', 'completed');
            if (index + 1 === numero) {
                point.classList.add('active');
            } else if (index + 1 < numero) {
                point.classList.add('completed');
            }
        });
    }

    // Changer d'étape
    function changerEtape(nouvelleEtape) {
        // Validation basique pour l'étape 1
        if (nouvelleEtape === 2 && etapeActuelle === 1) {
            const requiredFields = document.querySelectorAll('#etape1 input[required], #etape1 select[required]');
            let isValid = true;
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    isValid = false;
                    field.style.borderColor = 'var(--error)';
                } else {
                    field.style.borderColor = '';
                }
            });
            
            if (!isValid) {
                alert('Veuillez remplir tous les champs obligatoires avant de continuer.');
                return;
            }
        }
        
        etapeActuelle = nouvelleEtape;
        afficherEtape(etapeActuelle);
        window.scrollTo(0, 0);
    }

    // Afficher/masquer le champ conjoint selon la situation familiale
    document.querySelector('select[name="situationFamiliale"]').addEventListener('change', function() {
        const conjointField = document.getElementById('conjointField');
        if (this.value === 'Marié(e)') {
            conjointField.style.display = 'block';
        } else {
            conjointField.style.display = 'none';
            document.querySelector('input[name="conjoint"]').value = '';
        }
    });

    // Ajouter une personne (parents, conjoints, etc.)
    function ajouterPersonne(type) {
        const container = document.getElementById(type + '-container');
        const index = container.children.length;
        
        const form = document.createElement('div');
        form.className = 'item-form';
        form.innerHTML = `
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Prénom</label>
                        <input type="text" class="form-control" name="${type}[${index}][prenom]">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Nom</label>
                        <input type="text" class="form-control" name="${type}[${index}][nom]">
                    </div>
                </div>
            </div>
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Téléphone</label>
                        <input type="tel" class="form-control" name="${type}[${index}][telephone]">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Relation</label>
                        <input type="text" class="form-control" name="${type}[${index}][relation]" placeholder="Ex: Père, Mère, Frère, etc.">
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Adresse</label>
                <textarea class="form-control" name="${type}[${index}][adresse]" rows="2"></textarea>
            </div>
            <button type="button" class="remove-btn" onclick="this.parentElement.remove();">
                <i class="fas fa-trash"></i> Supprimer
            </button>
        `;
        
        container.appendChild(form);
    }

    // Ajouter un bien immobilier
    function ajouterBien(type) {
        const container = document.getElementById(type + '-container');
        const index = container.children.length;
        
        let fields = '';
        if (type === 'immobilier') {
            fields = `
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">Type de bien</label>
                            <select class="form-select" name="${type}[${index}][type]">
                                <option value="">Sélectionnez</option>
                                <option value="Maison">Maison</option>
                                <option value="Appartement">Appartement</option>
                                <option value="Terrain">Terrain</option>
                                <option value="Local commercial">Local commercial</option>
                                <option value="Autre">Autre</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">Valeur estimée (€)</label>
                            <input type="number" class="form-control" name="${type}[${index}][valeur]">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Adresse</label>
                    <textarea class="form-control" name="${type}[${index}][adresse]" rows="2"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">Statut</label>
                            <select class="form-select" name="${type}[${index}][statut]">
                                <option value="">Sélectionnez</option>
                                <option value="Propriétaire">Propriétaire</option>
                                <option value="Locataire">Locataire</option>
                                <option value="En cours d'acquisition">En cours d'acquisition</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">Informations complémentaires</label>
                            <input type="text" class="form-control" name="${type}[${index}][info]">
                        </div>
                    </div>
                </div>
            `;
        } else {
            fields = `
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">Type</label>
                            <input type="text" class="form-control" name="${type}[${index}][type]" placeholder="Ex: Voiture, Motocyclette, Bijou, etc.">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">Valeur estimée (€)</label>
                            <input type="number" class="form-control" name="${type}[${index}][valeur]">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-control" name="${type}[${index}][description]" rows="2"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">Lieu de stockage</label>
                            <input type="text" class="form-control" name="${type}[${index}][lieu]">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">Informations complémentaires</label>
                            <input type="text" class="form-control" name="${type}[${index}][info]">
                        </div>
                    </div>
                </div>
            `;
        }
        
        const form = document.createElement('div');
        form.className = 'item-form';
        form.innerHTML = fields + `
            <button type="button" class="remove-btn" onclick="this.parentElement.remove();">
                <i class="fas fa-trash"></i> Supprimer
            </button>
        `;
        
        container.appendChild(form);
    }

    // Ajouter un compte bancaire
    function ajouterCompte(type) {
        const container = document.getElementById(type + '-container');
        const index = container.children.length;
        
        const form = document.createElement('div');
        form.className = 'item-form';
        form.innerHTML = `
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Banque</label>
                        <input type="text" class="form-control" name="${type}[${index}][banque]">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Type de compte</label>
                        <select class="form-select" name="${type}[${index}][type]">
                            <option value="">Sélectionnez</option>
                            <option value="Compte courant">Compte courant</option>
                            <option value="Compte épargne">Compte épargne</option>
                            <option value="Compte entreprise">Compte entreprise</option>
                            <option value="Compte joint">Compte joint</option>
                            <option value="Autre">Autre</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Numéro de compte/IBAN</label>
                        <input type="text" class="form-control" name="${type}[${index}][iban]">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Solde approximatif (€)</label>
                        <input type="number" class="form-control" name="${type}[${index}][solde]">
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Adresse de l'agence</label>
                <textarea class="form-control" name="${type}[${index}][adresse]" rows="2"></textarea>
            </div>
            <button type="button" class="remove-btn" onclick="this.parentElement.remove();">
                <i class="fas fa-trash"></i> Supprimer
            </button>
        `;
        
        container.appendChild(form);
    }

    // Ajouter une carte bancaire
    function ajouterCarte(type) {
        const container = document.getElementById(type + '-container');
        const index = container.children.length;
        
        const form = document.createElement('div');
        form.className = 'item-form';
        form.innerHTML = `
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Type de carte</label>
                        <select class="form-select" name="${type}[${index}][type]">
                            <option value="">Sélectionnez</option>
                            <option value="Carte de crédit">Carte de crédit</option>
                            <option value="Carte de débit">Carte de débit</option>
                            <option value="Carte prépayée">Carte prépayée</option>
                        </select>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Numéro de carte</label>
                        <input type="text" class="form-control" name="${type}[${index}][numero]">
                    </div>
                </div>
            </div>
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Date d'expiration</label>
                        <input type="text" class="form-control" name="${type}[${index}][expiration]" placeholder="MM/AA">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Code (CVV)</label>
                        <input type="text" class="form-control" name="${type}[${index}][code]">
                    </div>
                </div>
            </div>
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Banque émettrice</label>
                        <input type="text" class="form-control" name="${type}[${index}][banque]">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Plafond de retrait (€)</label>
                        <input type="number" class="form-control" name="${type}[${index}][plafond]">
                    </div>
                </div>
            </div>
            <button type="button" class="remove-btn" onclick="this.parentElement.remove();">
                <i class="fas fa-trash"></i> Supprimer
            </button>
        `;
        
        container.appendChild(form);
    }

    // Ajouter une application bancaire
    function ajouterApplication(type) {
        const container = document.getElementById(type + '-container');
        const index = container.children.length;
        
        const form = document.createElement('div');
        form.className = 'item-form';
        form.innerHTML = `
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Nom de l'application</label>
                        <input type="text" class="form-control" name="${type}[${index}][application]">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Identifiant</label>
                        <input type="text" class="form-control" name="${type}[${index}][identifiant]">
                    </div>
                </div>
            </div>
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Email associé</label>
                        <input type="email" class="form-control" name="${type}[${index}][email]">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Téléphone associé</label>
                        <input type="tel" class="form-control" name="${type}[${index}][telephone]">
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Indice pour le mot de passe</label>
                <input type="text" class="form-control" name="${type}[${index}][indice]">
            </div>
            <button type="button" class="remove-btn" onclick="this.parentElement.remove();">
                <i class="fas fa-trash"></i> Supprimer
            </button>
        `;
        
        container.appendChild(form);
    }

    // Ajouter une créance
    function ajouterCreance(type) {
        const container = document.getElementById(type + '-container');
        const index = container.children.length;
        
        const form = document.createElement('div');
        form.className = 'item-form';
        form.innerHTML = `
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Type de créance</label>
                        <select class="form-select" name="${type}[${index}][type]">
                            <option value="">Sélectionnez</option>
                            <option value="Prêt personnel">Prêt personnel</option>
                            <option value="Avance sur salaire">Avance sur salaire</option>
                            <option value="Vente à crédit">Vente à crédit</option>
                            <option value="Autre">Autre</option>
                        </select>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Montant (€)</label>
                        <input type="number" class="form-control" name="${type}[${index}][montant]">
                    </div>
                </div>
            </div>
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Débiteur</label>
                        <input type="text" class="form-control" name="${type}[${index}][nom]" placeholder="Nom et prénom">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Date de remboursement prévue</label>
                        <input type="date" class="form-control" name="${type}[${index}][date_remboursement]">
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Description</label>
                <textarea class="form-control" name="${type}[${index}][description]" rows="2"></textarea>
            </div>
            <button type="button" class="remove-btn" onclick="this.parentElement.remove();">
                <i class="fas fa-trash"></i> Supprimer
            </button>
        `;
        
        container.appendChild(form);
    }

    // Ajouter une dette
    function ajouterDette(type) {
        const container = document.getElementById(type + '-container');
        const index = container.children.length;
        
        const form = document.createElement('div');
        form.className = 'item-form';
        form.innerHTML = `
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Type de dette</label>
                        <select class="form-select" name="${type}[${index}][type]">
                            <option value="">Sélectionnez</option>
                            <option value="Prêt bancaire">Prêt bancaire</option>
                            <option value="Crédit immobilier">Crédit immobilier</option>
                            <option value="Crédit consommation">Crédit à la consommation</option>
                            <option value="Dette personnelle">Dette personnelle</option>
                            <option value="Autre">Autre</option>
                        </select>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Montant restant (€)</label>
                        <input type="number" class="form-control" name="${type}[${index}][montant]">
                    </div>
                </div>
            </div>
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Créancier</label>
                        <input type="text" class="form-control" name="${type}[${index}][nom]" placeholder="Nom de la banque ou personne">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Date d'échéance</label>
                        <input type="date" class="form-control" name="${type}[${index}][date_echeance]">
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Description</label>
                <textarea class="form-control" name="${type}[${index}][description]" rows="2"></textarea>
            </div>
            <button type="button" class="remove-btn" onclick="this.parentElement.remove();">
                <i class="fas fa-trash"></i> Supprimer
            </button>
        `;
        
        container.appendChild(form);
    }

    // Ajouter une sadaqa
    function ajouterSadaqa(type) {
        const container = document.getElementById(type + '-container');
        const index = container.children.length;
        
        const form = document.createElement('div');
        form.className = 'item-form';
        form.innerHTML = `
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Type de legs charitable</label>
                        <select class="form-select" name="${type}[${index}][type]">
                            <option value="">Sélectionnez</option>
                            <option value="Sadaqa">Sadaqa (aumône)</option>
                            <option value="Waqf">Waqf (fondation pieuse)</option>
                            <option value="Projet humanitaire">Projet humanitaire</option>
                            <option value="Construction mosquée">Construction de mosquée</option>
                            <option value="Autre">Autre</option>
                        </select>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Montant ou valeur (€)</label>
                        <input type="number" class="form-control" name="${type}[${index}][montant]">
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Bénéficiaire</label>
                <input type="text" class="form-control" name="${type}[${index}][beneficiaire]" placeholder="Nom de l'organisation ou personne">
            </div>
            <div class="form-group">
                <label class="form-label">Description</label>
                <textarea class="form-control" name="${type}[${index}][description]" rows="2"></textarea>
            </div>
            <button type="button" class="remove-btn" onclick="this.parentElement.remove();">
                <i class="fas fa-trash"></i> Supprimer
            </button>
        `;
        
        container.appendChild(form);
    }

    // Ajouter un legs
    function ajouterLeg(type) {
        const container = document.getElementById(type + '-container');
        const index = container.children.length;
        
        const form = document.createElement('div');
        form.className = 'item-form';
        form.innerHTML = `
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Bénéficiaire du legs</label>
                        <input type="text" class="form-control" name="${type}[${index}][beneficiaire]" placeholder="Nom et prénom">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Relation avec le bénéficiaire</label>
                        <input type="text" class="form-control" name="${type}[${index}][relation]" placeholder="Ex: Ami, neveu, organisation, etc.">
                    </div>
                </div>
            </div>
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Type de legs</label>
                        <select class="form-select" name="${type}[${index}][type]">
                            <option value="">Sélectionnez</option>
                            <option value="Argent">Argent</option>
                            <option value="Bien immobilier">Bien immobilier</option>
                            <option value="Bien personnel">Bien personnel</option>
                            <option value="Pourcentage">Pourcentage de l'héritage</option>
                            <option value="Autre">Autre</option>
                        </select>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Valeur (€) ou pourcentage</label>
                        <input type="text" class="form-control" name="${type}[${index}][valeur]" placeholder="Ex: 5000 ou 10%">
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Description détaillée</label>
                <textarea class="form-control" name="${type}[${index}][description]" rows="3"></textarea>
            </div>
            <button type="button" class="remove-btn" onclick="this.parentElement.remove();">
                <i class="fas fa-trash"></i> Supprimer
            </button>
        `;
        
        container.appendChild(form);
    }

    // Ajouter un réseau social
    function ajouterReseauSocial(type) {
        const container = document.getElementById(type + '-container');
        const index = container.children.length;
        
        const form = document.createElement('div');
        form.className = 'item-form';
        form.innerHTML = `
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Réseau social</label>
                        <select class="form-select" name="${type}[${index}][type]">
                            <option value="">Sélectionnez</option>
                            <option value="Facebook">Facebook</option>
                            <option value="Instagram">Instagram</option>
                            <option value="Twitter">Twitter</option>
                            <option value="LinkedIn">LinkedIn</option>
                            <option value="TikTok">TikTok</option>
                            <option value="Autre">Autre</option>
                        </select>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Pseudo/Identifiant</label>
                        <input type="text" class="form-control" name="${type}[${index}][pseudo]">
                    </div>
                </div>
            </div>
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Email associé</label>
                        <input type="email" class="form-control" name="${type}[${index}][email]">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label class="form-label">Téléphone associé</label>
                        <input type="tel" class="form-control" name="${type}[${index}][telephone]">
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Compléments d'information</label>
                <textarea class="form-control" name="${type}[${index}][complements]" rows="2"></textarea>
            </div>
            <button type="button" class="remove-btn" onclick="this.parentElement.remove();">
                <i class="fas fa-trash"></i> Supprimer
            </button>
        `;
        
        container.appendChild(form);
    }        // Ajouter un email
        function ajouterEmail(type) {
            const container = document.getElementById(type + '-container');
            const index = container.children.length;
            
            const form = document.createElement('div');
            form.className = 'item-form';
            form.innerHTML = `
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">Adresse email</label>
                            <input type="email" class="form-control" name="${type}[${index}][adresse]">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">Type de compte</label>
                            <select class="form-select" name="${type}[${index}][type]">
                                <option value="">Sélectionnez</option>
                                <option value="Personnel">Personnel</option>
                                <option value="Professionnel">Professionnel</option>
                                <option value="Secondaire">Secondaire</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Compléments d'information</label>
                    <textarea class="form-control" name="${type}[${index}][complements]" rows="2"></textarea>
                </div>
                <button type="button" class="remove-btn" onclick="this.parentElement.remove();">
                    <i class="fas fa-trash"></i> Supprimer
                </button>
            `;
            
            container.appendChild(form);
        }

        // Ajouter un compte en ligne
        function ajouterCompteOnline(type) {
            const container = document.getElementById(type + '-container');
            const index = container.children.length;
            
            const form = document.createElement('div');
            form.className = 'item-form';
            form.innerHTML = `
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">Site/Application</label>
                            <input type="text" class="form-control" name="${type}[${index}][site]" placeholder="Ex: Amazon, Netflix, etc.">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">Identifiant</label>
                            <input type="text" class="form-control" name="${type}[${index}][identifiant]">
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">Email associé</label>
                            <input type="email" class="form-control" name="${type}[${index}][email]">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">Mot de passe (indice)</label>
                            <input type="text" class="form-control" name="${type}[${index}][indice]">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Compléments d'information</label>
                    <textarea class="form-control" name="${type}[${index}][complements]" rows="2"></textarea>
                </div>
                <button type="button" class="remove-btn" onclick="this.parentElement.remove();">
                    <i class="fas fa-trash"></i> Supprimer
                </button>
            `;
            
            container.appendChild(form);
        }

        // Ajouter un service cloud
        function ajouterCloud(type) {
            const container = document.getElementById(type + '-container');
            const index = container.children.length;
            
            const form = document.createElement('div');
            form.className = 'item-form';
            form.innerHTML = `
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">Service cloud</label>
                            <select class="form-select" name="${type}[${index}][service]">
                                <option value="">Sélectionnez</option>
                                <option value="Google Drive">Google Drive</option>
                                <option value="Dropbox">Dropbox</option>
                                <option value="iCloud">iCloud</option>
                                <option value="OneDrive">OneDrive</option>
                                <option value="Autre">Autre</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">Pseudo/Identifiant</label>
                            <input type="text" class="form-control" name="${type}[${index}][pseudo]">
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">Email associé</label>
                            <input type="email" class="form-control" name="${type}[${index}][email]">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">Espace de stockage</label>
                            <input type="text" class="form-control" name="${type}[${index}][espace]" placeholder="Ex: 100 Go, 1 To, etc.">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Compléments d'information</label>
                    <textarea class="form-control" name="${type}[${index}][complements]" rows="2"></textarea>
                </div>
                <button type="button" class="remove-btn" onclick="this.parentElement.remove();">
                    <i class="fas fa-trash"></i> Supprimer
                </button>
            `;
            
            container.appendChild(form);
        }

        // Ajouter un appareil
        function ajouterAppareil(type) {
            const container = document.getElementById(type + '-container');
            const index = container.children.length;
            
            const form = document.createElement('div');
            form.className = 'item-form';
            form.innerHTML = `
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">Type d'appareil</label>
                            <select class="form-select" name="${type}[${index}][type]">
                                <option value="">Sélectionnez</option>
                                <option value="Téléphone portable">Téléphone portable</option>
                                <option value="Ordinateur portable">Ordinateur portable</option>
                                <option value="Ordinateur fixe">Ordinateur fixe</option>
                                <option value="Tablette">Tablette</option>
                                <option value="Autre">Autre</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">Modèle</label>
                            <input type="text" class="form-control" name="${type}[${index}][modele]" placeholder="Ex: iPhone 12, Samsung Galaxy, etc.">
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">Code de déverrouillage</label>
                            <input type="text" class="form-control" name="${type}[${index}][code]">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">Empreinte digitale</label>
                            <select class="form-select" name="${type}[${index}][empreinte]">
                                <option value="">Sélectionnez</option>
                                <option value="Doigt droit">Doigt droit</option>
                                <option value="Doigt gauche">Doigt gauche</option>
                                <option value="Pouce droit">Pouce droit</option>
                                <option value="Pouce gauche">Pouce gauche</option>
                                <option value="Non applicable">Non applicable</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Compléments d'information</label>
                    <textarea class="form-control" name="${type}[${index}][complements]" rows="2"></textarea>
                </div>
                <button type="button" class="remove-btn" onclick="this.parentElement.remove();">
                    <i class="fas fa-trash"></i> Supprimer
                </button>
            `;
            
            container.appendChild(form);
        }

        // Afficher le résumé
        function afficherResume() {
            const resumeContainer = document.getElementById('resume-container');
            resumeContainer.innerHTML = '<div class="card"><h3 class="card-title">Chargement du résumé...</h3></div>';
            
            // Simuler un chargement
            setTimeout(() => {
                const data = recupererToutesLesDonnees();
                let resumeHTML = '';
                
                // Informations personnelles
                resumeHTML += `
                    <div class="card">
                        <h3 class="card-title">Informations Personnelles</h3>
                        <div class="summary-item">
                            <div class="summary-title">Identité</div>
                            <div class="summary-content">
                                ${data.prenom || ''} ${data.nom || ''} (${data.sexe || 'Non précisé'})<br>
                                Né(e) le ${data.dateNaissance ? new Date(data.dateNaissance).toLocaleDateString('fr-FR') : 'Non précisé'} à ${data.lieuNaissance || 'Non précisé'}<br>
                                ${data.nationalite || 'Non précisé'}, ${data.situationFamiliale || 'Non précisé'}
                                ${data.conjoint ? ', Conjoint: ' + data.conjoint : ''}
                            </div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-title">Adresse</div>
                            <div class="summary-content">${data.adresse || 'Non précisée'}</div>
                        </div>
                    </div>
                `;
                
                // Personnes à prévenir
                const categoriesPersonnes = ['parents', 'conjoints', 'freres-soeurs', 'enfants', 'amis'];
                categoriesPersonnes.forEach(category => {
                    if (data[category] && data[category].length > 0) {
                        let categoryTitle = '';
                        switch(category) {
                            case 'parents': categoryTitle = 'Parents'; break;
                            case 'conjoints': categoryTitle = 'Conjoints'; break;
                            case 'freres-soeurs': categoryTitle = 'Frères et Soeurs'; break;
                            case 'enfants': categoryTitle = 'Enfants'; break;
                            case 'amis': categoryTitle = 'Amis proches'; break;
                        }
                        
                        resumeHTML += `<div class="card"><h3 class="card-title">${categoryTitle}</h3>`;
                        
                        data[category].forEach((person, index) => {
                            resumeHTML += `
                                <div class="summary-item">
                                    <div class="summary-title">Personne ${index + 1}</div>
                                    <div class="summary-content">
                                        ${person.prenom || ''} ${person.nom || ''}<br>
                                        ${person.relation ? 'Relation: ' + person.relation + '<br>' : ''}
                                        ${person.telephone ? 'Téléphone: ' + person.telephone + '<br>' : ''}
                                        ${person.adresse ? 'Adresse: ' + person.adresse : ''}
                                    </div>
                                </div>
                            `;
                        });
                        
                        resumeHTML += `</div>`;
                    }
                });
                
                // Biens et possessions
                const categoriesBiens = ['immobilier', 'materiel', 'personnels', 'comptes', 'cartes', 'applications'];
                categoriesBiens.forEach(category => {
                    if (data[category] && data[category].length > 0) {
                        let categoryTitle = '';
                        switch(category) {
                            case 'immobilier': categoryTitle = 'Biens Immobiliers'; break;
                            case 'materiel': categoryTitle = 'Biens Matériels'; break;
                            case 'personnels': categoryTitle = 'Biens Personnels'; break;
                            case 'comptes': categoryTitle = 'Comptes Bancaires'; break;
                            case 'cartes': categoryTitle = 'Cartes Bancaires'; break;
                            case 'applications': categoryTitle = 'Applications Bancaires'; break;
                        }
                        
                        resumeHTML += `<div class="card"><h3 class="card-title">${categoryTitle}</h3>`;
                        
                        data[category].forEach((item, index) => {
                            resumeHTML += `
                                <div class="summary-item">
                                    <div class="summary-title">Élément ${index + 1}</div>
                                    <div class="summary-content">`;
                            
                            switch(category) {
                                case 'immobilier':
                                    resumeHTML += `Type: ${item.type || 'Non précisé'}, Adresse: ${item.adresse || 'Non précisée'}, Valeur: ${item.valeur || 'Non précisée'}€, Statut: ${item.statut || 'Non précisé'}`;
                                    if (item.info) resumeHTML += `, Info: ${item.info}`;
                                    break;
                                    
                                case 'materiel':
                                case 'personnels':
                                    resumeHTML += `Type: ${item.type || 'Non précisé'}, Description: ${item.description || 'Non précisée'}, Valeur: ${item.valeur || 'Non précisée'}€, Lieu: ${item.lieu || 'Non précisé'}`;
                                    break;
                                            
                                case 'comptes':
                                    resumeHTML += `Banque: ${item.banque || 'Non précisée'}, Type: ${item.type || 'Non précisé'}, IBAN: ${item.iban || 'Non précisé'}, Solde: ${item.solde || 'Non précisé'}€`;
                                    if (item.adresse) resumeHTML += `, Adresse: ${item.adresse}`;
                                    break;
                                    
                                case 'cartes':
                                    resumeHTML += `Type: ${item.type || 'Non précisé'}, Numéro: ${item.numero || 'Non précisé'}, Expiration: ${item.expiration || 'Non précisée'}, Banque: ${item.banque || 'Non précisée'}`;
                                    if (item.code) resumeHTML += `, Code: ${item.code}`;
                                    break;
                                    
                                case 'applications':
                                    resumeHTML += `Application: ${item.application || 'Non précisée'}, Identifiant: ${item.identifiant || 'Non précisé'}, Email: ${item.email || 'Non précisé'}, Téléphone: ${item.telephone || 'Non précisé'}`;
                                    if (item.indice) resumeHTML += `, Indice: ${item.indice}`;
                                    break;
                            }
                            
                            resumeHTML += `</div></div>`;
                        });
                        
                        resumeHTML += `</div>`;
                    }
                });
                
                // Dettes et obligations
                const categoriesDettes = ['creances', 'dettes', 'sadaqa'];
                categoriesDettes.forEach(category => {
                    if (data[category] && data[category].length > 0) {
                        let categoryTitle = '';
                        switch(category) {
                            case 'creances': categoryTitle = 'Créances à Percevoir'; break;
                            case 'dettes': categoryTitle = 'Dettes à Régler'; break;
                            case 'sadaqa': categoryTitle = 'Sadaqa et Legs Charitables'; break;
                        }
                        
                        resumeHTML += `<div class="card"><h3 class="card-title">${categoryTitle}</h3>`;
                        
                        data[category].forEach((item, index) => {
                            resumeHTML += `
                                <div class="summary-item">
                                    <div class="summary-title">Élément ${index + 1}</div>
                                    <div class="summary-content">`;
                            
                            switch(category) {
                                case 'creances':
                                    resumeHTML += `Type: ${item.type || 'Non précisé'}, Montant: ${item.montant || 'Non précisé'}€, Débiteur: ${item.nom || 'Non précisé'}`;
                                    if (item.date_remboursement) resumeHTML += `, Date remboursement: ${item.date_remboursement}`;
                                    break;
                                    
                                case 'dettes':
                                    resumeHTML += `Type: ${item.type || 'Non précisé'}, Montant: ${item.montant || 'Non précisé'}€, Créancier: ${item.nom || 'Non précisé'}`;
                                    if (item.date_echeance) resumeHTML += `, Date échéance: ${item.date_echeance}`;
                                    break;
                                    
                                case 'sadaqa':
                                    resumeHTML += `Type: ${item.type || 'Non précisé'}, Description: ${item.description || 'Non précisée'}, Bénéficiaire: ${item.beneficiaire || 'Non précisé'}`;
                                    break;
                            }
                            
                            resumeHTML += `</div></div>`;
                        });
                        
                        resumeHTML += `</div>`;
                    }
                });
                
                // Obligations religieuses
                if (data.zakatStatus || data.jeuneStatus || data.hadjStatus) {
                    resumeHTML += `<div class="card"><h3 class="card-title">Obligations Religieuses</h3>`;
                    
                    if (data.zakatStatus) {
                        let zakatText = '';
                        switch(data.zakatStatus) {
                            case 'versee': zakatText = 'Zakat versée'; break;
                            case 'non-versee': zakatText = 'Zakat non versée'; break;
                            case 'partielle': zakatText = 'Zakat partiellement versée'; break;
                        }
                        resumeHTML += `<div class="summary-item"><div class="summary-title">Zakat</div><div class="summary-content">${zakatText}</div></div>`;
                    }
                    
                    if (data.jeuneStatus) {
                        let jeuneText = '';
                        if (data.jeuneStatus === '0') {
                            jeuneText = 'Aucun jour de jeûne à rattraper';
                        } else if (data.jeuneStatus === 'plus') {
                            jeuneText = 'Plus de 10 jours de jeûne à rattraper';
                        } else {
                            jeuneText = `${data.jeuneStatus} jour(s) de jeûne à rattraper`;
                        }
                        resumeHTML += `<div class="summary-item"><div class="summary-title">Jeûne de Ramadan</div><div class="summary-content">${jeuneText}</div></div>`;
                        
                        if (data.jeuneNotes) {
                            resumeHTML += `<div class="summary-item"><div class="summary-title">Notes sur le jeûne</div><div class="summary-content">${data.jeuneNotes}</div></div>`;
                        }
                    }
                    
                    if (data.hadjStatus) {
                        let hadjText = '';
                        switch(data.hadjStatus) {
                            case 'accompli': hadjText = 'Hadj accompli'; break;
                            case 'non-accompli': hadjText = 'Hadj non accompli'; break;
                            case 'partiel': hadjText = 'Hadj partiellement accompli (Omra seulement)'; break;
                        }
                        resumeHTML += `<div class="summary-item"><div class="summary-title">Pèlerinage</div><div class="summary-content">${hadjText}</div></div>`;
                        
                        if (data.hadjNotes) {
                            resumeHTML += `<div class="summary-item"><div class="summary-title">Notes sur le Hadj</div><div class="summary-content">${data.hadjNotes}</div></div>`;
                        }
                    }
                    
                    resumeHTML += `</div>`;
                }
                
                // Héritage et legs
                if (data.heritageNotes) {
                    resumeHTML += `
                        <div class="card">
                            <h3 class="card-title">Répartition de l'Héritage</h3>
                            <div class="summary-item">
                                <div class="summary-content">${data.heritageNotes}</div>
                            </div>
                        </div>
                    `;
                }
                
                if (data.legs && data.legs.length > 0) {
                    resumeHTML += `<div class="card"><h3 class="card-title">Legs Testamentaires</h3>`;
                    
                    data.legs.forEach((leg, index) => {
                        resumeHTML += `
                            <div class="summary-item">
                                <div class="summary-title">Legs ${index + 1}</div>
                                <div class="summary-content">
                                    Bénéficiaire: ${leg.beneficiaire || 'Non précisé'}<br>
                                    Type: ${leg.type || 'Non précisé'}<br>
                                    ${leg.valeur ? 'Valeur: ' + leg.valeur + '<br>' : ''}
                                    ${leg.relation ? 'Relation: ' + leg.relation + '<br>' : ''}
                                    Description: ${leg.description || 'Non précisée'}
                                </div>
                            </div>
                        `;
                    });
                    
                    resumeHTML += `</div>`;
                }
                
                if (data.executeurTestament) {
                    resumeHTML += `
                        <div class="card">
                            <h3 class="card-title">Exécuteur Testamentaire</h3>
                            <div class="summary-item">
                                <div class="summary-content">
                                    ${data.executeurTestament}<br>
                                    ${data.contactExecuteur ? 'Contact: ' + data.contactExecuteur : ''}
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                if (data.volontesObseques) {
                    resumeHTML += `
                        <div class="card">
                            <h3 class="card-title">Volontés concernant les Obsèques</h3>
                            <div class="summary-item">
                                <div class="summary-content">${data.volontesObseques}</div>
                            </div>
                        </div>
                    `;
                }
                
                if (data.recommandationsFamille) {
                    resumeHTML += `
                        <div class="card">
                            <h3 class="card-title">Recommandations à la Famille</h3>
                            <div class="summary-item">
                                <div class="summary-content">${data.recommandationsFamille}</div>
                            </div>
                        </div>
                    `;
                }
                
                // Données numériques
                const categoriesNumerique = ['reseaux_sociaux', 'emails', 'comptes_online', 'cloud', 'appareils'];
                categoriesNumerique.forEach(category => {
                    if (data[category] && data[category].length > 0) {
                        let categoryTitle = '';
                        switch(category) {
                            case 'reseaux_sociaux': categoryTitle = 'Réseaux Sociaux'; break;
                            case 'emails': categoryTitle = 'Comptes Email'; break;
                            case 'comptes_online': categoryTitle = 'Comptes en Ligne'; break;
                            case 'cloud': categoryTitle = 'Services Cloud'; break;
                            case 'appareils': categoryTitle = 'Appareils Sécurisés'; break;
                        }
                        
                        resumeHTML += `<div class="card"><h3 class="card-title">${categoryTitle}</h3>`;
                        
                        data[category].forEach((item, index) => {
                            resumeHTML += `
                                <div class="summary-item">
                                    <div class="summary-title">Élément ${index + 1}</div>
                                    <div class="summary-content">`;
                            
                            switch(category) {
                                case 'reseaux_sociaux':
                                    resumeHTML += `Réseau: ${item.type || 'Non précisé'}, Pseudo: ${item.pseudo || 'Non précisé'}, Email: ${item.email || 'Non précisé'}`;
                                    if (item.telephone) resumeHTML += `, Téléphone: ${item.telephone}`;
                                    if (item.complements) resumeHTML += `, Compléments: ${item.complements}`;
                                    break;
                                    
                                case 'emails':
                                    resumeHTML += `Email: ${item.adresse || 'Non précisé'}, Type: ${item.type || 'Non précisé'}`;
                                    if (item.complements) resumeHTML += `, Compléments: ${item.complements}`;
                                    break;
                                    
                                case 'comptes_online':
                                    resumeHTML += `Site: ${item.site || 'Non précisé'}, Email: ${item.email || 'Non précisé'}, Identifiant: ${item.identifiant || 'Non précisé'}`;
                                    if (item.complements) resumeHTML += `, Compléments: ${item.complements}`;
                                    break;
                                    
                                case 'cloud':
                                    resumeHTML += `Service: ${item.service || 'Non précisé'}, Pseudo: ${item.pseudo || 'Non précisé'}, Email: ${item.email || 'Non précisé'}`;
                                    if (item.complements) resumeHTML += `, Compléments: ${item.complements}`;
                                    break;
                                    
                                case 'appareils':
                                    resumeHTML += `Type: ${item.type || 'Non précisé'}, Modèle: ${item.modele || 'Non précisé'}`;
                                    if (item.complements) resumeHTML += `, Compléments: ${item.complements}`;
                                    break;
                            }
                            
                            resumeHTML += `</div></div>`;
                        });
                        
                        resumeHTML += `</div>`;
                    }
                });
                
                // Autres informations
                if (data.autresProches) {
                    resumeHTML += `
                        <div class="card">
                            <h3 class="card-title">Autres Personnes à Mentionner</h3>
                            <div class="summary-item">
                                <div class="summary-content">${data.autresProches}</div>
                            </div>
                        </div>
                    `;
                }
                
                if (data.relationsParticulieres) {
                    resumeHTML += `
                        <div class="card">
                            <h3 class="card-title">Relations Particulières</h3>
                            <div class="summary-item">
                                <div class="summary-content">${data.relationsParticulieres}</div>
                            </div>
                        </div>
                    `;
                }
                
                if (data.autresVolontes) {
                    resumeHTML += `
                        <div class="card">
                            <h3 class="card-title">Autres Volontés</h3>
                            <div class="summary-item">
                                <div class="summary-content">${data.autresVolontes}</div>
                            </div>
                        </div>
                    `;
                }
                
                resumeContainer.innerHTML = resumeHTML;
                changerEtape(7);
            }, 500);
        }

        // Fonction pour récupérer toutes les données du formulaire
        function recupererToutesLesDonnees() {
            const data = {};
            
            // Récupérer les champs de base
            const champsBase = document.querySelectorAll('#testamentForm input, #testamentForm select, #testamentForm textarea');
            champsBase.forEach(champ => {
                if (champ.name && !champ.name.includes('[')) {
                    data[champ.name] = champ.value;
                }
            });
            
            // Récupérer les données des catégories dynamiques
            const categories = ['parents', 'conjoints', 'freres-soeurs', 'enfants', 'amis', 
                               'immobilier', 'materiel', 'personnels', 'comptes', 'cartes', 'applications',
                               'creances', 'dettes', 'sadaqa', 'reseaux_sociaux', 'emails', 'comptes_online', 'cloud', 'appareils', 'legs'];
            
            categories.forEach(category => {
                const entries = [];
                const inputs = document.querySelectorAll(`[name^="${category}["]`);
                
                let currentIndex = -1;
                let currentEntry = {};
                
                inputs.forEach(input => {
                    const name = input.name;
                    const match = name.match(new RegExp(`${category}\\[(\\d+)\\]\\[(\\w+)\\]`));
                    
                    if (match) {
                        const index = parseInt(match[1]);
                        const field = match[2];
                        
                        if (index !== currentIndex) {
                            if (currentIndex !== -1) {
                                entries.push(currentEntry);
                            }
                            currentEntry = {};
                            currentIndex = index;
                        }
                        
                        currentEntry[field] = input.value;
                    }
                });
                
                // Ajouter la dernière entrée
                if (currentIndex !== -1) {
                    entries.push(currentEntry);
                }
                
                if (entries.length > 0) {
                    data[category] = entries;
                }
            });
            
            return data;
        }

        // Fonction pour générer le contenu HTML du PDF
        function genererContenuHTML() {
            const date = new Date().toLocaleDateString('fr-FR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // Récupérer TOUTES les données du formulaire, y compris les entrées dynamiques
            const data = recupererToutesLesDonnees();
            
            // Récupérer les données des personnes
            const categoriesPersonnes = ['parents', 'conjoints', 'freres-soeurs', 'enfants', 'amis'];
            let personnesHTML = '';
            
            categoriesPersonnes.forEach(category => {
                if (data[category] && data[category].length > 0) {
                    let categoryTitle = '';
                    switch(category) {
                        case 'parents': categoryTitle = 'PARENTS'; break;
                        case 'conjoints': categoryTitle = 'CONJOINTS'; break;
                        case 'freres-soeurs': categoryTitle = 'FRÈRES ET SOEURS'; break;
                        case 'enfants': categoryTitle = 'ENFANTS'; break;
                        case 'amis': categoryTitle = 'AMIS PROCHES'; break;
                    }
                    
                    personnesHTML += `<div class="section">
                        <div class="section-title">${categoryTitle}</div>`;
                    
                    data[category].forEach((person, index) => {
                        personnesHTML += `
                        <div class="field"><span class="field-label">Personne ${index + 1} :</span> ${person.prenom || ''} ${person.nom || ''}</div>
                        <div class="field"><span class="field-label">Téléphone :</span> ${person.telephone || 'Non précisé'}</div>
                        <div class="field"><span class="field-label">Adresse :</span> ${person.adresse || 'Non précisée'}</div>
                        <br>`;
                    });
                    
                    personnesHTML += `</div>`;
                }
            });
            
            // Récupérer les données des biens (étape 3)
            const categoriesBiens = ['immobilier', 'materiel', 'personnels', 'comptes', 'cartes', 'applications'];
            let biensHTML = '';
            
            categoriesBiens.forEach(category => {
                if (data[category] && data[category].length > 0) {
                    let categoryTitle = '';
                    switch(category) {
                        case 'immobilier': categoryTitle = 'BIENS IMMOBILIERS'; break;
                        case 'materiel': categoryTitle = 'BIENS MATÉRIELS'; break;
                        case 'personnels': categoryTitle = 'BIENS PERSONNELS'; break;
                        case 'comptes': categoryTitle = 'COMPTES BANCAIRES'; break;
                        case 'cartes': categoryTitle = 'CARTES BANCAIRES'; break;
                        case 'applications': categoryTitle = 'APPLICATIONS BANCAIRES'; break;
                    }
                    
                    biensHTML += `<div class="section">
                        <div class="section-title">${categoryTitle}</div>`;
                    
                    data[category].forEach((bien, index) => {
                        biensHTML += `<div class="field"><span class="field-label">Élément ${index + 1} :</span>`;
                        
                        switch(category) {
                            case 'immobilier':
                                biensHTML += `Type: ${bien.type || 'Non précisé'}, Adresse: ${bien.adresse || 'Non précisée'}, Valeur: ${bien.valeur || 'Non précisée'}€, Statut: ${bien.statut || 'Non précisé'}`;
                                if (bien.info) biensHTML += `, Info: ${bien.info}`;
                                break;
                                
                            case 'materiel':
                                biensHTML += `Type: ${bien.type || 'Non précisé'}, Description: ${bien.description || 'Non précisée'}, Valeur: ${bien.valeur || 'Non précisée'}€, Lieu: ${bien.lieu || 'Non précisé'}`;
                                break;
                                
                            case 'personnels':
                                biensHTML += `Type: ${bien.type || 'Non précisé'}, Description: ${bien.description || 'Non précisée'}, Valeur: ${bien.valeur || 'Non précisée'}€, Lieu: ${bien.lieu || 'Non précisé'}`;
                                break;
                                        
                            case 'comptes':
                                biensHTML += `Banque: ${bien.banque || 'Non précisée'}, Type: ${bien.type || 'Non précisé'}, IBAN: ${bien.iban || 'Non précisé'}, Solde: ${bien.solde || 'Non précisé'}€`;
                                if (bien.adresse) biensHTML += `, Adresse: ${bien.adresse}`;
                                break;
                                
                            case 'cartes':
                                biensHTML += `Type: ${bien.type || 'Non précisé'}, Numéro: ${bien.numero || 'Non précisé'}, Expiration: ${bien.expiration || 'Non précisée'}, Banque: ${bien.banque || 'Non précisée'}`;
                                if (bien.code) biensHTML += `, Code: ${bien.code}`;
                                break;
                                
                            case 'applications':
                                biensHTML += `Application: ${bien.application || 'Non précisée'}, Identifiant: ${bien.identifiant || 'Non précisé'}, Email: ${bien.email || 'Non précisé'}, Téléphone: ${bien.telephone || 'Non précisé'}`;
                                if (bien.indice) biensHTML += `, Indice: ${bien.indice}`;
                                break;
                        }
                        
                        biensHTML += `</div>`;
                    });
                    
                    biensHTML += `</div>`;
                }
            });
            
            // Récupérer les données des dettes et créances (étape 4)
            let dettesHTML = '';
            const categoriesDettes = ['creances', 'dettes', 'sadaqa'];
            
            categoriesDettes.forEach(category => {
                if (data[category] && data[category].length > 0) {
                    let categoryTitle = '';
                    switch(category) {
                        case 'creances': categoryTitle = 'CRÉANCES À PERCEVOIR'; break;
                        case 'dettes': categoryTitle = 'DETTES À RÉGLER'; break;
                        case 'sadaqa': categoryTitle = 'SADAQA À EFFECTUER'; break;
                    }
                    
                    dettesHTML += `<div class="section">
                        <div class="section-title">${categoryTitle}</div>`;
                    
                    data[category].forEach((item, index) => {
                        dettesHTML += `<div class="field"><span class="field-label">Élément ${index + 1} :</span>`;
                        
                        switch(category) {
                            case 'creances':
                                dettesHTML += `Type: ${item.type || 'Non précisé'}, Montant: ${item.montant || 'Non précisé'}€, Débiteur: ${item.nom || 'Non précisé'}`;
                                if (item.date_remboursement) dettesHTML += `, Date remboursement: ${item.date_remboursement}`;
                                break;
                                
                            case 'dettes':
                                dettesHTML += `Type: ${item.type || 'Non précisé'}, Montant: ${item.montant || 'Non précisé'}€, Créancier: ${item.nom || 'Non précisé'}`;
                                if (item.date_echeance) dettesHTML += `, Date échéance: ${item.date_echeance}`;
                                break;
                                
                            case 'sadaqa':
                                dettesHTML += `Type: ${item.type || 'Non précisé'}, Description: ${item.description || 'Non précisée'}, Bénéficiaire: ${item.beneficiaire || 'Non précisé'}`;
                                break;
                        }
                        
                        dettesHTML += `</div>`;
                    });
                    
                    dettesHTML += `</div>`;
                }
            });
            
            // Récupérer les données des devoirs religieux (étape 4)
            let devoirsHTML = '';
            
            if (data.zakatStatus || data.jeuneStatus || data.hadjStatus) {
                devoirsHTML += `<div class="section">
                    <div class="section-title">DEVOIRS RELIGIEUX</div>`;
                
                if (data.zakatStatus) {
                    let zakatText = '';
                    switch(data.zakatStatus) {
                        case 'versee': zakatText = 'Zakat versée'; break;
                        case 'non-versee': zakatText = 'Zakat non versée'; break;
                        case 'partielle': zakatText = 'Zakat partiellement versée'; break;
                    }
                    devoirsHTML += `<div class="field"><span class="field-label">Zakat :</span> ${zakatText}</div>`;
                }
                
                if (data.jeuneStatus) {
                    let jeuneText = '';
                    if (data.jeuneStatus === '0') {
                        jeuneText = 'Aucun jour de jeûne à rattraper';
                    } else if (data.jeuneStatus === 'plus') {
                        jeuneText = 'Plus de 10 jours de jeûne à rattraper';
                    } else {
                        jeuneText = `${data.jeuneStatus} jour(s) de jeûne à rattraper`;
                    }
                    devoirsHTML += `<div class="field"><span class="field-label">Jeûne de Ramadan :</span> ${jeuneText}</div>`;
                    
                    if (data.jeuneNotes) {
                        devoirsHTML += `<div class="field"><span class="field-label">Notes sur le jeûne :</span> ${data.jeuneNotes}</div>`;
                    }
                }
                
                if (data.hadjStatus) {
                    let hadjText = '';
                    switch(data.hadjStatus) {
                        case 'accompli': hadjText = 'Hadj accompli'; break;
                        case 'non-accompli': hadjText = 'Hadj non accompli'; break;
                        case 'partiel': hadjText = 'Hadj partiellement accompli (Omra seulement)'; break;
                    }
                    devoirsHTML += `<div class="field"><span class="field-label">Pèlerinage :</span> ${hadjText}</div>`;
                    
                    if (data.hadjNotes) {
                        devoirsHTML += `<div class="field"><span class="field-label">Notes sur le Hadj :</span> ${data.hadjNotes}</div>`;
                    }
                }
                
                devoirsHTML += `</div>`;
            }
            
            // Récupérer les données d'héritage (étape 5)
            let heritageHTML = '';
            
            if (data.heritageNotes) {
                heritageHTML += `<div class="section">
                    <div class="section-title">RÉPARTITION DE L'HÉRITAGE</div>
                    <div class="field"><span class="field-label">Notes sur l'héritage :</span> ${data.heritageNotes}</div>
                </div>`;
            }
            
            // Récupérer les données des legs (étape 5)
            let legsHTML = '';
            
            if (data.legs && data.legs.length > 0) {
                legsHTML += `<div class="section">
                    <div class="section-title">LEGS TESTAMENTAIRES (WASIYYA)</div>`;
                
                data.legs.forEach((leg, index) => {
                    legsHTML += `
                    <div class="field"><span class="field-label">Legs ${index + 1} :</span> ${leg.beneficiaire || 'Non précisé'}</div>
                    <div class="field"><span class="field-label">Type :</span> ${leg.type || 'Non précisé'}</div>
                    <div class="field"><span class="field-label">Description :</span> ${leg.description || 'Non précisée'}</div>`;
                    
                    if (leg.valeur) {
                        legsHTML += `<div class="field"><span class="field-label">Valeur :</span> ${leg.valeur} €</div>`;
                    }
                    
                    if (leg.relation) {
                        legsHTML += `<div class="field"><span class="field-label">Relation :</span> ${leg.relation}</div>`;
                    }
                    
                    legsHTML += `<br>`;
                });
                
                legsHTML += `</div>`;
            }
            
            // Récupérer les données numériques (étape 6)
            let numeriqueHTML = '';
            const categoriesNumerique = ['reseaux_sociaux', 'emails', 'comptes_online', 'cloud', 'appareils'];
            
            categoriesNumerique.forEach(category => {
                if (data[category] && data[category].length > 0) {
                    let categoryTitle = '';
                    switch(category) {
                        case 'reseaux_sociaux': categoryTitle = 'RÉSEAUX SOCIAUX'; break;
                        case 'emails': categoryTitle = 'COMPTES EMAIL'; break;
                        case 'comptes_online': categoryTitle = 'COMPTES EN LIGNE'; break;
                        case 'cloud': categoryTitle = 'SERVICES CLOUD'; break;
                        case 'appareils': categoryTitle = 'APPAREILS SÉCURISÉS'; break;
                    }
                    
                    numeriqueHTML += `<div class="section">
                        <div class="section-title">${categoryTitle}</div>`;
                    
                    data[category].forEach((item, index) => {
                        numeriqueHTML += `<div class="field"><span class="field-label">Élément ${index + 1} :</span>`;
                        
                        switch(category) {
                            case 'reseaux_sociaux':
                                numeriqueHTML += `Réseau: ${item.type || 'Non précisé'}, Pseudo: ${item.pseudo || 'Non précisé'}, Email: ${item.email || 'Non précisé'}`;
                                if (item.telephone) numeriqueHTML += `, Téléphone: ${item.telephone}`;
                                if (item.complements) numeriqueHTML += `, Compléments: ${item.complements}`;
                                break;
                                
                            case 'emails':
                                numeriqueHTML += `Email: ${item.adresse || 'Non précisé'}, Type: ${item.type || 'Non précisé'}`;
                                if (item.complements) numeriqueHTML += `, Compléments: ${item.complements}`;
                                break;
                                
                            case 'comptes_online':
                                numeriqueHTML += `Site: ${item.site || 'Non précisé'}, Email: ${item.email || 'Non précisé'}, Identifiant: ${item.identifiant || 'Non précisé'}`;
                                if (item.complements) numeriqueHTML += `, Compléments: ${item.complements}`;
                                break;
                                
                            case 'cloud':
                                numeriqueHTML += `Service: ${item.service || 'Non précisé'}, Pseudo: ${item.pseudo || 'Non précisé'}, Email: ${item.email || 'Non précisé'}`;
                                if (item.complements) numeriqueHTML += `, Compléments: ${item.complements}`;
                                break;
                                
                            case 'appareils':
                                numeriqueHTML += `Type: ${item.type || 'Non précisé'}, Modèle: ${item.modele || 'Non précisé'}`;
                                if (item.complements) numeriqueHTML += `, Compléments: ${item.complements}`;
                                break;
                        }
                        
                        numeriqueHTML += `</div>`;
                    });
                    
                    numeriqueHTML += `</div>`;
                }
            });
            
            return `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Testament Islamique - Al Wassiya</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;500&display=swap');
        
        body { 
            font-family: 'Poppins', sans-serif; 
            line-height: 1.7; 
            margin: 0;
            padding: 0;
            color: #1A2E40;
            background-color: #F8F5EE;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px;
            background: white;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.1);
        }
        
        .header { 
            text-align: center; 
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px solid #C9B178;
        }
        
        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 36px;
            color: #C9B178;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 16px;
            color: #2D4C68;
            margin-bottom: 20px;
        }
        
        .bismillah { 
            font-size: 28px; 
            color: #C9B178; 
            font-weight: bold; 
            margin: 20px 0;
        }
        
        .title { 
            font-size: 24px; 
            font-weight: bold; 
            margin: 15px 0;
            color: #1A2E40;
            font-family: 'Playfair Display', serif;
        }
        
        .section { 
            margin: 30px 0;
            padding: 20px;
            border-radius: 10px;
            background: #F8F5EE;
            border-left: 4px solid #C9B178;
        }
        
        .section-title { 
            font-size: 18px; 
            font-weight: bold; 
            color: #C9B178;
            margin-bottom: 15px;
            font-family: 'Playfair Display', serif;
        }
        
        .field { 
            margin: 12px 0;
            display: flex;
        }
        
        .field-label {
            font-weight: 500;
            min-width: 180px;
        }
        
        .signature-section {
            margin-top: 60px;
            border-top: 1px solid #ddd;
            padding-top: 30px;
            page-break-before: always;
        }
        
        .verset {
            font-style: italic;
            text-align: center;
            color: #2D4C68;
            margin: 40px 0;
            padding: 20px;
            border-radius: 10px;
            background: #F8F5EE;
            border: 1px dashed #C9B178;
        }
        
        .footer {
            text-align: center;
            margin-top: 50px;
            font-size: 14px;
            color: #2D4C68;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
        
        .decoration {
            text-align: center;
            margin: 30px 0;
            color: #C9B178;
            opacity: 0.5;
        }
        
        @media print {
            body { 
                background: white;
                margin: 0;
                padding: 0;
            }
            
            .container {
                box-shadow: none;
                padding: 20px;
            }
            
            .section {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">Al Wassiya</div>
            <div class="subtitle">Votre Testament Islamique Simplifié</div>
            <div class="bismillah">بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ</div>
            <div class="title">TESTAMENT ISLAMIQUE (WASSIYA)</div>
            <p>Date de rédaction : ${date}</p>
        </div>

        <div class="decoration">◆ ◆ ◆</div>

        <div class="section">
            <div class="section-title">IDENTITÉ DU TESTATEUR</div>
            <div class="field"><span class="field-label">Sexe :</span> ${data.sexe || 'Non précisé'}</div>
            <div class="field"><span class="field-label">Nom :</span> ${data.nom || 'Non précisé'}</div>
            <div class="field"><span class="field-label">Prénom :</span> ${data.prenom || 'Non précisé'}</div>
            <div class="field"><span class="field-label">Date de naissance :</span> ${data.dateNaissance ? new Date(data.dateNaissance).toLocaleDateString('fr-FR') : 'Non précisée'}</div>
            <div class="field"><span class="field-label">Lieu de naissance :</span> ${data.lieuNaissance || 'Non précisé'}</div>
            <div class="field"><span class="field-label">Adresse :</span> ${data.adresse || 'Non précisée'}</div>
            <div class="field"><span class="field-label">Nationalité :</span> ${data.nationalite || 'Non précisée'}</div>
            <div class="field"><span class="field-label">Situation familiale :</span> ${data.situationFamiliale || 'Non précisée'}</div>
            ${data.conjoint ? `<div class="field"><span class="field-label">Conjoint :</span> ${data.conjoint}</div>` : ''}
        </div>

        ${personnesHTML}

        ${biensHTML ? `
        <div class="decoration">◆ ◆ ◆</div>
        
        <div class="section">
            <div class="section-title">BIENS MATÉRIELS AND FINANCIERS</div>
            <p>Liste des biens matériels et financiers déclarés par le testateur :</p>
        </div>
        
        ${biensHTML}
        ` : ''}

        ${dettesHTML ? `
        <div class="decoration">◆ ◆ ◆</div>
        
        <div class="section">
            <div class="section-title">DETTES ET CRÉANCES</div>
            <p>Liste des dettes à régler et créances à percevoir :</p>
        </div>
        
        ${dettesHTML}
        ` : ''}

        ${devoirsHTML ? `
        <div class="decoration">◆ ◆ ◆</div>
        
        ${devoirsHTML}
        ` : ''}

        ${heritageHTML ? `
        <div class="decoration">◆ ◆ ◆</div>
        
        ${heritageHTML}
        ` : ''}

        ${legsHTML ? `
        <div class="decoration">◆ ◆ ◆</div>
        
        ${legsHTML}
        ` : ''}

        ${numeriqueHTML ? `
        <div class="decoration">◆ ◆ ◆</div>
        
        <div class="section">
            <div class="section-title">DONNÉES NUMÉRIQUES</div>
            <p>Liste des comptes numériques et appareils déclarés par le testateur :</p>
        </div>
        
        ${numeriqueHTML}
        ` : ''}

        <div class="section">
            <div class="section-title">VOLONTÉS CONCERNANT LES OBSÈQUES</div>
            <p>${data.volontesObseques || 'Selon les traditions islamiques'}</p>
        </div>

        <div class="section">
            <div class="section-title">RECOMMANDATIONS À LA FAMILLE</div>
            <p>${data.recommandationsFamille || 'Que Allah vous bénisse et vous guide'}</p>
        </div>

        ${data.autresProches ? `
        <div class="section">
            <div class="section-title">AUTRES PERSONNES À MENTIONNER</div>
            <p>${data.autresProches}</p>
        </div>` : ''}

        ${data.relationsParticulieres ? `
        <div class="section">
            <div class="section-title">RELATIONS PARTICULIÈRES</div>
            <p>${data.relationsParticulieres}</p>
        </div>` : ''}

        <div class="section">
            <div class="section-title">EXÉCUTEUR TESTAMENTAIRE</div>
            <div class="field"><span class="field-label">Personne suggérée :</span> ${data.executeurTestament || 'À désigner par la famille'}</div>
            <div class="field"><span class="field-label">Contact :</span> ${data.contactExecuteur || 'Non précisé'}</div>
        </div>

        ${data.autresVolontes ? `
        <div class="section">
            <div class="section-title">AUTRES VOLONTÉS</div>
            <p>${data.autresVolontes}</p>
        </div>` : ''}

        <div class="section">
            <div class="section-title">DISPOSITIONS IMPORTANTES</div>
            <ul>
                <li>Ce testament respecte les règles de l'héritage islamique (Mirath)</li>
                <li>Les dispositions ne concernent que le tiers (1/3) des biens maximum</li>
                <li>Les deux tiers restants sont distribués selon les règles coraniques</li>
                <li>Il est recommandé de faire valider ce testament par un spécialiste</li>
            </ul>
        </div>

        <div class="verset">
            "Et c'est Allah qui donne la vie et qui donne la mort. Et Allah observe parfaitement ce que vous faites." - Coran 3:156
        </div>

        <div class="signature-section">
            <p><strong>Signature du testateur :</strong> _______________________ &nbsp;&nbsp;&nbsp; <strong>Date :</strong> ${date}</p>
            <br>
            <p><strong>Témoins (recommandé) :</strong></p>
            <p>1. Nom : _________________ &nbsp;&nbsp;&nbsp; Signature : _________________</p>
            <p>2. Nom : _________________ &nbsp;&nbsp;&nbsp; Signature : _________________</p>
        </div>

        <div class="footer">
            <p>Qu'Allah accepte ce testament et facilite son exécution selon Sa volonté.</p>
            <p>Généré par Al Wassiya - Testament Islamique Simplifié</p>
        </div>
    </div>
</body>
</html>`;
        }

        // Fonction pour générer le PDF
        function genererPDF() {
            const content = genererContenuHTML();
            const printWindow = window.open('', '_blank');
            printWindow.document.write(content);
            printWindow.document.close();
            
            // Attendre que le contenu soit chargé avant d'imprimer
            printWindow.onload = function() {
                printWindow.print();
            };
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            // Masquer le champ conjoint initialement
            document.getElementById('conjointField').style.display = 'none';
            
            // Afficher la première étape
            afficherEtape(1);
        });
    </script>
</body>
</html>
